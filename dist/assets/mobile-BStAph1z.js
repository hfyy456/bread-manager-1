var ir=Object.defineProperty;var cr=(r,s,e)=>s in r?ir(r,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[s]=e;var f=(r,s,e)=>cr(r,typeof s!="symbol"?s+"":s,e);import{n as $t,g as Je,d as Ze,r as h,e as We,b as Ye,_ as F,a4 as bt,i as be,s as ue,j as a,l as Y,k as Fe,B as Nt,bd as vt,a1 as lr,v as dr,be as ur,H as hr,F as pe,bf as Te,S as fr,aX as M,aW as J,aY as zt,aZ as Ht,aV as Ke,aT as et,bg as Ne,bh as Wt,bi as gr,bj as pr,aU as Qe,bk as Yt,bl as Ft,bm as xr,bn as Vt,bo as Qt,bp as dt,bq as yr,br as wt,bs as mr,an as ee,ao as te,ap as re,aq as ne,a6 as ft,a7 as de,aa as $e,ax as br,aF as vr,ay as wr,az as jt,ab as R,a9 as ie,ac as b,aH as Ve,P as K,ad as oe,aN as jr,a8 as Ut,ai as kr,aj as Cr,ak as Tr,al as Dr,am as Mr,af as ze,ag as He,as as ke,aC as Ue,I as Ce,aM as Ir,aL as Sr,b2 as Or,b3 as ut,bt as Pr,b5 as _r,b6 as Er,b4 as Rr,aP as Lr,ae,aQ as kt,at as Gt,b9 as qr,w as ht,aI as rt,aK as nt,ar as Xt,aJ as Ar,aA as Br,C as $r,aO as Nr,aD as zr,aE as Hr,au as Wr,av as Yr,bc as Fr}from"./format-B5DKAEX1.js";function Vr(r){const{badgeContent:s,invisible:e=!1,max:t=99,showZero:n=!1}=r,o=$t({badgeContent:s,max:t});let i=e;e===!1&&s===0&&!n&&(i=!0);const{badgeContent:u,max:d=t}=i?o:r,p=u&&Number(u)>d?`${d}+`:u;return{badgeContent:u,invisible:i,max:d,displayValue:p}}function Qr(r){return Ze("MuiBadge",r)}const ge=Je("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),Ur=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],ot=10,it=4,Gr=r=>{const{color:s,anchorOrigin:e,invisible:t,overlap:n,variant:o,classes:i={}}=r,u={root:["root"],badge:["badge",o,t&&"invisible",`anchorOrigin${Y(e.vertical)}${Y(e.horizontal)}`,`anchorOrigin${Y(e.vertical)}${Y(e.horizontal)}${Y(n)}`,`overlap${Y(n)}`,s!=="default"&&`color${Y(s)}`]};return Fe(u,Qr,i)},Xr=ue("span",{name:"MuiBadge",slot:"Root",overridesResolver:(r,s)=>s.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),Jr=ue("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(r,s)=>{const{ownerState:e}=r;return[s.badge,s[e.variant],s[`anchorOrigin${Y(e.anchorOrigin.vertical)}${Y(e.anchorOrigin.horizontal)}${Y(e.overlap)}`],e.color!=="default"&&s[`color${Y(e.color)}`],e.invisible&&s.invisible]}})(({theme:r})=>{var s;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:r.typography.fontFamily,fontWeight:r.typography.fontWeightMedium,fontSize:r.typography.pxToRem(12),minWidth:ot*2,lineHeight:1,padding:"0 6px",height:ot*2,borderRadius:ot,zIndex:1,transition:r.transitions.create("transform",{easing:r.transitions.easing.easeInOut,duration:r.transitions.duration.enteringScreen}),variants:[...Object.keys(((s=r.vars)!=null?s:r).palette).filter(e=>{var t,n;return((t=r.vars)!=null?t:r).palette[e].main&&((n=r.vars)!=null?n:r).palette[e].contrastText}).map(e=>({props:{color:e},style:{backgroundColor:(r.vars||r).palette[e].main,color:(r.vars||r).palette[e].contrastText}})),{props:{variant:"dot"},style:{borderRadius:it,height:it*2,minWidth:it*2,padding:0}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ge.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ge.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ge.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ge.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ge.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ge.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ge.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ge.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:r.transitions.create("transform",{easing:r.transitions.easing.easeInOut,duration:r.transitions.duration.leavingScreen})}}]}}),Zr=h.forwardRef(function(s,e){var t,n,o,i,u,d;const p=We({props:s,name:"MuiBadge"}),{anchorOrigin:x={vertical:"top",horizontal:"right"},className:j,component:C,components:O={},componentsProps:l={},children:m,overlap:I="rectangular",color:y="default",invisible:S=!1,max:A=99,badgeContent:H,slots:L,slotProps:W,showZero:V=!1,variant:c="standard"}=p,g=Ye(p,Ur),{badgeContent:k,invisible:$,max:_,displayValue:Z}=Vr({max:A,invisible:S,badgeContent:H,showZero:V}),se=$t({anchorOrigin:x,color:y,overlap:I,variant:c,badgeContent:H}),fe=$||k==null&&c!=="dot",{color:ve=y,overlap:he=I,anchorOrigin:we=x,variant:ye=c}=fe?se:p,je=ye!=="dot"?Z:void 0,w=F({},p,{badgeContent:k,invisible:fe,max:_,displayValue:je,showZero:V,anchorOrigin:we,color:ve,overlap:he,variant:ye}),T=Gr(w),v=(t=(n=L==null?void 0:L.root)!=null?n:O.Root)!=null?t:Xr,D=(o=(i=L==null?void 0:L.badge)!=null?i:O.Badge)!=null?o:Jr,P=(u=W==null?void 0:W.root)!=null?u:l.root,Q=(d=W==null?void 0:W.badge)!=null?d:l.badge,U=bt({elementType:v,externalSlotProps:P,externalForwardedProps:g,additionalProps:{ref:e,as:C},ownerState:w,className:be(P==null?void 0:P.className,T.root,j)}),st=bt({elementType:D,externalSlotProps:Q,ownerState:w,className:be(T.badge,Q==null?void 0:Q.className)});return a.jsxs(v,F({},U,{children:[m,a.jsx(D,F({},st,{children:je}))]}))});function Kr(r){return Ze("MuiBottomNavigation",r)}Je("MuiBottomNavigation",["root"]);const en=["children","className","component","onChange","showLabels","value"],tn=r=>{const{classes:s}=r;return Fe({root:["root"]},Kr,s)},rn=ue("div",{name:"MuiBottomNavigation",slot:"Root",overridesResolver:(r,s)=>s.root})(({theme:r})=>({display:"flex",justifyContent:"center",height:56,backgroundColor:(r.vars||r).palette.background.paper})),nn=h.forwardRef(function(s,e){const t=We({props:s,name:"MuiBottomNavigation"}),{children:n,className:o,component:i="div",onChange:u,showLabels:d=!1,value:p}=t,x=Ye(t,en),j=F({},t,{component:i,showLabels:d}),C=tn(j);return a.jsx(rn,F({as:i,className:be(C.root,o),ref:e,ownerState:j},x,{children:h.Children.map(n,(O,l)=>{if(!h.isValidElement(O))return null;const m=O.props.value===void 0?l:O.props.value;return h.cloneElement(O,{selected:m===p,showLabel:O.props.showLabel!==void 0?O.props.showLabel:d,value:m,onChange:u})})}))});function sn(r){return Ze("MuiBottomNavigationAction",r)}const Jt=Je("MuiBottomNavigationAction",["root","iconOnly","selected","label"]),an=["className","icon","label","onChange","onClick","selected","showLabel","value"],on=r=>{const{classes:s,showLabel:e,selected:t}=r;return Fe({root:["root",!e&&!t&&"iconOnly",t&&"selected"],label:["label",!e&&!t&&"iconOnly",t&&"selected"]},sn,s)},cn=ue(Nt,{name:"MuiBottomNavigationAction",slot:"Root",overridesResolver:(r,s)=>{const{ownerState:e}=r;return[s.root,!e.showLabel&&!e.selected&&s.iconOnly]}})(({theme:r,ownerState:s})=>F({transition:r.transitions.create(["color","padding-top"],{duration:r.transitions.duration.short}),padding:"0px 12px",minWidth:80,maxWidth:168,color:(r.vars||r).palette.text.secondary,flexDirection:"column",flex:"1"},!s.showLabel&&!s.selected&&{paddingTop:14},!s.showLabel&&!s.selected&&!s.label&&{paddingTop:0},{[`&.${Jt.selected}`]:{color:(r.vars||r).palette.primary.main}})),ln=ue("span",{name:"MuiBottomNavigationAction",slot:"Label",overridesResolver:(r,s)=>s.label})(({theme:r,ownerState:s})=>F({fontFamily:r.typography.fontFamily,fontSize:r.typography.pxToRem(12),opacity:1,transition:"font-size 0.2s, opacity 0.2s",transitionDelay:"0.1s"},!s.showLabel&&!s.selected&&{opacity:0,transitionDelay:"0s"},{[`&.${Jt.selected}`]:{fontSize:r.typography.pxToRem(14)}})),De=h.forwardRef(function(s,e){const t=We({props:s,name:"MuiBottomNavigationAction"}),{className:n,icon:o,label:i,onChange:u,onClick:d,value:p}=t,x=Ye(t,an),j=t,C=on(j),O=l=>{u&&u(l,p),d&&d(l)};return a.jsxs(cn,F({ref:e,className:be(C.root,n),focusRipple:!0,onClick:O,ownerState:j},x,{children:[o,a.jsx(ln,{className:C.label,ownerState:j,children:i})]}))}),dn=["alignItems","autoFocus","component","children","dense","disableGutters","divider","focusVisibleClassName","selected","className"],un=(r,s)=>{const{ownerState:e}=r;return[s.root,e.dense&&s.dense,e.alignItems==="flex-start"&&s.alignItemsFlexStart,e.divider&&s.divider,!e.disableGutters&&s.gutters]},hn=r=>{const{alignItems:s,classes:e,dense:t,disabled:n,disableGutters:o,divider:i,selected:u}=r,p=Fe({root:["root",t&&"dense",!o&&"gutters",i&&"divider",n&&"disabled",s==="flex-start"&&"alignItemsFlexStart",u&&"selected"]},ur,e);return F({},e,p)},fn=ue(Nt,{shouldForwardProp:r=>hr(r)||r==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:un})(({theme:r,ownerState:s})=>F({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:r.transitions.create("background-color",{duration:r.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(r.vars||r).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Te.selected}`]:{backgroundColor:r.vars?`rgba(${r.vars.palette.primary.mainChannel} / ${r.vars.palette.action.selectedOpacity})`:pe.alpha(r.palette.primary.main,r.palette.action.selectedOpacity),[`&.${Te.focusVisible}`]:{backgroundColor:r.vars?`rgba(${r.vars.palette.primary.mainChannel} / calc(${r.vars.palette.action.selectedOpacity} + ${r.vars.palette.action.focusOpacity}))`:pe.alpha(r.palette.primary.main,r.palette.action.selectedOpacity+r.palette.action.focusOpacity)}},[`&.${Te.selected}:hover`]:{backgroundColor:r.vars?`rgba(${r.vars.palette.primary.mainChannel} / calc(${r.vars.palette.action.selectedOpacity} + ${r.vars.palette.action.hoverOpacity}))`:pe.alpha(r.palette.primary.main,r.palette.action.selectedOpacity+r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:r.vars?`rgba(${r.vars.palette.primary.mainChannel} / ${r.vars.palette.action.selectedOpacity})`:pe.alpha(r.palette.primary.main,r.palette.action.selectedOpacity)}},[`&.${Te.focusVisible}`]:{backgroundColor:(r.vars||r).palette.action.focus},[`&.${Te.disabled}`]:{opacity:(r.vars||r).palette.action.disabledOpacity}},s.divider&&{borderBottom:`1px solid ${(r.vars||r).palette.divider}`,backgroundClip:"padding-box"},s.alignItems==="flex-start"&&{alignItems:"flex-start"},!s.disableGutters&&{paddingLeft:16,paddingRight:16},s.dense&&{paddingTop:4,paddingBottom:4})),gn=h.forwardRef(function(s,e){const t=We({props:s,name:"MuiListItemButton"}),{alignItems:n="center",autoFocus:o=!1,component:i="div",children:u,dense:d=!1,disableGutters:p=!1,divider:x=!1,focusVisibleClassName:j,selected:C=!1,className:O}=t,l=Ye(t,dn),m=h.useContext(vt),I=h.useMemo(()=>({dense:d||m.dense||!1,alignItems:n,disableGutters:p}),[n,m.dense,d,p]),y=h.useRef(null);lr(()=>{o&&y.current&&y.current.focus()},[o]);const S=F({},t,{alignItems:n,dense:I.dense,disableGutters:p,divider:x,selected:C}),A=hn(S),H=dr(y,e);return a.jsx(vt.Provider,{value:I,children:a.jsx(fn,F({ref:H,href:l.href||l.to,component:(l.href||l.to)&&i==="div"?"button":i,focusVisibleClassName:be(A.focusVisible,j),ownerState:S,className:be(A.root,O)},l,{classes:A,children:u}))})});function pn(r){return Ze("MuiSwitch",r)}const X=Je("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),xn=["className","color","edge","size","sx"],yn=r=>{const{classes:s,edge:e,size:t,color:n,checked:o,disabled:i}=r,u={root:["root",e&&`edge${Y(e)}`,`size${Y(t)}`],switchBase:["switchBase",`color${Y(n)}`,o&&"checked",i&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=Fe(u,pn,s);return F({},s,d)},mn=ue("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(r,s)=>{const{ownerState:e}=r;return[s.root,e.edge&&s[`edge${Y(e.edge)}`],s[`size${Y(e.size)}`]]}})({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${X.thumb}`]:{width:16,height:16},[`& .${X.switchBase}`]:{padding:4,[`&.${X.checked}`]:{transform:"translateX(16px)"}}}}]}),bn=ue(fr,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(r,s)=>{const{ownerState:e}=r;return[s.switchBase,{[`& .${X.input}`]:s.input},e.color!=="default"&&s[`color${Y(e.color)}`]]}})(({theme:r})=>({position:"absolute",top:0,left:0,zIndex:1,color:r.vars?r.vars.palette.Switch.defaultColor:`${r.palette.mode==="light"?r.palette.common.white:r.palette.grey[300]}`,transition:r.transitions.create(["left","transform"],{duration:r.transitions.duration.shortest}),[`&.${X.checked}`]:{transform:"translateX(20px)"},[`&.${X.disabled}`]:{color:r.vars?r.vars.palette.Switch.defaultDisabledColor:`${r.palette.mode==="light"?r.palette.grey[100]:r.palette.grey[600]}`},[`&.${X.checked} + .${X.track}`]:{opacity:.5},[`&.${X.disabled} + .${X.track}`]:{opacity:r.vars?r.vars.opacity.switchTrackDisabled:`${r.palette.mode==="light"?.12:.2}`},[`& .${X.input}`]:{left:"-100%",width:"300%"}}),({theme:r})=>({"&:hover":{backgroundColor:r.vars?`rgba(${r.vars.palette.action.activeChannel} / ${r.vars.palette.action.hoverOpacity})`:pe.alpha(r.palette.action.active,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(r.palette).filter(([,s])=>s.main&&s.light).map(([s])=>({props:{color:s},style:{[`&.${X.checked}`]:{color:(r.vars||r).palette[s].main,"&:hover":{backgroundColor:r.vars?`rgba(${r.vars.palette[s].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:pe.alpha(r.palette[s].main,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${X.disabled}`]:{color:r.vars?r.vars.palette.Switch[`${s}DisabledColor`]:`${r.palette.mode==="light"?pe.lighten(r.palette[s].main,.62):pe.darken(r.palette[s].main,.55)}`}},[`&.${X.checked} + .${X.track}`]:{backgroundColor:(r.vars||r).palette[s].main}}}))]})),vn=ue("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(r,s)=>s.track})(({theme:r})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:r.transitions.create(["opacity","background-color"],{duration:r.transitions.duration.shortest}),backgroundColor:r.vars?r.vars.palette.common.onBackground:`${r.palette.mode==="light"?r.palette.common.black:r.palette.common.white}`,opacity:r.vars?r.vars.opacity.switchTrack:`${r.palette.mode==="light"?.38:.3}`})),wn=ue("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(r,s)=>s.thumb})(({theme:r})=>({boxShadow:(r.vars||r).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),jn=h.forwardRef(function(s,e){const t=We({props:s,name:"MuiSwitch"}),{className:n,color:o="primary",edge:i=!1,size:u="medium",sx:d}=t,p=Ye(t,xn),x=F({},t,{color:o,edge:i,size:u}),j=yn(x),C=a.jsx(wn,{className:j.thumb,ownerState:x});return a.jsxs(mn,{className:be(j.root,n),sx:d,ownerState:x,children:[a.jsx(bn,F({type:"checkbox",icon:C,checkedIcon:C,ref:e,ownerState:x},p,{classes:F({},j,{root:j.switchBase})})),a.jsx(vn,{className:j.track,ownerState:x})]})});function Zt(r,s,e){const t=M(r,e==null?void 0:e.in);if(isNaN(s))return J(r,NaN);if(!s)return t;const n=t.getDate(),o=J(r,t.getTime());o.setMonth(t.getMonth()+s+1,0);const i=o.getDate();return n>=i?o:(t.setFullYear(o.getFullYear(),o.getMonth(),n),t)}function Kt(r,s,e){return J(r,+M(r)+s)}function kn(r,s,e){return Kt(r,s*zt)}function Cn(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setTime(t.getTime()+s*Ht),t}function Tn(r,s,e){return Kt(r,s*1e3)}function Dn(r,s,e){return Ke(r,s*7,e)}function Mn(r,s,e){return Zt(r,s*12,e)}function In(r,s,e){const[t,n]=et(e==null?void 0:e.in,r,s);return+Ne(t)==+Ne(n)}function Ge(r,s){const e=M(r,s==null?void 0:s.in);return e.setHours(23,59,59,999),e}function Ct(r,s){const e=M(r,s==null?void 0:s.in),t=e.getFullYear();return e.setFullYear(t+1,0,0),e.setHours(23,59,59,999),e}function Sn(r,s){return M(r,s==null?void 0:s.in).getDate()}function er(r,s){const e=M(r,s==null?void 0:s.in),t=e.getFullYear(),n=e.getMonth(),o=J(e,0);return o.setFullYear(t,n+1,0),o.setHours(0,0,0,0),o.getDate()}function On(){return Object.assign({},Wt())}function Pn(r,s){return M(r,s==null?void 0:s.in).getHours()}function _n(r,s){const e=M(r,s==null?void 0:s.in).getDay();return e===0?7:e}function En(r){return M(r).getMilliseconds()}function Rn(r,s){return M(r,s==null?void 0:s.in).getMinutes()}function Ln(r,s){return M(r,s==null?void 0:s.in).getMonth()}function qn(r){return M(r).getSeconds()}function An(r,s){return M(r,s==null?void 0:s.in).getFullYear()}function ct(r,s){return+M(r)>+M(s)}function lt(r,s){return+M(r)<+M(s)}function Bn(r,s){return+M(r)==+M(s)}function $n(r,s){const e=Nn(s)?new s(0):J(s,0);return e.setFullYear(r.getFullYear(),r.getMonth(),r.getDate()),e.setHours(r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()),e}function Nn(r){var s;return typeof r=="function"&&((s=r.prototype)==null?void 0:s.constructor)===r}const zn=10;class tr{constructor(){f(this,"subPriority",0)}validate(s,e){return!0}}class Hn extends tr{constructor(s,e,t,n,o){super(),this.value=s,this.validateValue=e,this.setValue=t,this.priority=n,o&&(this.subPriority=o)}validate(s,e){return this.validateValue(s,this.value,e)}set(s,e,t){return this.setValue(s,e,this.value,t)}}class Wn extends tr{constructor(e,t){super();f(this,"priority",zn);f(this,"subPriority",-1);this.context=e||(n=>J(t,n))}set(e,t){return t.timestampIsSet?e:J(e,$n(e,this.context))}}class E{run(s,e,t,n){const o=this.parse(s,e,t,n);return o?{setter:new Hn(o.value,this.validate,this.set,this.priority,this.subPriority),rest:o.rest}:null}validate(s,e,t){return!0}}class Yn extends E{constructor(){super(...arguments);f(this,"priority",140);f(this,"incompatibleTokens",["R","u","t","T"])}parse(e,t,n){switch(t){case"G":case"GG":case"GGG":return n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"});case"GGGGG":return n.era(e,{width:"narrow"});case"GGGG":default:return n.era(e,{width:"wide"})||n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"})}}set(e,t,n){return t.era=n,e.setFullYear(n,0,1),e.setHours(0,0,0,0),e}}const N={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},ce={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function z(r,s){return r&&{value:s(r.value),rest:r.rest}}function q(r,s){const e=s.match(r);return e?{value:parseInt(e[0],10),rest:s.slice(e[0].length)}:null}function le(r,s){const e=s.match(r);if(!e)return null;if(e[0]==="Z")return{value:0,rest:s.slice(1)};const t=e[1]==="+"?1:-1,n=e[2]?parseInt(e[2],10):0,o=e[3]?parseInt(e[3],10):0,i=e[5]?parseInt(e[5],10):0;return{value:t*(n*zt+o*Ht+i*gr),rest:s.slice(e[0].length)}}function rr(r){return q(N.anyDigitsSigned,r)}function B(r,s){switch(r){case 1:return q(N.singleDigit,s);case 2:return q(N.twoDigits,s);case 3:return q(N.threeDigits,s);case 4:return q(N.fourDigits,s);default:return q(new RegExp("^\\d{1,"+r+"}"),s)}}function Xe(r,s){switch(r){case 1:return q(N.singleDigitSigned,s);case 2:return q(N.twoDigitsSigned,s);case 3:return q(N.threeDigitsSigned,s);case 4:return q(N.fourDigitsSigned,s);default:return q(new RegExp("^-?\\d{1,"+r+"}"),s)}}function gt(r){switch(r){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function nr(r,s){const e=s>0,t=e?s:1-s;let n;if(t<=50)n=r||100;else{const o=t+50,i=Math.trunc(o/100)*100,u=r>=o%100;n=r+i-(u?100:0)}return e?n:1-n}function sr(r){return r%400===0||r%4===0&&r%100!==0}class Fn extends E{constructor(){super(...arguments);f(this,"priority",130);f(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(e,t,n){const o=i=>({year:i,isTwoDigitYear:t==="yy"});switch(t){case"y":return z(B(4,e),o);case"yo":return z(n.ordinalNumber(e,{unit:"year"}),o);default:return z(B(t.length,e),o)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,n){const o=e.getFullYear();if(n.isTwoDigitYear){const u=nr(n.year,o);return e.setFullYear(u,0,1),e.setHours(0,0,0,0),e}const i=!("era"in t)||t.era===1?n.year:1-n.year;return e.setFullYear(i,0,1),e.setHours(0,0,0,0),e}}class Vn extends E{constructor(){super(...arguments);f(this,"priority",130);f(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(e,t,n){const o=i=>({year:i,isTwoDigitYear:t==="YY"});switch(t){case"Y":return z(B(4,e),o);case"Yo":return z(n.ordinalNumber(e,{unit:"year"}),o);default:return z(B(t.length,e),o)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,n,o){const i=pr(e,o);if(n.isTwoDigitYear){const d=nr(n.year,i);return e.setFullYear(d,0,o.firstWeekContainsDate),e.setHours(0,0,0,0),Qe(e,o)}const u=!("era"in t)||t.era===1?n.year:1-n.year;return e.setFullYear(u,0,o.firstWeekContainsDate),e.setHours(0,0,0,0),Qe(e,o)}}class Qn extends E{constructor(){super(...arguments);f(this,"priority",130);f(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(e,t){return Xe(t==="R"?4:t.length,e)}set(e,t,n){const o=J(e,0);return o.setFullYear(n,0,4),o.setHours(0,0,0,0),Yt(o)}}class Un extends E{constructor(){super(...arguments);f(this,"priority",130);f(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(e,t){return Xe(t==="u"?4:t.length,e)}set(e,t,n){return e.setFullYear(n,0,1),e.setHours(0,0,0,0),e}}class Gn extends E{constructor(){super(...arguments);f(this,"priority",120);f(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(e,t,n){switch(t){case"Q":case"QQ":return B(t.length,e);case"Qo":return n.ordinalNumber(e,{unit:"quarter"});case"QQQ":return n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(e,{width:"wide",context:"formatting"})||n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=1&&t<=4}set(e,t,n){return e.setMonth((n-1)*3,1),e.setHours(0,0,0,0),e}}class Xn extends E{constructor(){super(...arguments);f(this,"priority",120);f(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(e,t,n){switch(t){case"q":case"qq":return B(t.length,e);case"qo":return n.ordinalNumber(e,{unit:"quarter"});case"qqq":return n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(e,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(e,{width:"wide",context:"standalone"})||n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=1&&t<=4}set(e,t,n){return e.setMonth((n-1)*3,1),e.setHours(0,0,0,0),e}}class Jn extends E{constructor(){super(...arguments);f(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);f(this,"priority",110)}parse(e,t,n){const o=i=>i-1;switch(t){case"M":return z(q(N.month,e),o);case"MM":return z(B(2,e),o);case"Mo":return z(n.ordinalNumber(e,{unit:"month"}),o);case"MMM":return n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(e,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(e,{width:"wide",context:"formatting"})||n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=11}set(e,t,n){return e.setMonth(n,1),e.setHours(0,0,0,0),e}}class Zn extends E{constructor(){super(...arguments);f(this,"priority",110);f(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(e,t,n){const o=i=>i-1;switch(t){case"L":return z(q(N.month,e),o);case"LL":return z(B(2,e),o);case"Lo":return z(n.ordinalNumber(e,{unit:"month"}),o);case"LLL":return n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(e,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(e,{width:"wide",context:"standalone"})||n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=11}set(e,t,n){return e.setMonth(n,1),e.setHours(0,0,0,0),e}}function Kn(r,s,e){const t=M(r,e==null?void 0:e.in),n=Ft(t,e)-s;return t.setDate(t.getDate()-n*7),M(t,e==null?void 0:e.in)}class es extends E{constructor(){super(...arguments);f(this,"priority",100);f(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(e,t,n){switch(t){case"w":return q(N.week,e);case"wo":return n.ordinalNumber(e,{unit:"week"});default:return B(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,n,o){return Qe(Kn(e,n,o),o)}}function ts(r,s,e){const t=M(r,e==null?void 0:e.in),n=xr(t,e)-s;return t.setDate(t.getDate()-n*7),t}class rs extends E{constructor(){super(...arguments);f(this,"priority",100);f(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(e,t,n){switch(t){case"I":return q(N.week,e);case"Io":return n.ordinalNumber(e,{unit:"week"});default:return B(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,n){return Yt(ts(e,n))}}const ns=[31,28,31,30,31,30,31,31,30,31,30,31],ss=[31,29,31,30,31,30,31,31,30,31,30,31];class as extends E{constructor(){super(...arguments);f(this,"priority",90);f(this,"subPriority",1);f(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(e,t,n){switch(t){case"d":return q(N.date,e);case"do":return n.ordinalNumber(e,{unit:"date"});default:return B(t.length,e)}}validate(e,t){const n=e.getFullYear(),o=sr(n),i=e.getMonth();return o?t>=1&&t<=ss[i]:t>=1&&t<=ns[i]}set(e,t,n){return e.setDate(n),e.setHours(0,0,0,0),e}}class os extends E{constructor(){super(...arguments);f(this,"priority",90);f(this,"subpriority",1);f(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(e,t,n){switch(t){case"D":case"DD":return q(N.dayOfYear,e);case"Do":return n.ordinalNumber(e,{unit:"date"});default:return B(t.length,e)}}validate(e,t){const n=e.getFullYear();return sr(n)?t>=1&&t<=366:t>=1&&t<=365}set(e,t,n){return e.setMonth(0,n),e.setHours(0,0,0,0),e}}function pt(r,s,e){var j,C,O,l;const t=Wt(),n=(e==null?void 0:e.weekStartsOn)??((C=(j=e==null?void 0:e.locale)==null?void 0:j.options)==null?void 0:C.weekStartsOn)??t.weekStartsOn??((l=(O=t.locale)==null?void 0:O.options)==null?void 0:l.weekStartsOn)??0,o=M(r,e==null?void 0:e.in),i=o.getDay(),d=(s%7+7)%7,p=7-n,x=s<0||s>6?s-(i+p)%7:(d+p)%7-(i+p)%7;return Ke(o,x,e)}class is extends E{constructor(){super(...arguments);f(this,"priority",90);f(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(e,t,n){switch(t){case"E":case"EE":case"EEE":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEE":default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,n,o){return e=pt(e,n,o),e.setHours(0,0,0,0),e}}class cs extends E{constructor(){super(...arguments);f(this,"priority",90);f(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(e,t,n,o){const i=u=>{const d=Math.floor((u-1)/7)*7;return(u+o.weekStartsOn+6)%7+d};switch(t){case"e":case"ee":return z(B(t.length,e),i);case"eo":return z(n.ordinalNumber(e,{unit:"day"}),i);case"eee":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeeee":return n.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeee":default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,n,o){return e=pt(e,n,o),e.setHours(0,0,0,0),e}}class ls extends E{constructor(){super(...arguments);f(this,"priority",90);f(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(e,t,n,o){const i=u=>{const d=Math.floor((u-1)/7)*7;return(u+o.weekStartsOn+6)%7+d};switch(t){case"c":case"cc":return z(B(t.length,e),i);case"co":return z(n.ordinalNumber(e,{unit:"day"}),i);case"ccc":return n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"ccccc":return n.day(e,{width:"narrow",context:"standalone"});case"cccccc":return n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"cccc":default:return n.day(e,{width:"wide",context:"standalone"})||n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=6}set(e,t,n,o){return e=pt(e,n,o),e.setHours(0,0,0,0),e}}function ds(r,s,e){const t=M(r,e==null?void 0:e.in),n=_n(t,e),o=s-n;return Ke(t,o,e)}class us extends E{constructor(){super(...arguments);f(this,"priority",90);f(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(e,t,n){const o=i=>i===0?7:i;switch(t){case"i":case"ii":return B(t.length,e);case"io":return n.ordinalNumber(e,{unit:"day"});case"iii":return z(n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),o);case"iiiii":return z(n.day(e,{width:"narrow",context:"formatting"}),o);case"iiiiii":return z(n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),o);case"iiii":default:return z(n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),o)}}validate(e,t){return t>=1&&t<=7}set(e,t,n){return e=ds(e,n),e.setHours(0,0,0,0),e}}class hs extends E{constructor(){super(...arguments);f(this,"priority",80);f(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(e,t,n){switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,n){return e.setHours(gt(n),0,0,0),e}}class fs extends E{constructor(){super(...arguments);f(this,"priority",80);f(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(e,t,n){switch(t){case"b":case"bb":case"bbb":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,n){return e.setHours(gt(n),0,0,0),e}}class gs extends E{constructor(){super(...arguments);f(this,"priority",80);f(this,"incompatibleTokens",["a","b","t","T"])}parse(e,t,n){switch(t){case"B":case"BB":case"BBB":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,n){return e.setHours(gt(n),0,0,0),e}}class ps extends E{constructor(){super(...arguments);f(this,"priority",70);f(this,"incompatibleTokens",["H","K","k","t","T"])}parse(e,t,n){switch(t){case"h":return q(N.hour12h,e);case"ho":return n.ordinalNumber(e,{unit:"hour"});default:return B(t.length,e)}}validate(e,t){return t>=1&&t<=12}set(e,t,n){const o=e.getHours()>=12;return o&&n<12?e.setHours(n+12,0,0,0):!o&&n===12?e.setHours(0,0,0,0):e.setHours(n,0,0,0),e}}class xs extends E{constructor(){super(...arguments);f(this,"priority",70);f(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(e,t,n){switch(t){case"H":return q(N.hour23h,e);case"Ho":return n.ordinalNumber(e,{unit:"hour"});default:return B(t.length,e)}}validate(e,t){return t>=0&&t<=23}set(e,t,n){return e.setHours(n,0,0,0),e}}class ys extends E{constructor(){super(...arguments);f(this,"priority",70);f(this,"incompatibleTokens",["h","H","k","t","T"])}parse(e,t,n){switch(t){case"K":return q(N.hour11h,e);case"Ko":return n.ordinalNumber(e,{unit:"hour"});default:return B(t.length,e)}}validate(e,t){return t>=0&&t<=11}set(e,t,n){return e.getHours()>=12&&n<12?e.setHours(n+12,0,0,0):e.setHours(n,0,0,0),e}}class ms extends E{constructor(){super(...arguments);f(this,"priority",70);f(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(e,t,n){switch(t){case"k":return q(N.hour24h,e);case"ko":return n.ordinalNumber(e,{unit:"hour"});default:return B(t.length,e)}}validate(e,t){return t>=1&&t<=24}set(e,t,n){const o=n<=24?n%24:n;return e.setHours(o,0,0,0),e}}class bs extends E{constructor(){super(...arguments);f(this,"priority",60);f(this,"incompatibleTokens",["t","T"])}parse(e,t,n){switch(t){case"m":return q(N.minute,e);case"mo":return n.ordinalNumber(e,{unit:"minute"});default:return B(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,n){return e.setMinutes(n,0,0),e}}class vs extends E{constructor(){super(...arguments);f(this,"priority",50);f(this,"incompatibleTokens",["t","T"])}parse(e,t,n){switch(t){case"s":return q(N.second,e);case"so":return n.ordinalNumber(e,{unit:"second"});default:return B(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,n){return e.setSeconds(n,0),e}}class ws extends E{constructor(){super(...arguments);f(this,"priority",30);f(this,"incompatibleTokens",["t","T"])}parse(e,t){const n=o=>Math.trunc(o*Math.pow(10,-t.length+3));return z(B(t.length,e),n)}set(e,t,n){return e.setMilliseconds(n),e}}class js extends E{constructor(){super(...arguments);f(this,"priority",10);f(this,"incompatibleTokens",["t","T","x"])}parse(e,t){switch(t){case"X":return le(ce.basicOptionalMinutes,e);case"XX":return le(ce.basic,e);case"XXXX":return le(ce.basicOptionalSeconds,e);case"XXXXX":return le(ce.extendedOptionalSeconds,e);case"XXX":default:return le(ce.extended,e)}}set(e,t,n){return t.timestampIsSet?e:J(e,e.getTime()-Vt(e)-n)}}class ks extends E{constructor(){super(...arguments);f(this,"priority",10);f(this,"incompatibleTokens",["t","T","X"])}parse(e,t){switch(t){case"x":return le(ce.basicOptionalMinutes,e);case"xx":return le(ce.basic,e);case"xxxx":return le(ce.basicOptionalSeconds,e);case"xxxxx":return le(ce.extendedOptionalSeconds,e);case"xxx":default:return le(ce.extended,e)}}set(e,t,n){return t.timestampIsSet?e:J(e,e.getTime()-Vt(e)-n)}}class Cs extends E{constructor(){super(...arguments);f(this,"priority",40);f(this,"incompatibleTokens","*")}parse(e){return rr(e)}set(e,t,n){return[J(e,n*1e3),{timestampIsSet:!0}]}}class Ts extends E{constructor(){super(...arguments);f(this,"priority",20);f(this,"incompatibleTokens","*")}parse(e){return rr(e)}set(e,t,n){return[J(e,n),{timestampIsSet:!0}]}}const Ds={G:new Yn,y:new Fn,Y:new Vn,R:new Qn,u:new Un,Q:new Gn,q:new Xn,M:new Jn,L:new Zn,w:new es,I:new rs,d:new as,D:new os,E:new is,e:new cs,c:new ls,i:new us,a:new hs,b:new fs,B:new gs,h:new ps,H:new xs,K:new ys,k:new ms,m:new bs,s:new vs,S:new ws,X:new js,x:new ks,t:new Cs,T:new Ts},Ms=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Is=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ss=/^'([^]*?)'?$/,Os=/''/g,Ps=/\S/,_s=/[a-zA-Z]/;function Es(r,s,e,t){var I,y,S,A,H,L,W,V;const n=()=>J((t==null?void 0:t.in)||e,NaN),o=On(),i=(t==null?void 0:t.locale)??o.locale??Qt,u=(t==null?void 0:t.firstWeekContainsDate)??((y=(I=t==null?void 0:t.locale)==null?void 0:I.options)==null?void 0:y.firstWeekContainsDate)??o.firstWeekContainsDate??((A=(S=o.locale)==null?void 0:S.options)==null?void 0:A.firstWeekContainsDate)??1,d=(t==null?void 0:t.weekStartsOn)??((L=(H=t==null?void 0:t.locale)==null?void 0:H.options)==null?void 0:L.weekStartsOn)??o.weekStartsOn??((V=(W=o.locale)==null?void 0:W.options)==null?void 0:V.weekStartsOn)??0;if(!s)return r?n():M(e,t==null?void 0:t.in);const p={firstWeekContainsDate:u,weekStartsOn:d,locale:i},x=[new Wn(t==null?void 0:t.in,e)],j=s.match(Is).map(c=>{const g=c[0];if(g in dt){const k=dt[g];return k(c,i.formatLong)}return c}).join("").match(Ms),C=[];for(let c of j){!(t!=null&&t.useAdditionalWeekYearTokens)&&yr(c)&&wt(c,s,r),!(t!=null&&t.useAdditionalDayOfYearTokens)&&mr(c)&&wt(c,s,r);const g=c[0],k=Ds[g];if(k){const{incompatibleTokens:$}=k;if(Array.isArray($)){const Z=C.find(se=>$.includes(se.token)||se.token===g);if(Z)throw new RangeError(`The format string mustn't contain \`${Z.fullToken}\` and \`${c}\` at the same time`)}else if(k.incompatibleTokens==="*"&&C.length>0)throw new RangeError(`The format string mustn't contain \`${c}\` and any other token at the same time`);C.push({token:g,fullToken:c});const _=k.run(r,c,i.match,p);if(!_)return n();x.push(_.setter),r=_.rest}else{if(g.match(_s))throw new RangeError("Format string contains an unescaped latin alphabet character `"+g+"`");if(c==="''"?c="'":g==="'"&&(c=Rs(c)),r.indexOf(c)===0)r=r.slice(c.length);else return n()}}if(r.length>0&&Ps.test(r))return n();const O=x.map(c=>c.priority).sort((c,g)=>g-c).filter((c,g,k)=>k.indexOf(c)===g).map(c=>x.filter(g=>g.priority===c).sort((g,k)=>k.subPriority-g.subPriority)).map(c=>c[0]);let l=M(e,t==null?void 0:t.in);if(isNaN(+l))return n();const m={};for(const c of O){if(!c.validate(l,p))return n();const g=c.set(l,m,p);Array.isArray(g)?(l=g[0],Object.assign(m,g[1])):l=g}return l}function Rs(r){return r.match(Ss)[1].replace(Os,"'")}function Tt(r,s){const e=M(r,s==null?void 0:s.in);return e.setMinutes(0,0,0),e}function Ls(r,s,e){const[t,n]=et(e==null?void 0:e.in,r,s);return+Tt(t)==+Tt(n)}function qs(r,s,e){const[t,n]=et(e==null?void 0:e.in,r,s);return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()}function As(r,s,e){const[t,n]=et(e==null?void 0:e.in,r,s);return t.getFullYear()===n.getFullYear()}function Bs(r,s,e){const t=+M(r,e==null?void 0:e.in),[n,o]=[+M(s.start,e==null?void 0:e.in),+M(s.end,e==null?void 0:e.in)].sort((i,u)=>i-u);return t>=n&&t<=o}function $s(r,s,e){const t=M(r,e==null?void 0:e.in),n=t.getFullYear(),o=t.getDate(),i=J(r,0);i.setFullYear(n,s,15),i.setHours(0,0,0,0);const u=er(i);return t.setMonth(s,Math.min(o,u)),t}function Ns(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setDate(s),t}function zs(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setHours(s),t}function Hs(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setMilliseconds(s),t}function Ws(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setMinutes(s),t}function Ys(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setSeconds(s),t}function Fs(r,s,e){const t=M(r,e==null?void 0:e.in);return isNaN(+t)?J(r,NaN):(t.setFullYear(s),t)}var Me={},Dt;function Vs(){if(Dt)return Me;Dt=1;var r=ee();Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0;var s=r(te()),e=re();return Me.default=(0,s.default)((0,e.jsx)("path",{d:"m17.21 9-4.38-6.56c-.19-.28-.51-.42-.83-.42-.32 0-.64.14-.83.43L6.79 9H2c-.55 0-1 .45-1 1 0 .09.01.18.04.27l2.54 9.27c.23.84 1 1.46 1.92 1.46h13c.92 0 1.69-.62 1.93-1.46l2.54-9.27L23 10c0-.55-.45-1-1-1zM9 9l3-4.4L15 9zm3 8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"}),"ShoppingBasket"),Me}var Qs=Vs();const Us=ne(Qs);var Ie={},Mt;function Gs(){if(Mt)return Ie;Mt=1;var r=ee();Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.default=void 0;var s=r(te()),e=re();return Ie.default=(0,s.default)((0,e.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart"),Ie}var Xs=Gs();const ar=ne(Xs);var Se={},It;function Js(){if(It)return Se;It=1;var r=ee();Object.defineProperty(Se,"__esModule",{value:!0}),Se.default=void 0;var s=r(te()),e=re();return Se.default=(0,s.default)((0,e.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),Se}var Zs=Js();const xt=ne(Zs);var Oe={},St;function Ks(){if(St)return Oe;St=1;var r=ee();Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.default=void 0;var s=r(te()),e=re();return Oe.default=(0,s.default)([(0,e.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3 6.08 3 3.28 5.64 3.03 9h2.02C5.3 6.75 7.18 5 9.5 5 11.99 5 14 7.01 14 9.5S11.99 14 9.5 14c-.17 0-.33-.03-.5-.05v2.02c.17.02.33.03.5.03 1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19z"},"0"),(0,e.jsx)("path",{d:"M6.47 10.82 4 13.29l-2.47-2.47-.71.71L3.29 14 .82 16.47l.71.71L4 14.71l2.47 2.47.71-.71L4.71 14l2.47-2.47z"},"1")],"SearchOff"),Oe}var ea=Ks();const ta=ne(ea);var Pe={},Ot;function ra(){if(Ot)return Pe;Ot=1;var r=ee();Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.default=void 0;var s=r(te()),e=re();return Pe.default=(0,s.default)((0,e.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),Pe}var na=ra();const sa=ne(na);var _e={},Pt;function aa(){if(Pt)return _e;Pt=1;var r=ee();Object.defineProperty(_e,"__esModule",{value:!0}),_e.default=void 0;var s=r(te()),e=re();return _e.default=(0,s.default)((0,e.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"ReportProblem"),_e}var oa=aa();const ia=ne(oa);var Ee={},_t;function ca(){if(_t)return Ee;_t=1;var r=ee();Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.default=void 0;var s=r(te()),e=re();return Ee.default=(0,s.default)((0,e.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle"),Ee}var la=ca();const da=ne(la);var Re={},Et;function ua(){if(Et)return Re;Et=1;var r=ee();Object.defineProperty(Re,"__esModule",{value:!0}),Re.default=void 0;var s=r(te()),e=re();return Re.default=(0,s.default)((0,e.jsx)("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"}),"Inventory"),Re}var ha=ua();const fa=ne(ha);var Le={},Rt;function ga(){if(Rt)return Le;Rt=1;var r=ee();Object.defineProperty(Le,"__esModule",{value:!0}),Le.default=void 0;var s=r(te()),e=re();return Le.default=(0,s.default)((0,e.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-5 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"}),"Article"),Le}var pa=ga();const xa=ne(pa);var qe={},Lt;function ya(){if(Lt)return qe;Lt=1;var r=ee();Object.defineProperty(qe,"__esModule",{value:!0}),qe.default=void 0;var s=r(te()),e=re();return qe.default=(0,s.default)((0,e.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning"),qe}var ma=ya();const ba=ne(ma);var Ae={},qt;function va(){if(qt)return Ae;qt=1;var r=ee();Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.default=void 0;var s=r(te()),e=re();return Ae.default=(0,s.default)((0,e.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),Ae}var wa=va();const ja=ne(wa);var Be={},At;function ka(){if(At)return Be;At=1;var r=ee();Object.defineProperty(Be,"__esModule",{value:!0}),Be.default=void 0;var s=r(te()),e=re();return Be.default=(0,s.default)((0,e.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),Be}var Ca=ka();const Ta=ne(Ca),Da={1:"搅拌",2:"丹麦",3:"整形",4:"烤炉",5:"冷加工",6:"收银打包",7:"水吧",8:"馅料",9:"小库房"},Ma=ft.forwardRef(function(s,e){return a.jsx(de,{elevation:6,ref:e,variant:"filled",...s})}),Ia=()=>{const[r,s]=h.useState([]),[e,t]=h.useState(!0),[n,o]=h.useState(null),[i,u]=h.useState(""),[d,p]=h.useState([]),[x,j]=h.useState({}),[C,O]=h.useState(!1),[l,m]=h.useState(!1),[I,y]=h.useState(""),[S,A]=h.useState("info"),[H,L]=h.useState(!1),[W,V]=h.useState(null),[c,g]=h.useState(0),k=h.useCallback(async()=>{var w;t(!0),o(null);try{const T=await fetch("/api/ingredients/list",{method:"POST",headers:{"Content-Type":"application/json","x-current-store-id":localStorage.getItem("currentStoreId")},body:JSON.stringify({})});if(!T.ok)throw new Error(`HTTP error! status: ${T.status}`);const v=await T.json();v.success&&Array.isArray(v.data)?(console.log("MobileInventoryCheck - 获取到的原料数据:",v.data),console.log("第一个原料的post字段:",(w=v.data[0])==null?void 0:w.post),s(v.data)):o(v.message||"Failed to load ingredients data.")}catch(T){o(`Error fetching ingredients: ${T.message}`)}finally{t(!1)}},[]);h.useEffect(()=>{k()},[k]),h.useEffect(()=>{if(i&&r.length>0){console.log("MobileInventoryCheck - 选择的岗位:",i),console.log("MobileInventoryCheck - 所有原料数量:",r.length);const w=r.filter((v,D)=>{const P=v.stockByPost&&v.stockByPost[i]&&v.stockByPost[i].quantity>0,Q=Array.isArray(v.post)&&v.post.map(String).includes(String(i));return D<3&&console.log(`原料 ${D}: ${v.name}`,{stockByPost:v.stockByPost,hasStockInPost:P,post:v.post,isAssignedToPost:Q,selectedPost:i,finalResult:P||Q}),P||Q});console.log("MobileInventoryCheck - 过滤后的原料:",w),console.log("MobileInventoryCheck - 过滤后的原料数量:",w.length),p(w);const T={};w.forEach(v=>{let D="";if(v.stockByPost){const P=new Map(Object.entries(v.stockByPost));P.has(i)&&P.get(i)&&typeof P.get(i).quantity=="number"&&(D=P.get(i).quantity.toString())}T[v._id]=D}),j(T)}else p([]),j({})},[i,r]);const $=(w,T="info")=>{y(w),A(T),m(!0)},_=(w,T)=>{T!=="clickaway"&&m(!1)},Z=w=>{u(w.target.value)},se=h.useCallback((w,T)=>{const v=T.replace(/[^0-9.]/g,"");j(D=>({...D,[w]:v}))},[]),fe=w=>{const T=parseFloat(x[w]||0);se(w,(T+1).toString())},ve=w=>{const T=parseFloat(x[w]||0);se(w,Math.max(0,T-1).toString())},he=async()=>{if(!i){$("请先选择一个岗位。","warning");return}const w=d.filter(v=>x[v._id]===""||x[v._id]===void 0),T=d.map(v=>({ingredientId:v._id,ingredientName:v.name,quantity:parseFloat(x[v._id]),unit:v.unit||v.baseUnit||v.min||"g",baseUnit:v.baseUnit||v.min,norms:v.norms})).filter(v=>!isNaN(v.quantity)&&v.quantity>=0);if(T.length===0&&d.length>0){$("没有有效的库存数量被输入。","warning");return}if(w.length>0){g(w.length),V(T),L(!0);return}T.length>0?await we(T):d.length===0&&$("当前岗位没有需要盘点的物料。","info")},we=async w=>{O(!0);try{const T=await fetch("/api/inventory/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:i,stocks:w})}),v=await T.json();if(!T.ok)throw new Error(v.message||"HTTP error!");if(v.success)$(v.message||"库存盘点数据提交成功！","success"),k();else throw new Error(v.message||"库存提交失败")}catch(T){$(`提交失败: ${T.message}`,"error")}finally{O(!1),L(!1)}},ye=()=>{W&&we(W),L(!1)},je=w=>{var T,v,D;return(D=(v=(T=w.stockByPost)==null?void 0:T[i])==null?void 0:v.quantity)!=null&&D.toFixed(2),a.jsx(ze,{sx:{mb:2},children:a.jsxs(He,{children:[a.jsx(b,{variant:"h6",component:"div",children:w.name}),a.jsxs(b,{sx:{mb:1.5},color:"text.secondary",children:["规格: ",w.specs||"N/A"," | 单位:"," ",w.unit||w.baseUnit||w.min||"g"]}),a.jsx(R,{display:"flex",alignItems:"center",children:a.jsx(ke,{fullWidth:!0,label:"实际库存",variant:"outlined",type:"number",value:x[w._id]||"",onChange:P=>se(w._id,P.target.value),InputProps:{startAdornment:a.jsx(Ue,{position:"start",children:a.jsx(Ce,{onClick:()=>ve(w._id),size:"small",children:a.jsx(Sr,{})})}),endAdornment:a.jsx(Ue,{position:"end",children:a.jsx(Ce,{onClick:()=>fe(w._id),size:"small",children:a.jsx(Ir,{})})})}})})]})},w._id)};return a.jsxs($e,{sx:{pb:8,pt:2},children:[a.jsxs(br,{fullWidth:!0,sx:{mb:2},children:[a.jsx(vr,{id:"post-select-label",children:"选择岗位"}),a.jsxs(wr,{labelId:"post-select-label",value:i,label:"选择岗位",onChange:Z,children:[a.jsx(jt,{value:"",children:a.jsx("em",{children:"请选择..."})}),Object.entries(Da).map(([w,T])=>a.jsx(jt,{value:w,children:T},w))]})]}),e&&a.jsx(R,{sx:{display:"flex",justifyContent:"center",my:3},children:a.jsx(ie,{})}),n&&a.jsx(b,{color:"error",align:"center",children:n}),!i&&a.jsx(b,{align:"center",color:"text.secondary",children:"请先选择一个岗位开始盘点。"}),i&&!e&&d.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs(b,{variant:"h6",sx:{mb:2},children:["找到 ",d.length," 个原料需要盘点"]}),a.jsx(Ve,{children:d.map(je)})]}),i&&!e&&d.length===0&&a.jsx(b,{align:"center",color:"text.secondary",sx:{mt:4},children:"当前岗位下没有需要盘点的物料。"}),a.jsx(K,{elevation:3,sx:{position:"fixed",bottom:56,left:0,right:0,p:2,zIndex:1e3},children:a.jsx(oe,{fullWidth:!0,variant:"contained",color:"primary",size:"large",onClick:he,disabled:C||!i||d.length===0,startIcon:C?a.jsx(ie,{size:20,color:"inherit"}):a.jsx(jr,{}),children:C?"正在提交...":"提交盘点"})}),a.jsx(Ut,{open:l,autoHideDuration:6e3,onClose:_,anchorOrigin:{vertical:"top",horizontal:"center"},children:a.jsx(Ma,{onClose:_,severity:S,sx:{width:"100%"},children:I})}),a.jsxs(kr,{open:H,onClose:()=>L(!1),children:[a.jsx(Cr,{children:"确认提交"}),a.jsx(Tr,{children:a.jsxs(Dr,{children:["您有 ",c," ","项物料未填写库存，确定要提交吗？未填写的项目将不会被保存。"]})}),a.jsxs(Mr,{children:[a.jsx(oe,{onClick:()=>L(!1),children:"取消"}),a.jsx(oe,{onClick:ye,color:"primary",autoFocus:!0,children:"确认提交"})]})]})]})},Sa={y:{sectionType:"year",contentType:"digit",maxLength:4},yy:"year",yyy:{sectionType:"year",contentType:"digit",maxLength:4},yyyy:"year",M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMMM:{sectionType:"month",contentType:"letter"},MMM:{sectionType:"month",contentType:"letter"},L:{sectionType:"month",contentType:"digit",maxLength:2},LL:"month",LLL:{sectionType:"month",contentType:"letter"},LLLL:{sectionType:"month",contentType:"letter"},d:{sectionType:"day",contentType:"digit",maxLength:2},dd:"day",do:{sectionType:"day",contentType:"digit-with-letter"},E:{sectionType:"weekDay",contentType:"letter"},EE:{sectionType:"weekDay",contentType:"letter"},EEE:{sectionType:"weekDay",contentType:"letter"},EEEE:{sectionType:"weekDay",contentType:"letter"},EEEEE:{sectionType:"weekDay",contentType:"letter"},i:{sectionType:"weekDay",contentType:"digit",maxLength:1},ii:"weekDay",iii:{sectionType:"weekDay",contentType:"letter"},iiii:{sectionType:"weekDay",contentType:"letter"},e:{sectionType:"weekDay",contentType:"digit",maxLength:1},ee:"weekDay",eee:{sectionType:"weekDay",contentType:"letter"},eeee:{sectionType:"weekDay",contentType:"letter"},eeeee:{sectionType:"weekDay",contentType:"letter"},eeeeee:{sectionType:"weekDay",contentType:"letter"},c:{sectionType:"weekDay",contentType:"digit",maxLength:1},cc:"weekDay",ccc:{sectionType:"weekDay",contentType:"letter"},cccc:{sectionType:"weekDay",contentType:"letter"},ccccc:{sectionType:"weekDay",contentType:"letter"},cccccc:{sectionType:"weekDay",contentType:"letter"},a:"meridiem",aa:"meridiem",aaa:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},Oa={year:"yyyy",month:"LLLL",monthShort:"MMM",dayOfMonth:"d",dayOfMonthFull:"do",weekday:"EEEE",weekdayShort:"EEEEEE",hours24h:"HH",hours12h:"hh",meridiem:"aa",minutes:"mm",seconds:"ss",fullDate:"PP",keyboardDate:"P",shortDate:"MMM d",normalDate:"d MMMM",normalDateWithWeekday:"EEE, MMM d",fullTime12h:"hh:mm aa",fullTime24h:"HH:mm",keyboardDateTime12h:"P hh:mm aa",keyboardDateTime24h:"P HH:mm"};class Pa{constructor(s){this.isMUIAdapter=!0,this.isTimezoneCompatible=!1,this.lib=void 0,this.locale=void 0,this.formats=void 0,this.formatTokenMap=Sa,this.escapedCharacters={start:"'",end:"'"},this.longFormatters=void 0,this.date=i=>typeof i>"u"?new Date:i===null?null:new Date(i),this.getInvalidDate=()=>new Date("Invalid Date"),this.getTimezone=()=>"default",this.setTimezone=i=>i,this.toJsDate=i=>i,this.getCurrentLocaleCode=()=>this.locale.code,this.is12HourCycleInCurrentLocale=()=>/a/.test(this.locale.formatLong.time({width:"short"})),this.expandFormat=i=>{const u=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;return i.match(u).map(d=>{const p=d[0];if(p==="p"||p==="P"){const x=this.longFormatters[p];return x(d,this.locale.formatLong)}return d}).join("")},this.formatNumber=i=>i,this.getDayOfWeek=i=>i.getDay()+1;const{locale:e,formats:t,longFormatters:n,lib:o}=s;this.locale=e,this.formats=F({},Oa,t),this.longFormatters=n,this.lib=o||"date-fns"}}class _a extends Pa{constructor({locale:s,formats:e}={}){super({locale:s??Qt,formats:e,longFormatters:dt}),this.parse=(t,n)=>t===""?null:Es(t,n,new Date,{locale:this.locale}),this.isValid=t=>t==null?!1:Or(t),this.format=(t,n)=>this.formatByString(t,this.formats[n]),this.formatByString=(t,n)=>ut(t,n,{locale:this.locale}),this.isEqual=(t,n)=>t===null&&n===null?!0:t===null||n===null?!1:Bn(t,n),this.isSameYear=(t,n)=>As(t,n),this.isSameMonth=(t,n)=>qs(t,n),this.isSameDay=(t,n)=>In(t,n),this.isSameHour=(t,n)=>Ls(t,n),this.isAfter=(t,n)=>ct(t,n),this.isAfterYear=(t,n)=>ct(t,Ct(n)),this.isAfterDay=(t,n)=>ct(t,Ge(n)),this.isBefore=(t,n)=>lt(t,n),this.isBeforeYear=(t,n)=>lt(t,this.startOfYear(n)),this.isBeforeDay=(t,n)=>lt(t,this.startOfDay(n)),this.isWithinRange=(t,[n,o])=>Bs(t,{start:n,end:o}),this.startOfYear=t=>Pr(t),this.startOfMonth=t=>_r(t),this.startOfWeek=t=>Qe(t,{locale:this.locale}),this.startOfDay=t=>Ne(t),this.endOfYear=t=>Ct(t),this.endOfMonth=t=>Er(t),this.endOfWeek=t=>Rr(t,{locale:this.locale}),this.endOfDay=t=>Ge(t),this.addYears=(t,n)=>Mn(t,n),this.addMonths=(t,n)=>Zt(t,n),this.addWeeks=(t,n)=>Dn(t,n),this.addDays=(t,n)=>Ke(t,n),this.addHours=(t,n)=>kn(t,n),this.addMinutes=(t,n)=>Cn(t,n),this.addSeconds=(t,n)=>Tn(t,n),this.getYear=t=>An(t),this.getMonth=t=>Ln(t),this.getDate=t=>Sn(t),this.getHours=t=>Pn(t),this.getMinutes=t=>Rn(t),this.getSeconds=t=>qn(t),this.getMilliseconds=t=>En(t),this.setYear=(t,n)=>Fs(t,n),this.setMonth=(t,n)=>$s(t,n),this.setDate=(t,n)=>Ns(t,n),this.setHours=(t,n)=>zs(t,n),this.setMinutes=(t,n)=>Ws(t,n),this.setSeconds=(t,n)=>Ys(t,n),this.setMilliseconds=(t,n)=>Hs(t,n),this.getDaysInMonth=t=>er(t),this.getWeekArray=t=>{const n=this.startOfWeek(this.startOfMonth(t)),o=this.endOfWeek(this.endOfMonth(t));let i=0,u=n;const d=[];for(;this.isBefore(u,o);){const p=Math.floor(i/7);d[p]=d[p]||[],d[p].push(u),u=this.addDays(u,1),i+=1}return d},this.getWeekNumber=t=>Ft(t,{locale:this.locale}),this.getYearRange=([t,n])=>{const o=this.startOfYear(t),i=this.endOfYear(n),u=[];let d=o;for(;this.isBefore(d,i);)u.push(d),d=this.addYears(d,1);return u}}}const xe={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected",COMPLETED:"completed"},Ea={[xe.PENDING]:"待处理",[xe.APPROVED]:"已批准",[xe.REJECTED]:"已拒绝",[xe.COMPLETED]:"已完成"},Ra={[xe.PENDING]:"warning",[xe.APPROVED]:"info",[xe.REJECTED]:"error",[xe.COMPLETED]:"success"},Bt=r=>Ra[r]||"warning",La=({storeId:r,user:s})=>{const[e,t]=h.useState([]),[n,o]=h.useState(!0),[i,u]=h.useState(""),[d,p]=h.useState(Ne(new Date)),[x,j]=h.useState(Ge(new Date)),[C,O]=h.useState(""),[l,m]=h.useState(!0),[I,y]=h.useState(!1),[S,A]=h.useState(new Set),H=h.useCallback(async()=>{if(r){o(!0),u("");try{const c=ut(d,"yyyy-MM-dd"),g=ut(x,"yyyy-MM-dd"),k=await fetch(`/api/transfer-requests?startDate=${c}&endDate=${g}`);if(!k.ok){const _=await k.json();throw new Error(_.message||"获取申请记录失败")}const $=await k.json();t($.sort((_,Z)=>new Date(Z.createdAt)-new Date(_.createdAt)))}catch(c){u(c.message)}finally{o(!1)}}},[r,d,x]);h.useEffect(()=>{H()},[H]),h.useEffect(()=>{(async()=>{var g;if(!(!r||!(s!=null&&s.name)))try{const k=await fetch(`/api/stores/${r}`);if(k.ok){const _=((g=(await k.json()).data)==null?void 0:g.warehouseManagers)||[];y(_.includes(s.name))}}catch(k){console.error("检查库管权限失败:",k)}})()},[r,s]);const L=h.useMemo(()=>{const c=C.trim().toLowerCase();return c?e.filter(g=>g.requestedBy&&g.requestedBy.toLowerCase().includes(c)):e},[e,C]),W=h.useMemo(()=>{if(!l)return null;const c=new Map,g=new Set;return L.forEach(k=>{g.add(k.requestedBy||"未知"),k.items.forEach($=>{const _=$.name;if(c.has(_)){const Z=c.get(_);Z.quantity+=$.quantity,Z.requesters.add(k.requestedBy||"未知")}else c.set(_,{name:$.name,unit:$.unit,quantity:$.quantity,requesters:new Set([k.requestedBy||"未知"])})})}),{items:Array.from(c.values()).map(k=>({...k,requesters:Array.from(k.requesters)})),totalRequesters:g.size,totalRequests:L.length}},[L,l]),V=async c=>{if(!(s!=null&&s.name)){alert("用户信息缺失");return}A(g=>new Set(g).add(c));try{const g=await fetch(`/api/transfer-requests/${c}/mobile-approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:s.name})}),k=await g.json();g.ok?(alert("申请已批准！"),H()):alert(k.message||"批准失败")}catch(g){console.error("批准申请失败:",g),alert("批准申请时发生错误")}finally{A(g=>{const k=new Set(g);return k.delete(c),k})}};return a.jsx(Lr,{dateAdapter:_a,children:a.jsxs(R,{children:[a.jsx(b,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:"所有申请单据"}),a.jsx(K,{sx:{p:2,mb:2},children:a.jsxs(ae,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(ae,{item:!0,xs:6,children:a.jsx(kt,{label:"开始日期",value:d,onChange:c=>p(Ne(c)),renderInput:c=>a.jsx(ke,{...c,fullWidth:!0,size:"small"})})}),a.jsx(ae,{item:!0,xs:6,children:a.jsx(kt,{label:"结束日期",value:x,onChange:c=>j(Ge(c)),renderInput:c=>a.jsx(ke,{...c,fullWidth:!0,size:"small"})})}),a.jsx(ae,{item:!0,xs:12,children:a.jsx(ke,{fullWidth:!0,size:"small",label:"按申请人姓名过滤",placeholder:"输入申请人姓名...",value:C,onChange:c=>O(c.target.value),variant:"outlined"})}),a.jsxs(ae,{item:!0,xs:12,children:[a.jsx(Gt,{sx:{my:1}}),a.jsx(qr,{control:a.jsx(jn,{checked:l,onChange:c=>m(c.target.checked),color:"primary"}),label:"聚合模式 - 按物料汇总当天所有申请"})]})]})}),n&&a.jsx(R,{sx:{display:"flex",justifyContent:"center",my:4},children:a.jsx(ie,{})}),i&&a.jsx(de,{severity:"error",sx:{my:2},children:i}),!n&&!i&&(L.length===0?a.jsxs(K,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[a.jsx(xt,{sx:{fontSize:48,color:"text.secondary"}}),a.jsx(b,{variant:"h6",color:"text.secondary",sx:{mt:1},children:C.trim()?"没有找到匹配的申请记录":"该日期范围内没有申请记录"})]}):l?a.jsxs(R,{children:[a.jsxs(K,{sx:{p:2,mb:2,bgcolor:"info.50"},children:[a.jsx(b,{variant:"h6",color:"info.main",gutterBottom:!0,children:"物料汇总统计"}),a.jsxs(ae,{container:!0,spacing:2,children:[a.jsxs(ae,{item:!0,xs:4,children:[a.jsx(b,{variant:"body2",color:"text.secondary",children:"总申请人数"}),a.jsx(b,{variant:"h6",children:W.totalRequesters})]}),a.jsxs(ae,{item:!0,xs:4,children:[a.jsx(b,{variant:"body2",color:"text.secondary",children:"总申请单数"}),a.jsx(b,{variant:"h6",children:W.totalRequests})]}),a.jsxs(ae,{item:!0,xs:4,children:[a.jsx(b,{variant:"body2",color:"text.secondary",children:"物料种类"}),a.jsx(b,{variant:"h6",children:W.items.length})]})]})]}),W.items.map((c,g)=>a.jsx(ze,{sx:{mb:2,boxShadow:2,borderRadius:2},variant:"outlined",children:a.jsxs(He,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[a.jsxs(R,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[a.jsx(b,{variant:"h6",sx:{fontWeight:"bold"},children:c.name}),a.jsx(ht,{label:`总计: ${c.quantity} ${c.unit||""}`,color:"primary",variant:"outlined"})]}),a.jsxs(b,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["申请人: ",c.requesters.join(", ")]}),a.jsxs(b,{variant:"caption",color:"text.secondary",children:["共 ",c.requesters.length," 人申请"]})]})},g))]}):L.map(c=>a.jsxs(ze,{sx:{mb:2,boxShadow:2,borderRadius:2,borderLeft:"4px solid",borderColor:`${Bt(c.status)}.main`},variant:"outlined",children:[a.jsxs(He,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[a.jsxs(R,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1.5},children:[a.jsxs(R,{children:[a.jsxs(b,{variant:"body1",sx:{fontWeight:"bold"},children:["申请人: ",c.requestedBy||"未知"]}),a.jsx(b,{variant:"caption",color:"text.secondary",display:"block",children:new Date(c.createdAt).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),a.jsx(ht,{label:Ea[c.status]||c.status,color:Bt(c.status),size:"small",sx:{mt:.5}})]}),a.jsx(Ve,{dense:!0,sx:{mt:1,p:0},children:c.items.map((g,k)=>a.jsx(rt,{sx:{py:.25,px:0},children:a.jsx(nt,{primary:g.name,secondary:`x ${g.quantity} ${g.unit||""}`,primaryTypographyProps:{variant:"body1"},secondaryTypographyProps:{variant:"body2",color:"text.secondary"}})},k))}),c.notes&&a.jsxs(b,{variant:"body2",sx:{mt:1.5,fontStyle:"italic",color:"text.secondary",p:1.5,backgroundColor:"grey.100",borderRadius:1},children:["备注: ",c.notes]})]}),I&&c.status==="pending"&&a.jsx(Xt,{sx:{pt:0,px:1.5,pb:1.5},children:a.jsx(oe,{variant:"contained",color:"success",size:"small",onClick:()=>V(c._id),disabled:S.has(c._id),startIcon:S.has(c._id)?a.jsx(ie,{size:16}):null,children:S.has(c._id)?"批准中...":"批准申请"})})]},c._id)))]})})},qa=({onStoreSelect:r,storageKey:s="defaultStoreId"})=>{const[e,t]=h.useState([]),[n,o]=h.useState(!0),[i,u]=h.useState("");h.useEffect(()=>{(async()=>{try{const x=await fetch("/api/stores");if(!x.ok)throw new Error("获取门店列表失败");const j=await x.json();if(j.success)t(j.data);else throw new Error(j.message||"未能加载门店数据")}catch(x){u(x.message)}finally{o(!1)}})()},[]);const d=p=>{localStorage.setItem(s,p),r(p)};return n?a.jsxs(R,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:[a.jsx(ie,{}),a.jsx(b,{sx:{ml:2},children:"正在加载门店列表..."})]}):i?a.jsx(de,{severity:"error",sx:{m:2},children:i}):a.jsxs(K,{sx:{m:2,p:2},children:[a.jsx(b,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center"},children:"请选择您的门店"}),a.jsx(b,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",mb:2},children:"您的选择将被记住，下次访问时将直接进入该门店。"}),a.jsx(Ve,{component:"nav","aria-label":"门店列表",children:e.map((p,x)=>a.jsxs(ft.Fragment,{children:[a.jsx(rt,{disablePadding:!0,children:a.jsxs(gn,{onClick:()=>d(p._id),children:[a.jsx(Ar,{children:a.jsx(Br,{})}),a.jsx(nt,{primary:p.name})]})}),x<e.length-1&&a.jsx(Gt,{})]},p._id))})]})},Aa=({pendingRequests:r,onBulkApprove:s,bulkApproving:e,expanded:t,onToggleExpand:n,user:o})=>{if(r.length===0)return null;const i=r.reduce((u,d)=>u+d.items.length,0);return a.jsxs(de,{severity:"warning",sx:{mb:2,"& .MuiAlert-message":{width:"100%"}},icon:a.jsx(ba,{}),action:a.jsxs(R,{sx:{display:"flex",gap:1,alignItems:"center"},children:[a.jsx(oe,{color:"inherit",size:"small",onClick:s,disabled:e,startIcon:e?a.jsx(ie,{size:16}):a.jsx(ja,{}),children:e?"批准中...":"一键批准"}),a.jsx(Ce,{size:"small",onClick:n,color:"inherit",children:t?a.jsx(Ta,{}):a.jsx(Nr,{})})]}),children:[a.jsxs(b,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:["⚠️ 有 ",r.length," 个申请待批准，影响 ",i," 个物料的库存显示"]}),a.jsx($r,{in:t,children:a.jsxs(R,{sx:{mt:2},children:[a.jsxs(b,{variant:"body2",sx:{mb:2,color:"text.secondary"},children:[a.jsx("strong",{children:"未批准申请的影响："}),a.jsx("br",{}),"• 占用虚拟库存，影响其他人申请",a.jsx("br",{}),"• 库存显示不准确，可能导致缺货",a.jsx("br",{}),"• 延误生产计划和配送安排"]}),a.jsx(b,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"待批准申请详情："}),r.slice(0,3).map(u=>a.jsxs(R,{sx:{mb:1,p:1,bgcolor:"rgba(255, 152, 0, 0.1)",borderRadius:1,fontSize:"0.875rem"},children:[a.jsxs(b,{variant:"caption",display:"block",children:["申请单 #",u._id.slice(-6)," - ",u.requestedBy||"未知用户"]}),a.jsxs(b,{variant:"caption",color:"text.secondary",children:[u.items.length," 个物料 | ",new Date(u.createdAt).toLocaleDateString()]})]},u._id)),r.length>3&&a.jsxs(b,{variant:"caption",color:"text.secondary",children:["还有 ",r.length-3," 个申请..."]})]})})]})},Ba=()=>{const[r,s]=h.useState(null),[e,t]=h.useState(!0),[n,o]=h.useState(""),[i,u]=h.useState(!1),[d,p]=h.useState(!0);return h.useEffect(()=>{const j=(m=>new URLSearchParams(window.location.search).get(m))("appId");console.log("--- [Feishu Auth Hook] Initializing ---"),console.log(`- appId from URL: ${j}`);let C=0;const O=6,l=setInterval(()=>{if(console.log(`- Polling for SDK, check #${C+1}`),window.h5sdk&&window.tt){clearInterval(l),console.log("- SDK found! Proceeding with auth."),u(!0),p(!1);const m=localStorage.getItem("user");if(m&&m!=="undefined"){console.log("- Found user in localStorage. Skipping auth flow."),s(JSON.parse(m)),t(!1);return}if(console.log("- No user in localStorage."),!j){console.error("[Feishu Auth Hook Error] appId is missing from URL."),o("URL中缺少appId参数。"),t(!1);return}window.h5sdk.ready(()=>{console.log("- h5sdk is ready. Calling tt.requestAccess."),console.log(`- Passing appId to tt.requestAccess: ${j}`);const I=setTimeout(()=>{console.error("[Feishu Auth Hook Error] tt.requestAccess timed out after 5 seconds."),o("飞书授权请求超时，请稍后重试。"),t(!1)},1e4);tt.requestAccess({appID:j,scopeList:[],success:y=>{clearTimeout(I),console.log("- tt.requestAccess succeeded. Code:",y.code),console.log("- Sending code to backend..."),fetch("/api/feishu/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:y.code,appID:j})}).then(S=>{if(!S.ok)throw console.error("[Feishu Auth Hook Error] Backend fetch failed.",S),new Error("获取用户信息失败");return S.json()}).then(S=>{console.log("- Backend returned user data:",S),localStorage.setItem("user",JSON.stringify(S)),s(S)}).catch(S=>{console.error("[Feishu Auth Hook Error] Error in fetch chain:",S),o(S.message)}).finally(()=>t(!1))},fail:y=>{clearTimeout(I),console.error("[Feishu Auth Hook Error] tt.requestAccess failed:",y),o(`飞书授权失败: ${JSON.stringify(y)}`),t(!1)}})})}else C++,C>=O&&(clearInterval(l),console.warn("[Feishu Auth Hook] SDK polling timed out."),p(!1),u(!1),t(!1))},500);return()=>clearInterval(l)},[]),{user:r,loading:e,error:n,isFeishuEnv:i,checkingEnv:d}},$a=({onAddToCart:r,onUpdateCart:s,cartItems:e,ingredients:t,loading:n,error:o})=>{const[i,u]=h.useState([]),[d,p]=h.useState("all"),[x,j]=h.useState("");h.useEffect(()=>{u(t),p("all")},[t]),h.useEffect(()=>{let l=t;d!=="all"&&(l=l.filter(m=>{var I;return(I=m.ingredient.post)==null?void 0:I.includes(Number(d))})),x.trim()&&(l=l.filter(m=>m.ingredient.name.toLowerCase().includes(x.toLowerCase().trim())||m.ingredient.specs&&m.ingredient.specs.toLowerCase().includes(x.toLowerCase().trim()))),u(l)},[d,t,x]);const C=l=>{const m=e.find(y=>y.ingredientId===l.ingredient._id);if((m?m.quantity:0)+1>l.virtualStock){alert("申请数量超过可用库存");return}r({ingredientId:l.ingredient._id,name:l.ingredient.name,quantity:1,unit:l.ingredient.unit})},O=l=>{if(!e.find(y=>y.ingredientId===l.ingredient._id))return;const I=e.map(y=>y.ingredientId===l.ingredient._id?{...y,quantity:y.quantity-1}:y).filter(y=>y.quantity>0);s(I)};return a.jsxs(R,{children:[a.jsx(b,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:"申领中心"}),a.jsxs(K,{sx:{p:1.5,mb:2,position:"sticky",top:0,zIndex:1,backgroundColor:"background.paper"},children:[a.jsx(ke,{fullWidth:!0,size:"small",placeholder:"搜索原料名称或规格...",value:x,onChange:l=>j(l.target.value),sx:{mb:2},InputProps:{startAdornment:a.jsx(Ue,{position:"start",children:a.jsx(zr,{color:"action"})}),endAdornment:x&&a.jsx(Ue,{position:"end",children:a.jsx(Ce,{size:"small",onClick:()=>j(""),edge:"end",children:a.jsx(sa,{})})})}}),a.jsx(b,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold"},children:"按岗位筛选"}),a.jsxs(R,{sx:{position:"relative"},children:[a.jsx(R,{sx:{overflowX:"auto",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},children:a.jsxs(R,{sx:{display:"flex",gap:1,py:.5,pr:"30px"},children:[a.jsx(oe,{size:"small",variant:d==="all"?"contained":"outlined",onClick:()=>p("all"),children:"全部"}),Object.entries(Hr).map(([l,m])=>a.jsx(oe,{size:"small",variant:d===l?"contained":"outlined",onClick:()=>p(l),sx:{flexShrink:0},children:m},l))]})}),a.jsx(R,{sx:{position:"absolute",top:0,right:0,width:"30px",height:"100%",background:l=>`linear-gradient(to left, ${l.palette.background.paper}, transparent)`,pointerEvents:"none"}})]})]}),n&&a.jsx(R,{sx:{display:"flex",justifyContent:"center",my:4},children:a.jsx(ie,{})}),o&&a.jsx(de,{severity:"error",children:o}),!n&&!o&&(i.length>0?a.jsx(ae,{container:!0,spacing:2,children:i.map(l=>{const m=l.ingredient._id,I=e.find(y=>y.ingredientId===m);return a.jsx(ae,{item:!0,xs:12,children:a.jsxs(ze,{sx:{display:"flex",flexDirection:"column",boxShadow:3,borderRadius:2},children:[a.jsxs(He,{sx:{flexGrow:1,p:1.5},children:[a.jsx(b,{gutterBottom:!0,variant:"h6",component:"h2",sx:{fontSize:"1rem",fontWeight:"bold"},children:l.ingredient.name}),a.jsxs(b,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["规格: ",l.ingredient.specs||"无"]}),a.jsxs(b,{variant:"body2",color:"text.secondary",children:["可用库存: ",l.virtualStock," ",l.ingredient.unit]})]}),a.jsx(Xt,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",p:1.5,pt:0},children:I?a.jsxs(R,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(Ce,{color:"primary",onClick:()=>O(l),size:"small",children:a.jsx(Wr,{})}),a.jsx(b,{variant:"h6",component:"span",children:I.quantity}),a.jsx(Ce,{color:"primary",onClick:()=>C(l),size:"small",disabled:I.quantity>=l.virtualStock,children:a.jsx(Yr,{})})]}):a.jsx(oe,{variant:"contained",size:"medium",onClick:()=>C(l),children:"加入购物车"})})]})},m)})}):a.jsxs(K,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[a.jsx(ta,{sx:{fontSize:48,color:"text.secondary"}}),a.jsx(b,{variant:"h6",color:"text.secondary",sx:{mt:1},children:x.trim()?"未找到匹配的物料":d==="all"?"暂无可用物料":"当前筛选下没有物料"}),x.trim()?a.jsx(b,{variant:"body1",color:"text.secondary",sx:{mt:1},children:"尝试修改搜索关键词或清空搜索条件。"}):d!=="all"&&a.jsx(b,{variant:"body1",color:"text.secondary",sx:{mt:1},children:"尝试选择其他岗位或“全部”。"})]}))]})},Na=({user:r,cartItems:s,onUpdateCart:e,storeId:t,refetchData:n})=>{const[o,i]=h.useState(!1),[u,d]=h.useState(""),[p,x]=h.useState(""),j=(l,m)=>{const I=[...s];I[l].quantity=Number(m),e(I.filter(y=>y.quantity>0))},C=l=>{const m=[...s];m.splice(l,1),e(m)},O=async()=>{if(s.length===0){d("购物车是空的！");return}i(!0),d(""),x("");try{const[l,m]=await Promise.all([fetch("/api/warehouse/stock",{headers:{"x-current-store-id":t}}),fetch("/api/transfer-requests",{headers:{"x-current-store-id":t}})]);if(!l.ok)throw new Error("无法获取最新库存信息进行校验");if(!m.ok)throw new Error("无法获取最新申请信息进行校验");const I=await l.json(),y=await m.json(),S={};y.filter(c=>c.status==="pending").forEach(c=>{c.items.forEach(g=>{S[g.ingredientId]=(S[g.ingredientId]||0)+g.quantity})});const A=new Map;(I.items||[]).forEach(c=>{if(c.mainWarehouseStock){const g=S[c.ingredient._id]||0,k=c.mainWarehouseStock.quantity-g;A.set(c.ingredient._id,k>0?k:0)}});const H=s.filter(c=>{const g=A.get(c.ingredientId);return c.quantity>(g===void 0?0:g)});if(H.length>0){const c=H.map(g=>g.name).join(", ");throw new Error(`库存不足或物料已下架: ${c}。请返回修改数量或移除物料。`)}const W={items:s.map(c=>({ingredientId:c.ingredientId,name:c.name,unit:c.unit,quantity:c.quantity})),requestedBy:(r==null?void 0:r.name)||"未知飞书用户"},V=await fetch("/api/transfer-requests",{method:"POST",headers:{"Content-Type":"application/json","x-current-store-id":t},body:JSON.stringify(W)});if(!V.ok){const c=await V.json();throw new Error(c.message||"提交申请失败")}x("您的调拨申请已成功提交！"),e([]),n&&n()}catch(l){d(l.message)}finally{i(!1),setTimeout(()=>{x(""),d("")},5e3)}};return a.jsxs(R,{children:[a.jsx(b,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:"我的购物车"}),u&&a.jsx(de,{severity:"error",sx:{mb:2},children:u}),p&&a.jsx(de,{severity:"success",sx:{mb:2},children:p}),s.length===0&&!p?a.jsxs(K,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[a.jsx(ar,{sx:{fontSize:48,color:"text.secondary"}}),a.jsx(b,{variant:"h6",color:"text.secondary",sx:{mt:1},children:"购物车是空的"})]}):a.jsx(Ve,{children:s.map((l,m)=>a.jsxs(rt,{divider:!0,secondaryAction:a.jsx(oe,{edge:"end",color:"error",size:"small",onClick:()=>C(m),children:"删除"}),children:[a.jsx(nt,{primary:a.jsx(b,{variant:"body1",sx:{fontWeight:500},children:l.name})}),a.jsxs(R,{sx:{display:"flex",alignItems:"center",mx:2},children:[a.jsx(ke,{type:"number",size:"small",variant:"outlined",value:l.quantity,onChange:I=>j(m,I.target.value),sx:{width:"70px"},inputProps:{min:1}}),a.jsx(b,{variant:"body1",component:"span",sx:{ml:1.5,minWidth:"30px",textAlign:"left"},children:l.unit})]})]},`${l.ingredientId}-${m}`))}),s.length>0&&a.jsxs(K,{elevation:3,sx:{p:2,mt:2,position:"sticky",bottom:60,zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.95)"},children:[a.jsxs(b,{variant:"h6",sx:{mb:2},children:["总计: ",s.reduce((l,m)=>l+m.quantity,0)," 件"]}),a.jsx(oe,{fullWidth:!0,variant:"contained",color:"primary",size:"large",onClick:O,disabled:o,children:o?a.jsx(ie,{size:24,color:"inherit"}):"提交申请"})]})]})},za=({requests:r,loading:s,error:e,user:t,storeId:n})=>{const[o,i]=h.useState(!1),[u,d]=h.useState([]),[p,x]=h.useState(!1),j=y=>{switch(y){case"completed":return"success";case"approved":return"info";case"rejected":return"error";case"pending":default:return"warning"}},C={pending:"待处理",approved:"已批准",rejected:"已拒绝",completed:"已完成"},O=async()=>{if(n){x(!0);try{const y=await fetch("/api/transfer-requests",{headers:{"x-current-store-id":n}});if(!y.ok)throw new Error("获取所有申请记录失败");const S=await y.json();d(S.sort((A,H)=>new Date(H.createdAt)-new Date(A.createdAt)))}catch(y){console.error("获取所有申请记录失败:",y)}finally{x(!1)}}},l=()=>{o||O(),i(!o)},m=o?u:r,I=o?p:s;return a.jsxs(R,{children:[a.jsx(b,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:o?"所有申请记录":"我的申请记录"}),a.jsx(R,{sx:{display:"flex",justifyContent:"center",mb:2},children:a.jsx(oe,{variant:o?"outlined":"contained",onClick:l,size:"small",children:o?"只看我的申请":"查看所有申请"})}),I&&a.jsx(R,{sx:{display:"flex",justifyContent:"center",my:4},children:a.jsx(ie,{})}),e&&a.jsx(de,{severity:"error",children:e}),!I&&!e&&(m.length===0?a.jsxs(K,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[a.jsx(xt,{sx:{fontSize:48,color:"text.secondary"}}),a.jsx(b,{variant:"h6",color:"text.secondary",sx:{mt:1},children:o?"暂无申请记录":"暂无我的申请记录"})]}):m.map(y=>a.jsx(ze,{sx:{mb:2,boxShadow:2,borderRadius:2,borderLeft:"4px solid",borderColor:`${j(y.status)}.main`},variant:"outlined",children:a.jsxs(He,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[a.jsxs(R,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1.5},children:[a.jsxs(R,{children:[a.jsxs(b,{variant:"body1",sx:{fontWeight:"bold"},children:["申请单 #",y._id.slice(-6)]}),o&&a.jsxs(b,{variant:"body2",color:"primary",sx:{fontWeight:"medium"},children:["申请人: ",y.requestedBy||"未知"]}),a.jsx(b,{variant:"caption",color:"text.secondary",display:"block",children:new Date(y.createdAt).toLocaleString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),a.jsx(ht,{label:C[y.status]||y.status,color:j(y.status),size:"small",sx:{mt:.5}})]}),a.jsx(Ve,{dense:!0,sx:{mt:1,p:0},children:y.items.map((S,A)=>a.jsx(rt,{sx:{py:.25,px:0},children:a.jsx(nt,{primary:S.name,secondary:`x ${S.quantity} ${S.unit||""}`,primaryTypographyProps:{variant:"body1",fontWeight:"medium"},secondaryTypographyProps:{variant:"body2",color:"text.secondary"}})},A))}),y.notes&&a.jsxs(b,{variant:"body2",sx:{mt:1.5,fontStyle:"italic",color:"text.secondary",p:1.5,backgroundColor:"grey.100",borderRadius:1},children:["备注: ",y.notes]})]})},y._id)))]})},Ha=()=>{const[r,s]=h.useState(null),[e,t]=h.useState("shop"),[n,o]=h.useState([]),[i,u]=h.useState(""),[d,p]=h.useState(!0),[x,j]=h.useState([]),[C,O]=h.useState([]),[l,m]=h.useState([]),[I,y]=h.useState(!1),[S,A]=h.useState(!1),[H,L]=h.useState(!1),[W,V]=h.useState(!1),[c,g]=h.useState(""),[k,$]=h.useState("info"),{user:_,loading:Z,error:se,isFeishuEnv:fe,checkingEnv:ve}=Ba();h.useEffect(()=>{const D=new URLSearchParams(window.location.search).get("store");if(D){console.log(`[Mobile Page] Found store in URL: ${D}. Locking it in sessionStorage.`),sessionStorage.setItem("lockedStoreId",D),s(D);return}const P=sessionStorage.getItem("lockedStoreId");if(P){console.log(`[Mobile Page] Found locked storeId in sessionStorage: ${P}.`),s(P);return}const Q=localStorage.getItem("defaultStoreId");if(Q){console.log(`[Mobile Page] Found default storeId in localStorage: ${Q}.`),s(Q);return}console.log("[Mobile Page] No storeId found. Waiting for user selection.")},[]);const he=h.useCallback(async()=>{if(r){p(!0),u("");try{const[D,P]=await Promise.all([fetch("/api/warehouse/stock",{headers:{"x-current-store-id":r}}),fetch("/api/transfer-requests",{headers:{"x-current-store-id":r}})]);if(!D.ok)throw new Error("获取物料列表失败");if(!P.ok)throw new Error("获取申请记录失败");const Q=await D.json(),U=await P.json(),st=U.filter(G=>G.requestedBy===(_==null?void 0:_.name));O(st.sort((G,me)=>new Date(me.createdAt)-new Date(G.createdAt)));const yt=U.filter(G=>G.status==="pending");m(yt),y(yt.length>0);const at={};U.filter(G=>G.status==="pending").forEach(G=>{G.items.forEach(me=>{at[me.ingredientId]=(at[me.ingredientId]||0)+me.quantity})});const or=(Q.items||[]).filter(G=>G.mainWarehouseStock&&G.mainWarehouseStock.quantity>0).map(G=>{const me=at[G.ingredient._id]||0,mt=G.mainWarehouseStock.quantity-me;return{...G,virtualStock:mt>0?mt:0}});j(or)}catch(D){u(D.message)}finally{p(!1)}}},[r]);h.useEffect(()=>{fe&&_&&r&&he()},[fe,_,r,he]);const we=D=>{o(P=>P.find(U=>U.ingredientId===D.ingredientId)?P.map(U=>U.ingredientId===D.ingredientId?{...U,quantity:U.quantity+D.quantity}:U):[...P,D])},ye=D=>{o(D)},je=(D,P)=>{t(P)},w=(D,P="info")=>{g(D),$(P),V(!0)},T=async()=>{if(l.length===0){w("没有待批准的申请","info");return}L(!0);try{const D=l.map(U=>U._id),P=await fetch("/api/transfer-requests/bulk-approve",{method:"POST",headers:{"Content-Type":"application/json","x-current-store-id":r},body:JSON.stringify({requestIds:D})});if(!P.ok){const U=await P.json();throw new Error(U.message||"批准申请失败")}const Q=await P.json();w(Q.message||"批准成功！","success"),he()}catch(D){console.error("批准申请失败:",D),w(`批准失败: ${D.message}`,"error")}finally{L(!1)}},v=()=>{if(d&&e!=="all-requests")return a.jsx(R,{sx:{display:"flex",justifyContent:"center",my:4},children:a.jsx(ie,{})});switch(e){case"cart":return a.jsx(Na,{user:_,cartItems:n,onUpdateCart:ye,storeId:r,refetchData:he});case"history":return a.jsx(za,{requests:C,loading:d,error:i,user:_,storeId:r});case"inventory":return a.jsx(Ia,{});case"all-requests":return a.jsx(La,{storeId:r,user:_});case"shop":default:return a.jsx($a,{onAddToCart:we,onUpdateCart:ye,cartItems:n,ingredients:x,loading:d,error:i,refetchData:he})}};return ve||Z?a.jsxs($e,{sx:{mt:4,textAlign:"center"},children:[a.jsx(ie,{}),a.jsx(b,{sx:{mt:2},children:ve?"正在检查运行环境...":"正在获取用户信息..."})]}):fe?se?a.jsx($e,{sx:{mt:2},children:a.jsx(de,{severity:"error",children:se})}):r?a.jsxs(R,{sx:{pb:7},children:[a.jsxs($e,{children:[a.jsxs(R,{sx:{display:"flex",alignItems:"center",p:1,mb:1},children:[a.jsx(da,{sx:{color:"action.active",mr:1}}),a.jsxs(b,{variant:"subtitle1",children:["欢迎, ",(_==null?void 0:_.name)||"用户"]})]}),I&&a.jsx(Aa,{pendingRequests:l,onBulkApprove:T,bulkApproving:H,expanded:S,onToggleExpand:()=>A(!S),user:_}),v()]}),a.jsx(K,{sx:{position:"fixed",bottom:0,left:0,right:0},elevation:3,children:a.jsxs(nn,{showLabels:!0,value:e,onChange:je,children:[a.jsx(De,{label:"申领中心",value:"shop",icon:a.jsx(Us,{})}),a.jsx(De,{label:"购物车",value:"cart",icon:a.jsx(Zr,{badgeContent:n.length,color:"primary",children:a.jsx(ar,{})})}),a.jsx(De,{label:"我的申请",value:"history",icon:a.jsx(xt,{})}),a.jsx(De,{label:"所有申请",value:"all-requests",icon:a.jsx(xa,{})}),a.jsx(De,{label:"库存盘点",value:"inventory",icon:a.jsx(fa,{})})]})}),a.jsx(Ut,{open:W,autoHideDuration:6e3,onClose:()=>V(!1),anchorOrigin:{vertical:"top",horizontal:"center"},children:a.jsx(de,{onClose:()=>V(!1),severity:k,sx:{width:"100%"},children:c})})]}):a.jsx(qa,{onStoreSelect:s}):a.jsx($e,{sx:{mt:4},children:a.jsxs(K,{sx:{p:3,textAlign:"center",backgroundColor:"warning.light"},children:[a.jsx(ia,{sx:{fontSize:48,color:"warning.main"}}),a.jsx(b,{variant:"h5",sx:{mt:2,fontWeight:"bold"},children:"请在飞书客户端中打开"}),a.jsx(b,{sx:{mt:1},children:"此页面需要飞书应用环境支持，请复制链接并在飞书中访问。"})]})})},Wa=window.fetch;window.fetch=function(r,s){const e=sessionStorage.getItem("lockedStoreId"),t=localStorage.getItem("defaultStoreId"),n=e||t,o={...s};return o.headers||(o.headers={}),n&&!o.headers["x-current-store-id"]&&(o.headers["x-current-store-id"]=n),Wa(r,o)};Fr.createRoot(document.getElementById("root")).render(a.jsx(ft.StrictMode,{children:a.jsx(Ha,{})}));
