import{n as vt,g as De,d as ze,r as n,e as Ee,b as _e,_ as N,a4 as Ke,i as ce,s as ee,j as e,l as M,k as qe,B as mt,bf as Xe,a1 as wt,v as It,bg as Rt,H as Ot,F as ae,bh as xe,S as Pt,au as H,av as U,aw as J,ax as G,a7 as Ue,a8 as Y,ab as Pe,ae as At,af as $t,ag as Et,ah as Ze,ac as P,aa as X,ad as p,aJ as Be,P as V,ai as K,aO as _t,a9 as yt,ap as qt,aq as Bt,ar as Mt,as as Dt,at as zt,am as Ae,an as $e,aj as he,ak as Me,I as ge,aC as Lt,aN as Tt,bi as Ye,bj as et,b4 as st,aQ as Nt,bc as Wt,al as Q,aR as rt,az as bt,ba as Ft,w as He,aK as Le,aM as Te,ay as jt,aL as Vt,aE as Ht,C as Ut,aP as Jt,aG as Gt,aH as Qt,aA as Kt,aB as Xt,be as Zt}from"./AdapterDateFns-C_xc8QeI.js";function Yt(t){const{badgeContent:s,invisible:r=!1,max:i=99,showZero:h=!1}=t,c=vt({badgeContent:s,max:i});let l=r;r===!1&&s===0&&!h&&(l=!0);const{badgeContent:x,max:d=i}=l?c:t,y=x&&Number(x)>d?`${d}+`:x;return{badgeContent:x,invisible:l,max:d,displayValue:y}}function es(t){return ze("MuiBadge",t)}const ne=De("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),ts=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],Fe=10,Ve=4,ss=t=>{const{color:s,anchorOrigin:r,invisible:i,overlap:h,variant:c,classes:l={}}=t,x={root:["root"],badge:["badge",c,i&&"invisible",`anchorOrigin${M(r.vertical)}${M(r.horizontal)}`,`anchorOrigin${M(r.vertical)}${M(r.horizontal)}${M(h)}`,`overlap${M(h)}`,s!=="default"&&`color${M(s)}`]};return qe(x,es,l)},rs=ee("span",{name:"MuiBadge",slot:"Root",overridesResolver:(t,s)=>s.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),ns=ee("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.badge,s[r.variant],s[`anchorOrigin${M(r.anchorOrigin.vertical)}${M(r.anchorOrigin.horizontal)}${M(r.overlap)}`],r.color!=="default"&&s[`color${M(r.color)}`],r.invisible&&s.invisible]}})(({theme:t})=>{var s;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:Fe*2,lineHeight:1,padding:"0 6px",height:Fe*2,borderRadius:Fe,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen}),variants:[...Object.keys(((s=t.vars)!=null?s:t).palette).filter(r=>{var i,h;return((i=t.vars)!=null?i:t).palette[r].main&&((h=t.vars)!=null?h:t).palette[r].contrastText}).map(r=>({props:{color:r},style:{backgroundColor:(t.vars||t).palette[r].main,color:(t.vars||t).palette[r].contrastText}})),{props:{variant:"dot"},style:{borderRadius:Ve,height:Ve*2,minWidth:Ve*2,padding:0}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ne.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ne.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ne.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ne.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${ne.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${ne.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${ne.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${ne.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})}}]}}),as=n.forwardRef(function(s,r){var i,h,c,l,x,d;const y=Ee({props:s,name:"MuiBadge"}),{anchorOrigin:f={vertical:"top",horizontal:"right"},className:b,component:R,components:A={},componentsProps:a={},children:g,overlap:w="rectangular",color:u="default",invisible:I=!1,max:_=99,badgeContent:B,slots:E,slotProps:D,showZero:F=!1,variant:o="standard"}=y,j=_e(y,ts),{badgeContent:k,invisible:q,max:$,displayValue:Z}=Yt({max:_,invisible:I,badgeContent:B,showZero:F}),se=vt({anchorOrigin:f,color:u,overlap:w,variant:o,badgeContent:B}),re=q||k==null&&o!=="dot",{color:de=u,overlap:te=w,anchorOrigin:ue=f,variant:ie=o}=re?se:y,pe=ie!=="dot"?Z:void 0,m=N({},y,{badgeContent:k,invisible:re,max:$,displayValue:pe,showZero:F,anchorOrigin:ue,color:de,overlap:te,variant:ie}),S=ss(m),v=(i=(h=E==null?void 0:E.root)!=null?h:A.Root)!=null?i:rs,C=(c=(l=E==null?void 0:E.badge)!=null?l:A.Badge)!=null?c:ns,O=(x=D==null?void 0:D.root)!=null?x:a.root,z=(d=D==null?void 0:D.badge)!=null?d:a.badge,L=Ke({elementType:v,externalSlotProps:O,externalForwardedProps:j,additionalProps:{ref:r,as:R},ownerState:m,className:ce(O==null?void 0:O.className,S.root,b)}),Ne=Ke({elementType:C,externalSlotProps:z,ownerState:m,className:ce(S.badge,z==null?void 0:z.className)});return e.jsxs(v,N({},L,{children:[g,e.jsx(C,N({},Ne,{children:pe}))]}))});function os(t){return ze("MuiBottomNavigation",t)}De("MuiBottomNavigation",["root"]);const is=["children","className","component","onChange","showLabels","value"],ls=t=>{const{classes:s}=t;return qe({root:["root"]},os,s)},cs=ee("div",{name:"MuiBottomNavigation",slot:"Root",overridesResolver:(t,s)=>s.root})(({theme:t})=>({display:"flex",justifyContent:"center",height:56,backgroundColor:(t.vars||t).palette.background.paper})),ds=n.forwardRef(function(s,r){const i=Ee({props:s,name:"MuiBottomNavigation"}),{children:h,className:c,component:l="div",onChange:x,showLabels:d=!1,value:y}=i,f=_e(i,is),b=N({},i,{component:l,showLabels:d}),R=ls(b);return e.jsx(cs,N({as:l,className:ce(R.root,c),ref:r,ownerState:b},f,{children:n.Children.map(h,(A,a)=>{if(!n.isValidElement(A))return null;const g=A.props.value===void 0?a:A.props.value;return n.cloneElement(A,{selected:g===y,showLabel:A.props.showLabel!==void 0?A.props.showLabel:d,value:g,onChange:x})})}))});function us(t){return ze("MuiBottomNavigationAction",t)}const St=De("MuiBottomNavigationAction",["root","iconOnly","selected","label"]),ps=["className","icon","label","onChange","onClick","selected","showLabel","value"],hs=t=>{const{classes:s,showLabel:r,selected:i}=t;return qe({root:["root",!r&&!i&&"iconOnly",i&&"selected"],label:["label",!r&&!i&&"iconOnly",i&&"selected"]},us,s)},gs=ee(mt,{name:"MuiBottomNavigationAction",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.root,!r.showLabel&&!r.selected&&s.iconOnly]}})(({theme:t,ownerState:s})=>N({transition:t.transitions.create(["color","padding-top"],{duration:t.transitions.duration.short}),padding:"0px 12px",minWidth:80,maxWidth:168,color:(t.vars||t).palette.text.secondary,flexDirection:"column",flex:"1"},!s.showLabel&&!s.selected&&{paddingTop:14},!s.showLabel&&!s.selected&&!s.label&&{paddingTop:0},{[`&.${St.selected}`]:{color:(t.vars||t).palette.primary.main}})),xs=ee("span",{name:"MuiBottomNavigationAction",slot:"Label",overridesResolver:(t,s)=>s.label})(({theme:t,ownerState:s})=>N({fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(12),opacity:1,transition:"font-size 0.2s, opacity 0.2s",transitionDelay:"0.1s"},!s.showLabel&&!s.selected&&{opacity:0,transitionDelay:"0s"},{[`&.${St.selected}`]:{fontSize:t.typography.pxToRem(14)}})),fe=n.forwardRef(function(s,r){const i=Ee({props:s,name:"MuiBottomNavigationAction"}),{className:h,icon:c,label:l,onChange:x,onClick:d,value:y}=i,f=_e(i,ps),b=i,R=hs(b),A=a=>{x&&x(a,y),d&&d(a)};return e.jsxs(gs,N({ref:r,className:ce(R.root,h),focusRipple:!0,onClick:A,ownerState:b},f,{children:[c,e.jsx(xs,{className:R.label,ownerState:b,children:l})]}))}),fs=["alignItems","autoFocus","component","children","dense","disableGutters","divider","focusVisibleClassName","selected","className"],vs=(t,s)=>{const{ownerState:r}=t;return[s.root,r.dense&&s.dense,r.alignItems==="flex-start"&&s.alignItemsFlexStart,r.divider&&s.divider,!r.disableGutters&&s.gutters]},ms=t=>{const{alignItems:s,classes:r,dense:i,disabled:h,disableGutters:c,divider:l,selected:x}=t,y=qe({root:["root",i&&"dense",!c&&"gutters",l&&"divider",h&&"disabled",s==="flex-start"&&"alignItemsFlexStart",x&&"selected"]},Rt,r);return N({},r,y)},ys=ee(mt,{shouldForwardProp:t=>Ot(t)||t==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:vs})(({theme:t,ownerState:s})=>N({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${xe.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:ae.alpha(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${xe.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:ae.alpha(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${xe.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:ae.alpha(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:ae.alpha(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${xe.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${xe.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},s.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},s.alignItems==="flex-start"&&{alignItems:"flex-start"},!s.disableGutters&&{paddingLeft:16,paddingRight:16},s.dense&&{paddingTop:4,paddingBottom:4})),bs=n.forwardRef(function(s,r){const i=Ee({props:s,name:"MuiListItemButton"}),{alignItems:h="center",autoFocus:c=!1,component:l="div",children:x,dense:d=!1,disableGutters:y=!1,divider:f=!1,focusVisibleClassName:b,selected:R=!1,className:A}=i,a=_e(i,fs),g=n.useContext(Xe),w=n.useMemo(()=>({dense:d||g.dense||!1,alignItems:h,disableGutters:y}),[h,g.dense,d,y]),u=n.useRef(null);wt(()=>{c&&u.current&&u.current.focus()},[c]);const I=N({},i,{alignItems:h,dense:w.dense,disableGutters:y,divider:f,selected:R}),_=ms(I),B=It(u,r);return e.jsx(Xe.Provider,{value:w,children:e.jsx(ys,N({ref:B,href:a.href||a.to,component:(a.href||a.to)&&l==="div"?"button":l,focusVisibleClassName:ce(_.focusVisible,b),ownerState:I,className:ce(_.root,A)},a,{classes:_,children:x}))})});function js(t){return ze("MuiSwitch",t)}const W=De("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),Ss=["className","color","edge","size","sx"],Cs=t=>{const{classes:s,edge:r,size:i,color:h,checked:c,disabled:l}=t,x={root:["root",r&&`edge${M(r)}`,`size${M(i)}`],switchBase:["switchBase",`color${M(h)}`,c&&"checked",l&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=qe(x,js,s);return N({},s,d)},ks=ee("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.root,r.edge&&s[`edge${M(r.edge)}`],s[`size${M(r.size)}`]]}})({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${W.thumb}`]:{width:16,height:16},[`& .${W.switchBase}`]:{padding:4,[`&.${W.checked}`]:{transform:"translateX(16px)"}}}}]}),ws=ee(Pt,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.switchBase,{[`& .${W.input}`]:s.input},r.color!=="default"&&s[`color${M(r.color)}`]]}})(({theme:t})=>({position:"absolute",top:0,left:0,zIndex:1,color:t.vars?t.vars.palette.Switch.defaultColor:`${t.palette.mode==="light"?t.palette.common.white:t.palette.grey[300]}`,transition:t.transitions.create(["left","transform"],{duration:t.transitions.duration.shortest}),[`&.${W.checked}`]:{transform:"translateX(20px)"},[`&.${W.disabled}`]:{color:t.vars?t.vars.palette.Switch.defaultDisabledColor:`${t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]}`},[`&.${W.checked} + .${W.track}`]:{opacity:.5},[`&.${W.disabled} + .${W.track}`]:{opacity:t.vars?t.vars.opacity.switchTrackDisabled:`${t.palette.mode==="light"?.12:.2}`},[`& .${W.input}`]:{left:"-100%",width:"300%"}}),({theme:t})=>({"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:ae.alpha(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(t.palette).filter(([,s])=>s.main&&s.light).map(([s])=>({props:{color:s},style:{[`&.${W.checked}`]:{color:(t.vars||t).palette[s].main,"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[s].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:ae.alpha(t.palette[s].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${W.disabled}`]:{color:t.vars?t.vars.palette.Switch[`${s}DisabledColor`]:`${t.palette.mode==="light"?ae.lighten(t.palette[s].main,.62):ae.darken(t.palette[s].main,.55)}`}},[`&.${W.checked} + .${W.track}`]:{backgroundColor:(t.vars||t).palette[s].main}}}))]})),Is=ee("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(t,s)=>s.track})(({theme:t})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:t.transitions.create(["opacity","background-color"],{duration:t.transitions.duration.shortest}),backgroundColor:t.vars?t.vars.palette.common.onBackground:`${t.palette.mode==="light"?t.palette.common.black:t.palette.common.white}`,opacity:t.vars?t.vars.opacity.switchTrack:`${t.palette.mode==="light"?.38:.3}`})),Rs=ee("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(t,s)=>s.thumb})(({theme:t})=>({boxShadow:(t.vars||t).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),Os=n.forwardRef(function(s,r){const i=Ee({props:s,name:"MuiSwitch"}),{className:h,color:c="primary",edge:l=!1,size:x="medium",sx:d}=i,y=_e(i,Ss),f=N({},i,{color:c,edge:l,size:x}),b=Cs(f),R=e.jsx(Rs,{className:b.thumb,ownerState:f});return e.jsxs(ks,{className:ce(b.root,h),sx:d,ownerState:f,children:[e.jsx(ws,N({type:"checkbox",icon:R,checkedIcon:R,ref:r,ownerState:f},y,{classes:N({},b,{root:b.switchBase})})),e.jsx(Is,{className:b.track,ownerState:f})]})});var ve={},nt;function Ps(){if(nt)return ve;nt=1;var t=H();Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=void 0;var s=t(U()),r=J();return ve.default=(0,s.default)((0,r.jsx)("path",{d:"m17.21 9-4.38-6.56c-.19-.28-.51-.42-.83-.42-.32 0-.64.14-.83.43L6.79 9H2c-.55 0-1 .45-1 1 0 .09.01.18.04.27l2.54 9.27c.23.84 1 1.46 1.92 1.46h13c.92 0 1.69-.62 1.93-1.46l2.54-9.27L23 10c0-.55-.45-1-1-1zM9 9l3-4.4L15 9zm3 8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"}),"ShoppingBasket"),ve}var As=Ps();const $s=G(As);var me={},at;function Es(){if(at)return me;at=1;var t=H();Object.defineProperty(me,"__esModule",{value:!0}),me.default=void 0;var s=t(U()),r=J();return me.default=(0,s.default)((0,r.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart"),me}var _s=Es();const Ct=G(_s);var ye={},ot;function qs(){if(ot)return ye;ot=1;var t=H();Object.defineProperty(ye,"__esModule",{value:!0}),ye.default=void 0;var s=t(U()),r=J();return ye.default=(0,s.default)((0,r.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),ye}var Bs=qs();const Je=G(Bs);var be={},it;function Ms(){if(it)return be;it=1;var t=H();Object.defineProperty(be,"__esModule",{value:!0}),be.default=void 0;var s=t(U()),r=J();return be.default=(0,s.default)([(0,r.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3 6.08 3 3.28 5.64 3.03 9h2.02C5.3 6.75 7.18 5 9.5 5 11.99 5 14 7.01 14 9.5S11.99 14 9.5 14c-.17 0-.33-.03-.5-.05v2.02c.17.02.33.03.5.03 1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19z"},"0"),(0,r.jsx)("path",{d:"M6.47 10.82 4 13.29l-2.47-2.47-.71.71L3.29 14 .82 16.47l.71.71L4 14.71l2.47 2.47.71-.71L4.71 14l2.47-2.47z"},"1")],"SearchOff"),be}var Ds=Ms();const zs=G(Ds);var je={},lt;function Ls(){if(lt)return je;lt=1;var t=H();Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var s=t(U()),r=J();return je.default=(0,s.default)((0,r.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),je}var Ts=Ls();const Ns=G(Ts);var Se={},ct;function Ws(){if(ct)return Se;ct=1;var t=H();Object.defineProperty(Se,"__esModule",{value:!0}),Se.default=void 0;var s=t(U()),r=J();return Se.default=(0,s.default)((0,r.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"ReportProblem"),Se}var Fs=Ws();const Vs=G(Fs);var Ce={},dt;function Hs(){if(dt)return Ce;dt=1;var t=H();Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.default=void 0;var s=t(U()),r=J();return Ce.default=(0,s.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle"),Ce}var Us=Hs();const Js=G(Us);var ke={},ut;function Gs(){if(ut)return ke;ut=1;var t=H();Object.defineProperty(ke,"__esModule",{value:!0}),ke.default=void 0;var s=t(U()),r=J();return ke.default=(0,s.default)((0,r.jsx)("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"}),"Inventory"),ke}var Qs=Gs();const Ks=G(Qs);var we={},pt;function Xs(){if(pt)return we;pt=1;var t=H();Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var s=t(U()),r=J();return we.default=(0,s.default)((0,r.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-5 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"}),"Article"),we}var Zs=Xs();const Ys=G(Zs);var Ie={},ht;function er(){if(ht)return Ie;ht=1;var t=H();Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.default=void 0;var s=t(U()),r=J();return Ie.default=(0,s.default)((0,r.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning"),Ie}var tr=er();const sr=G(tr);var Re={},gt;function rr(){if(gt)return Re;gt=1;var t=H();Object.defineProperty(Re,"__esModule",{value:!0}),Re.default=void 0;var s=t(U()),r=J();return Re.default=(0,s.default)((0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),Re}var nr=rr();const ar=G(nr);var Oe={},xt;function or(){if(xt)return Oe;xt=1;var t=H();Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.default=void 0;var s=t(U()),r=J();return Oe.default=(0,s.default)((0,r.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),Oe}var ir=or();const lr=G(ir),cr={1:"搅拌",2:"丹麦",3:"整形",4:"烤炉",5:"冷加工",6:"收银打包",7:"水吧",8:"馅料",9:"小库房"},dr=Ue.forwardRef(function(s,r){return e.jsx(Y,{elevation:6,ref:r,variant:"filled",...s})}),ur=()=>{const[t,s]=n.useState([]),[r,i]=n.useState(!0),[h,c]=n.useState(null),[l,x]=n.useState(""),[d,y]=n.useState([]),[f,b]=n.useState({}),[R,A]=n.useState(!1),[a,g]=n.useState(!1),[w,u]=n.useState(""),[I,_]=n.useState("info"),[B,E]=n.useState(!1),[D,F]=n.useState(null),[o,j]=n.useState(0),k=n.useCallback(async()=>{var m;i(!0),c(null);try{const S=await fetch("/api/ingredients/list",{method:"POST",headers:{"Content-Type":"application/json","x-current-store-id":localStorage.getItem("currentStoreId")},body:JSON.stringify({})});if(!S.ok)throw new Error(`HTTP error! status: ${S.status}`);const v=await S.json();v.success&&Array.isArray(v.data)?(console.log("MobileInventoryCheck - 获取到的原料数据:",v.data),console.log("第一个原料的post字段:",(m=v.data[0])==null?void 0:m.post),s(v.data)):c(v.message||"Failed to load ingredients data.")}catch(S){c(`Error fetching ingredients: ${S.message}`)}finally{i(!1)}},[]);n.useEffect(()=>{k()},[k]),n.useEffect(()=>{if(l&&t.length>0){console.log("MobileInventoryCheck - 选择的岗位:",l),console.log("MobileInventoryCheck - 所有原料数量:",t.length);const m=t.filter((v,C)=>{const O=v.stockByPost&&v.stockByPost[l]&&v.stockByPost[l].quantity>0,z=Array.isArray(v.post)&&v.post.map(String).includes(String(l));return C<3&&console.log(`原料 ${C}: ${v.name}`,{stockByPost:v.stockByPost,hasStockInPost:O,post:v.post,isAssignedToPost:z,selectedPost:l,finalResult:O||z}),O||z});console.log("MobileInventoryCheck - 过滤后的原料:",m),console.log("MobileInventoryCheck - 过滤后的原料数量:",m.length),y(m);const S={};m.forEach(v=>{let C="";if(v.stockByPost){const O=new Map(Object.entries(v.stockByPost));O.has(l)&&O.get(l)&&typeof O.get(l).quantity=="number"&&(C=O.get(l).quantity.toString())}S[v._id]=C}),b(S)}else y([]),b({})},[l,t]);const q=(m,S="info")=>{u(m),_(S),g(!0)},$=(m,S)=>{S!=="clickaway"&&g(!1)},Z=m=>{x(m.target.value)},se=n.useCallback((m,S)=>{const v=S.replace(/[^0-9.]/g,"");b(C=>({...C,[m]:v}))},[]),re=m=>{const S=parseFloat(f[m]||0);se(m,(S+1).toString())},de=m=>{const S=parseFloat(f[m]||0);se(m,Math.max(0,S-1).toString())},te=async()=>{if(!l){q("请先选择一个岗位。","warning");return}const m=d.filter(v=>f[v._id]===""||f[v._id]===void 0),S=d.map(v=>({ingredientId:v._id,ingredientName:v.name,quantity:parseFloat(f[v._id]),unit:v.unit||v.baseUnit||v.min||"g",baseUnit:v.baseUnit||v.min,norms:v.norms})).filter(v=>!isNaN(v.quantity)&&v.quantity>=0);if(S.length===0&&d.length>0){q("没有有效的库存数量被输入。","warning");return}if(m.length>0){j(m.length),F(S),E(!0);return}S.length>0?await ue(S):d.length===0&&q("当前岗位没有需要盘点的物料。","info")},ue=async m=>{A(!0);try{const S=await fetch("/api/inventory/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:l,stocks:m})}),v=await S.json();if(!S.ok)throw new Error(v.message||"HTTP error!");if(v.success)q(v.message||"库存盘点数据提交成功！","success"),k();else throw new Error(v.message||"库存提交失败")}catch(S){q(`提交失败: ${S.message}`,"error")}finally{A(!1),E(!1)}},ie=()=>{D&&ue(D),E(!1)},pe=m=>{var S,v,C;return(C=(v=(S=m.stockByPost)==null?void 0:S[l])==null?void 0:v.quantity)!=null&&C.toFixed(2),e.jsx(Ae,{sx:{mb:2},children:e.jsxs($e,{children:[e.jsx(p,{variant:"h6",component:"div",children:m.name}),e.jsxs(p,{sx:{mb:1.5},color:"text.secondary",children:["规格: ",m.specs||"N/A"," | 单位:"," ",m.unit||m.baseUnit||m.min||"g"]}),e.jsx(P,{display:"flex",alignItems:"center",children:e.jsx(he,{fullWidth:!0,label:"实际库存",variant:"outlined",type:"number",value:f[m._id]||"",onChange:O=>se(m._id,O.target.value),InputProps:{startAdornment:e.jsx(Me,{position:"start",children:e.jsx(ge,{onClick:()=>de(m._id),size:"small",children:e.jsx(Tt,{})})}),endAdornment:e.jsx(Me,{position:"end",children:e.jsx(ge,{onClick:()=>re(m._id),size:"small",children:e.jsx(Lt,{})})})}})})]})},m._id)};return e.jsxs(Pe,{sx:{pb:8,pt:2},children:[e.jsxs(At,{fullWidth:!0,sx:{mb:2},children:[e.jsx($t,{id:"post-select-label",children:"选择岗位"}),e.jsxs(Et,{labelId:"post-select-label",value:l,label:"选择岗位",onChange:Z,children:[e.jsx(Ze,{value:"",children:e.jsx("em",{children:"请选择..."})}),Object.entries(cr).map(([m,S])=>e.jsx(Ze,{value:m,children:S},m))]})]}),r&&e.jsx(P,{sx:{display:"flex",justifyContent:"center",my:3},children:e.jsx(X,{})}),h&&e.jsx(p,{color:"error",align:"center",children:h}),!l&&e.jsx(p,{align:"center",color:"text.secondary",children:"请先选择一个岗位开始盘点。"}),l&&!r&&d.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{variant:"h6",sx:{mb:2},children:["找到 ",d.length," 个原料需要盘点"]}),e.jsx(Be,{children:d.map(pe)})]}),l&&!r&&d.length===0&&e.jsx(p,{align:"center",color:"text.secondary",sx:{mt:4},children:"当前岗位下没有需要盘点的物料。"}),e.jsx(V,{elevation:3,sx:{position:"fixed",bottom:56,left:0,right:0,p:2,zIndex:1e3},children:e.jsx(K,{fullWidth:!0,variant:"contained",color:"primary",size:"large",onClick:te,disabled:R||!l||d.length===0,startIcon:R?e.jsx(X,{size:20,color:"inherit"}):e.jsx(_t,{}),children:R?"正在提交...":"提交盘点"})}),e.jsx(yt,{open:a,autoHideDuration:6e3,onClose:$,anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(dr,{onClose:$,severity:I,sx:{width:"100%"},children:w})}),e.jsxs(qt,{open:B,onClose:()=>E(!1),children:[e.jsx(Bt,{children:"确认提交"}),e.jsx(Mt,{children:e.jsxs(Dt,{children:["您有 ",o," ","项物料未填写库存，确定要提交吗？未填写的项目将不会被保存。"]})}),e.jsxs(zt,{children:[e.jsx(K,{onClick:()=>E(!1),children:"取消"}),e.jsx(K,{onClick:ie,color:"primary",autoFocus:!0,children:"确认提交"})]})]})]})},oe={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected",COMPLETED:"completed"},pr={[oe.PENDING]:"待处理",[oe.APPROVED]:"已批准",[oe.REJECTED]:"已拒绝",[oe.COMPLETED]:"已完成"},hr={[oe.PENDING]:"warning",[oe.APPROVED]:"info",[oe.REJECTED]:"error",[oe.COMPLETED]:"success"},ft=t=>hr[t]||"warning",gr=({storeId:t,user:s})=>{const[r,i]=n.useState([]),[h,c]=n.useState(!0),[l,x]=n.useState(""),[d,y]=n.useState(Ye(new Date)),[f,b]=n.useState(et(new Date)),[R,A]=n.useState(""),[a,g]=n.useState(!0),[w,u]=n.useState(!1),[I,_]=n.useState(new Set),B=n.useCallback(async()=>{if(t){c(!0),x("");try{const o=st(d,"yyyy-MM-dd"),j=st(f,"yyyy-MM-dd"),k=await fetch(`/api/transfer-requests?startDate=${o}&endDate=${j}`);if(!k.ok){const $=await k.json();throw new Error($.message||"获取申请记录失败")}const q=await k.json();i(q.sort(($,Z)=>new Date(Z.createdAt)-new Date($.createdAt)))}catch(o){x(o.message)}finally{c(!1)}}},[t,d,f]);n.useEffect(()=>{B()},[B]),n.useEffect(()=>{(async()=>{var j;if(!(!t||!(s!=null&&s.name)))try{const k=await fetch(`/api/stores/${t}`);if(k.ok){const $=((j=(await k.json()).data)==null?void 0:j.warehouseManagers)||[];u($.includes(s.name))}}catch(k){console.error("检查库管权限失败:",k)}})()},[t,s]);const E=n.useMemo(()=>{const o=R.trim().toLowerCase();return o?r.filter(j=>j.requestedBy&&j.requestedBy.toLowerCase().includes(o)):r},[r,R]),D=n.useMemo(()=>{if(!a)return null;const o=new Map,j=new Set;return E.forEach(k=>{j.add(k.requestedBy||"未知"),k.items.forEach(q=>{const $=q.name;if(o.has($)){const Z=o.get($);Z.quantity+=q.quantity,Z.requesters.add(k.requestedBy||"未知")}else o.set($,{name:q.name,unit:q.unit,quantity:q.quantity,requesters:new Set([k.requestedBy||"未知"])})})}),{items:Array.from(o.values()).map(k=>({...k,requesters:Array.from(k.requesters)})),totalRequesters:j.size,totalRequests:E.length}},[E,a]),F=async o=>{if(!(s!=null&&s.name)){alert("用户信息缺失");return}_(j=>new Set(j).add(o));try{const j=await fetch(`/api/transfer-requests/${o}/mobile-approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:s.name})}),k=await j.json();j.ok?(alert("申请已批准！"),B()):alert(k.message||"批准失败")}catch(j){console.error("批准申请失败:",j),alert("批准申请时发生错误")}finally{_(j=>{const k=new Set(j);return k.delete(o),k})}};return e.jsx(Nt,{dateAdapter:Wt,children:e.jsxs(P,{children:[e.jsx(p,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:"所有申请单据"}),e.jsx(V,{sx:{p:2,mb:2},children:e.jsxs(Q,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(Q,{item:!0,xs:6,children:e.jsx(rt,{label:"开始日期",value:d,onChange:o=>y(Ye(o)),renderInput:o=>e.jsx(he,{...o,fullWidth:!0,size:"small"})})}),e.jsx(Q,{item:!0,xs:6,children:e.jsx(rt,{label:"结束日期",value:f,onChange:o=>b(et(o)),renderInput:o=>e.jsx(he,{...o,fullWidth:!0,size:"small"})})}),e.jsx(Q,{item:!0,xs:12,children:e.jsx(he,{fullWidth:!0,size:"small",label:"按申请人姓名过滤",placeholder:"输入申请人姓名...",value:R,onChange:o=>A(o.target.value),variant:"outlined"})}),e.jsxs(Q,{item:!0,xs:12,children:[e.jsx(bt,{sx:{my:1}}),e.jsx(Ft,{control:e.jsx(Os,{checked:a,onChange:o=>g(o.target.checked),color:"primary"}),label:"聚合模式 - 按物料汇总当天所有申请"})]})]})}),h&&e.jsx(P,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(X,{})}),l&&e.jsx(Y,{severity:"error",sx:{my:2},children:l}),!h&&!l&&(E.length===0?e.jsxs(V,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[e.jsx(Je,{sx:{fontSize:48,color:"text.secondary"}}),e.jsx(p,{variant:"h6",color:"text.secondary",sx:{mt:1},children:R.trim()?"没有找到匹配的申请记录":"该日期范围内没有申请记录"})]}):a?e.jsxs(P,{children:[e.jsxs(V,{sx:{p:2,mb:2,bgcolor:"info.50"},children:[e.jsx(p,{variant:"h6",color:"info.main",gutterBottom:!0,children:"物料汇总统计"}),e.jsxs(Q,{container:!0,spacing:2,children:[e.jsxs(Q,{item:!0,xs:4,children:[e.jsx(p,{variant:"body2",color:"text.secondary",children:"总申请人数"}),e.jsx(p,{variant:"h6",children:D.totalRequesters})]}),e.jsxs(Q,{item:!0,xs:4,children:[e.jsx(p,{variant:"body2",color:"text.secondary",children:"总申请单数"}),e.jsx(p,{variant:"h6",children:D.totalRequests})]}),e.jsxs(Q,{item:!0,xs:4,children:[e.jsx(p,{variant:"body2",color:"text.secondary",children:"物料种类"}),e.jsx(p,{variant:"h6",children:D.items.length})]})]})]}),D.items.map((o,j)=>e.jsx(Ae,{sx:{mb:2,boxShadow:2,borderRadius:2},variant:"outlined",children:e.jsxs($e,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(p,{variant:"h6",sx:{fontWeight:"bold"},children:o.name}),e.jsx(He,{label:`总计: ${o.quantity} ${o.unit||""}`,color:"primary",variant:"outlined"})]}),e.jsxs(p,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["申请人: ",o.requesters.join(", ")]}),e.jsxs(p,{variant:"caption",color:"text.secondary",children:["共 ",o.requesters.length," 人申请"]})]})},j))]}):E.map(o=>e.jsxs(Ae,{sx:{mb:2,boxShadow:2,borderRadius:2,borderLeft:"4px solid",borderColor:`${ft(o.status)}.main`},variant:"outlined",children:[e.jsxs($e,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1.5},children:[e.jsxs(P,{children:[e.jsxs(p,{variant:"body1",sx:{fontWeight:"bold"},children:["申请人: ",o.requestedBy||"未知"]}),e.jsx(p,{variant:"caption",color:"text.secondary",display:"block",children:new Date(o.createdAt).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx(He,{label:pr[o.status]||o.status,color:ft(o.status),size:"small",sx:{mt:.5}})]}),e.jsx(Be,{dense:!0,sx:{mt:1,p:0},children:o.items.map((j,k)=>e.jsx(Le,{sx:{py:.25,px:0},children:e.jsx(Te,{primary:j.name,secondary:`x ${j.quantity} ${j.unit||""}`,primaryTypographyProps:{variant:"body1"},secondaryTypographyProps:{variant:"body2",color:"text.secondary"}})},k))}),o.notes&&e.jsxs(p,{variant:"body2",sx:{mt:1.5,fontStyle:"italic",color:"text.secondary",p:1.5,backgroundColor:"grey.100",borderRadius:1},children:["备注: ",o.notes]})]}),w&&o.status==="pending"&&e.jsx(jt,{sx:{pt:0,px:1.5,pb:1.5},children:e.jsx(K,{variant:"contained",color:"success",size:"small",onClick:()=>F(o._id),disabled:I.has(o._id),startIcon:I.has(o._id)?e.jsx(X,{size:16}):null,children:I.has(o._id)?"批准中...":"批准申请"})})]},o._id)))]})})},xr=({onStoreSelect:t,storageKey:s="defaultStoreId"})=>{const[r,i]=n.useState([]),[h,c]=n.useState(!0),[l,x]=n.useState("");n.useEffect(()=>{(async()=>{try{const f=await fetch("/api/stores");if(!f.ok)throw new Error("获取门店列表失败");const b=await f.json();if(b.success)i(b.data);else throw new Error(b.message||"未能加载门店数据")}catch(f){x(f.message)}finally{c(!1)}})()},[]);const d=y=>{localStorage.setItem(s,y),t(y)};return h?e.jsxs(P,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:[e.jsx(X,{}),e.jsx(p,{sx:{ml:2},children:"正在加载门店列表..."})]}):l?e.jsx(Y,{severity:"error",sx:{m:2},children:l}):e.jsxs(V,{sx:{m:2,p:2},children:[e.jsx(p,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center"},children:"请选择您的门店"}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",mb:2},children:"您的选择将被记住，下次访问时将直接进入该门店。"}),e.jsx(Be,{component:"nav","aria-label":"门店列表",children:r.map((y,f)=>e.jsxs(Ue.Fragment,{children:[e.jsx(Le,{disablePadding:!0,children:e.jsxs(bs,{onClick:()=>d(y._id),children:[e.jsx(Vt,{children:e.jsx(Ht,{})}),e.jsx(Te,{primary:y.name})]})}),f<r.length-1&&e.jsx(bt,{})]},y._id))})]})},fr=({pendingRequests:t,onBulkApprove:s,bulkApproving:r,expanded:i,onToggleExpand:h,user:c})=>{if(t.length===0)return null;const l=t.reduce((x,d)=>x+d.items.length,0);return e.jsxs(Y,{severity:"warning",sx:{mb:2,"& .MuiAlert-message":{width:"100%"}},icon:e.jsx(sr,{}),action:e.jsxs(P,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(K,{color:"inherit",size:"small",onClick:s,disabled:r,startIcon:r?e.jsx(X,{size:16}):e.jsx(ar,{}),children:r?"批准中...":"一键批准"}),e.jsx(ge,{size:"small",onClick:h,color:"inherit",children:i?e.jsx(lr,{}):e.jsx(Jt,{})})]}),children:[e.jsxs(p,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:["⚠️ 有 ",t.length," 个申请待批准，影响 ",l," 个物料的库存显示"]}),e.jsx(Ut,{in:i,children:e.jsxs(P,{sx:{mt:2},children:[e.jsxs(p,{variant:"body2",sx:{mb:2,color:"text.secondary"},children:[e.jsx("strong",{children:"未批准申请的影响："}),e.jsx("br",{}),"• 占用虚拟库存，影响其他人申请",e.jsx("br",{}),"• 库存显示不准确，可能导致缺货",e.jsx("br",{}),"• 延误生产计划和配送安排"]}),e.jsx(p,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"待批准申请详情："}),t.slice(0,3).map(x=>e.jsxs(P,{sx:{mb:1,p:1,bgcolor:"rgba(255, 152, 0, 0.1)",borderRadius:1,fontSize:"0.875rem"},children:[e.jsxs(p,{variant:"caption",display:"block",children:["申请单 #",x._id.slice(-6)," - ",x.requestedBy||"未知用户"]}),e.jsxs(p,{variant:"caption",color:"text.secondary",children:[x.items.length," 个物料 | ",new Date(x.createdAt).toLocaleDateString()]})]},x._id)),t.length>3&&e.jsxs(p,{variant:"caption",color:"text.secondary",children:["还有 ",t.length-3," 个申请..."]})]})})]})},vr=()=>{const[t,s]=n.useState(null),[r,i]=n.useState(!0),[h,c]=n.useState(""),[l,x]=n.useState(!1),[d,y]=n.useState(!0);return n.useEffect(()=>{const b=(g=>new URLSearchParams(window.location.search).get(g))("appId");console.log("--- [Feishu Auth Hook] Initializing ---"),console.log(`- appId from URL: ${b}`);let R=0;const A=6,a=setInterval(()=>{if(console.log(`- Polling for SDK, check #${R+1}`),window.h5sdk&&window.tt){clearInterval(a),console.log("- SDK found! Proceeding with auth."),x(!0),y(!1);const g=localStorage.getItem("user");if(g&&g!=="undefined"){console.log("- Found user in localStorage. Skipping auth flow."),s(JSON.parse(g)),i(!1);return}if(console.log("- No user in localStorage."),!b){console.error("[Feishu Auth Hook Error] appId is missing from URL."),c("URL中缺少appId参数。"),i(!1);return}window.h5sdk.ready(()=>{console.log("- h5sdk is ready. Calling tt.requestAccess."),console.log(`- Passing appId to tt.requestAccess: ${b}`);const w=setTimeout(()=>{console.error("[Feishu Auth Hook Error] tt.requestAccess timed out after 5 seconds."),c("飞书授权请求超时，请稍后重试。"),i(!1)},1e4);tt.requestAccess({appID:b,scopeList:[],success:u=>{clearTimeout(w),console.log("- tt.requestAccess succeeded. Code:",u.code),console.log("- Sending code to backend..."),fetch("/api/feishu/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:u.code,appID:b})}).then(I=>{if(!I.ok)throw console.error("[Feishu Auth Hook Error] Backend fetch failed.",I),new Error("获取用户信息失败");return I.json()}).then(I=>{console.log("- Backend returned user data:",I),localStorage.setItem("user",JSON.stringify(I)),s(I)}).catch(I=>{console.error("[Feishu Auth Hook Error] Error in fetch chain:",I),c(I.message)}).finally(()=>i(!1))},fail:u=>{clearTimeout(w),console.error("[Feishu Auth Hook Error] tt.requestAccess failed:",u),c(`飞书授权失败: ${JSON.stringify(u)}`),i(!1)}})})}else R++,R>=A&&(clearInterval(a),console.warn("[Feishu Auth Hook] SDK polling timed out."),y(!1),x(!1),i(!1))},500);return()=>clearInterval(a)},[]),{user:t,loading:r,error:h,isFeishuEnv:l,checkingEnv:d}},mr=({onAddToCart:t,onUpdateCart:s,cartItems:r,ingredients:i,loading:h,error:c})=>{const[l,x]=n.useState([]),[d,y]=n.useState("all"),[f,b]=n.useState("");n.useEffect(()=>{x(i),y("all")},[i]),n.useEffect(()=>{let a=i;d!=="all"&&(a=a.filter(g=>{var w;return(w=g.ingredient.post)==null?void 0:w.includes(Number(d))})),f.trim()&&(a=a.filter(g=>g.ingredient.name.toLowerCase().includes(f.toLowerCase().trim())||g.ingredient.specs&&g.ingredient.specs.toLowerCase().includes(f.toLowerCase().trim()))),x(a)},[d,i,f]);const R=a=>{const g=r.find(u=>u.ingredientId===a.ingredient._id);if((g?g.quantity:0)+1>a.virtualStock){alert("申请数量超过可用库存");return}t({ingredientId:a.ingredient._id,name:a.ingredient.name,quantity:1,unit:a.ingredient.unit})},A=a=>{if(!r.find(u=>u.ingredientId===a.ingredient._id))return;const w=r.map(u=>u.ingredientId===a.ingredient._id?{...u,quantity:u.quantity-1}:u).filter(u=>u.quantity>0);s(w)};return e.jsxs(P,{children:[e.jsx(p,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:"申领中心"}),e.jsxs(V,{sx:{p:1.5,mb:2,position:"sticky",top:0,zIndex:1,backgroundColor:"background.paper"},children:[e.jsx(he,{fullWidth:!0,size:"small",placeholder:"搜索原料名称或规格...",value:f,onChange:a=>b(a.target.value),sx:{mb:2},InputProps:{startAdornment:e.jsx(Me,{position:"start",children:e.jsx(Gt,{color:"action"})}),endAdornment:f&&e.jsx(Me,{position:"end",children:e.jsx(ge,{size:"small",onClick:()=>b(""),edge:"end",children:e.jsx(Ns,{})})})}}),e.jsx(p,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold"},children:"按岗位筛选"}),e.jsxs(P,{sx:{position:"relative"},children:[e.jsx(P,{sx:{overflowX:"auto",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},children:e.jsxs(P,{sx:{display:"flex",gap:1,py:.5,pr:"30px"},children:[e.jsx(K,{size:"small",variant:d==="all"?"contained":"outlined",onClick:()=>y("all"),children:"全部"}),Object.entries(Qt).map(([a,g])=>e.jsx(K,{size:"small",variant:d===a?"contained":"outlined",onClick:()=>y(a),sx:{flexShrink:0},children:g},a))]})}),e.jsx(P,{sx:{position:"absolute",top:0,right:0,width:"30px",height:"100%",background:a=>`linear-gradient(to left, ${a.palette.background.paper}, transparent)`,pointerEvents:"none"}})]})]}),h&&e.jsx(P,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(X,{})}),c&&e.jsx(Y,{severity:"error",children:c}),!h&&!c&&(l.length>0?e.jsx(Q,{container:!0,spacing:2,children:l.map(a=>{const g=a.ingredient._id,w=r.find(u=>u.ingredientId===g);return e.jsx(Q,{item:!0,xs:12,children:e.jsxs(Ae,{sx:{display:"flex",flexDirection:"column",boxShadow:3,borderRadius:2},children:[e.jsxs($e,{sx:{flexGrow:1,p:1.5},children:[e.jsx(p,{gutterBottom:!0,variant:"h6",component:"h2",sx:{fontSize:"1rem",fontWeight:"bold"},children:a.ingredient.name}),e.jsxs(p,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["规格: ",a.ingredient.specs||"无"]}),e.jsxs(p,{variant:"body2",color:"text.secondary",children:["可用库存: ",a.virtualStock," ",a.ingredient.unit]})]}),e.jsx(jt,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",p:1.5,pt:0},children:w?e.jsxs(P,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ge,{color:"primary",onClick:()=>A(a),size:"small",children:e.jsx(Kt,{})}),e.jsx(p,{variant:"h6",component:"span",children:w.quantity}),e.jsx(ge,{color:"primary",onClick:()=>R(a),size:"small",disabled:w.quantity>=a.virtualStock,children:e.jsx(Xt,{})})]}):e.jsx(K,{variant:"contained",size:"medium",onClick:()=>R(a),children:"加入购物车"})})]})},g)})}):e.jsxs(V,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[e.jsx(zs,{sx:{fontSize:48,color:"text.secondary"}}),e.jsx(p,{variant:"h6",color:"text.secondary",sx:{mt:1},children:f.trim()?"未找到匹配的物料":d==="all"?"暂无可用物料":"当前筛选下没有物料"}),f.trim()?e.jsx(p,{variant:"body1",color:"text.secondary",sx:{mt:1},children:"尝试修改搜索关键词或清空搜索条件。"}):d!=="all"&&e.jsx(p,{variant:"body1",color:"text.secondary",sx:{mt:1},children:"尝试选择其他岗位或“全部”。"})]}))]})},yr=({user:t,cartItems:s,onUpdateCart:r,storeId:i,refetchData:h})=>{const[c,l]=n.useState(!1),[x,d]=n.useState(""),[y,f]=n.useState(""),b=(a,g)=>{const w=[...s];w[a].quantity=Number(g),r(w.filter(u=>u.quantity>0))},R=a=>{const g=[...s];g.splice(a,1),r(g)},A=async()=>{if(s.length===0){d("购物车是空的！");return}l(!0),d(""),f("");try{const[a,g]=await Promise.all([fetch("/api/warehouse/stock",{headers:{"x-current-store-id":i}}),fetch("/api/transfer-requests",{headers:{"x-current-store-id":i}})]);if(!a.ok)throw new Error("无法获取最新库存信息进行校验");if(!g.ok)throw new Error("无法获取最新申请信息进行校验");const w=await a.json(),u=await g.json(),I={};u.filter(o=>o.status==="pending").forEach(o=>{o.items.forEach(j=>{I[j.ingredientId]=(I[j.ingredientId]||0)+j.quantity})});const _=new Map;(w.items||[]).forEach(o=>{if(o.mainWarehouseStock){const j=I[o.ingredient._id]||0,k=o.mainWarehouseStock.quantity-j;_.set(o.ingredient._id,k>0?k:0)}});const B=s.filter(o=>{const j=_.get(o.ingredientId);return o.quantity>(j===void 0?0:j)});if(B.length>0){const o=B.map(j=>j.name).join(", ");throw new Error(`库存不足或物料已下架: ${o}。请返回修改数量或移除物料。`)}const D={items:s.map(o=>({ingredientId:o.ingredientId,name:o.name,unit:o.unit,quantity:o.quantity})),requestedBy:(t==null?void 0:t.name)||"未知飞书用户"},F=await fetch("/api/transfer-requests",{method:"POST",headers:{"Content-Type":"application/json","x-current-store-id":i},body:JSON.stringify(D)});if(!F.ok){const o=await F.json();throw new Error(o.message||"提交申请失败")}f("您的调拨申请已成功提交！"),r([]),h&&h()}catch(a){d(a.message)}finally{l(!1),setTimeout(()=>{f(""),d("")},5e3)}};return e.jsxs(P,{children:[e.jsx(p,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:"我的购物车"}),x&&e.jsx(Y,{severity:"error",sx:{mb:2},children:x}),y&&e.jsx(Y,{severity:"success",sx:{mb:2},children:y}),s.length===0&&!y?e.jsxs(V,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[e.jsx(Ct,{sx:{fontSize:48,color:"text.secondary"}}),e.jsx(p,{variant:"h6",color:"text.secondary",sx:{mt:1},children:"购物车是空的"})]}):e.jsx(Be,{children:s.map((a,g)=>e.jsxs(Le,{divider:!0,secondaryAction:e.jsx(K,{edge:"end",color:"error",size:"small",onClick:()=>R(g),children:"删除"}),children:[e.jsx(Te,{primary:e.jsx(p,{variant:"body1",sx:{fontWeight:500},children:a.name})}),e.jsxs(P,{sx:{display:"flex",alignItems:"center",mx:2},children:[e.jsx(he,{type:"number",size:"small",variant:"outlined",value:a.quantity,onChange:w=>b(g,w.target.value),sx:{width:"70px"},inputProps:{min:1}}),e.jsx(p,{variant:"body1",component:"span",sx:{ml:1.5,minWidth:"30px",textAlign:"left"},children:a.unit})]})]},`${a.ingredientId}-${g}`))}),s.length>0&&e.jsxs(V,{elevation:3,sx:{p:2,mt:2,position:"sticky",bottom:60,zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.95)"},children:[e.jsxs(p,{variant:"h6",sx:{mb:2},children:["总计: ",s.reduce((a,g)=>a+g.quantity,0)," 件"]}),e.jsx(K,{fullWidth:!0,variant:"contained",color:"primary",size:"large",onClick:A,disabled:c,children:c?e.jsx(X,{size:24,color:"inherit"}):"提交申请"})]})]})},br=({requests:t,loading:s,error:r,user:i,storeId:h})=>{const[c,l]=n.useState(!1),[x,d]=n.useState([]),[y,f]=n.useState(!1),b=u=>{switch(u){case"completed":return"success";case"approved":return"info";case"rejected":return"error";case"pending":default:return"warning"}},R={pending:"待处理",approved:"已批准",rejected:"已拒绝",completed:"已完成"},A=async()=>{if(h){f(!0);try{const u=await fetch("/api/transfer-requests",{headers:{"x-current-store-id":h}});if(!u.ok)throw new Error("获取所有申请记录失败");const I=await u.json();d(I.sort((_,B)=>new Date(B.createdAt)-new Date(_.createdAt)))}catch(u){console.error("获取所有申请记录失败:",u)}finally{f(!1)}}},a=()=>{c||A(),l(!c)},g=c?x:t,w=c?y:s;return e.jsxs(P,{children:[e.jsx(p,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:c?"所有申请记录":"我的申请记录"}),e.jsx(P,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(K,{variant:c?"outlined":"contained",onClick:a,size:"small",children:c?"只看我的申请":"查看所有申请"})}),w&&e.jsx(P,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(X,{})}),r&&e.jsx(Y,{severity:"error",children:r}),!w&&!r&&(g.length===0?e.jsxs(V,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[e.jsx(Je,{sx:{fontSize:48,color:"text.secondary"}}),e.jsx(p,{variant:"h6",color:"text.secondary",sx:{mt:1},children:c?"暂无申请记录":"暂无我的申请记录"})]}):g.map(u=>e.jsx(Ae,{sx:{mb:2,boxShadow:2,borderRadius:2,borderLeft:"4px solid",borderColor:`${b(u.status)}.main`},variant:"outlined",children:e.jsxs($e,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[e.jsxs(P,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1.5},children:[e.jsxs(P,{children:[e.jsxs(p,{variant:"body1",sx:{fontWeight:"bold"},children:["申请单 #",u._id.slice(-6)]}),c&&e.jsxs(p,{variant:"body2",color:"primary",sx:{fontWeight:"medium"},children:["申请人: ",u.requestedBy||"未知"]}),e.jsx(p,{variant:"caption",color:"text.secondary",display:"block",children:new Date(u.createdAt).toLocaleString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.jsx(He,{label:R[u.status]||u.status,color:b(u.status),size:"small",sx:{mt:.5}})]}),e.jsx(Be,{dense:!0,sx:{mt:1,p:0},children:u.items.map((I,_)=>e.jsx(Le,{sx:{py:.25,px:0},children:e.jsx(Te,{primary:I.name,secondary:`x ${I.quantity} ${I.unit||""}`,primaryTypographyProps:{variant:"body1",fontWeight:"medium"},secondaryTypographyProps:{variant:"body2",color:"text.secondary"}})},_))}),u.notes&&e.jsxs(p,{variant:"body2",sx:{mt:1.5,fontStyle:"italic",color:"text.secondary",p:1.5,backgroundColor:"grey.100",borderRadius:1},children:["备注: ",u.notes]})]})},u._id)))]})},jr=()=>{const[t,s]=n.useState(null),[r,i]=n.useState("shop"),[h,c]=n.useState([]),[l,x]=n.useState(""),[d,y]=n.useState(!0),[f,b]=n.useState([]),[R,A]=n.useState([]),[a,g]=n.useState([]),[w,u]=n.useState(!1),[I,_]=n.useState(!1),[B,E]=n.useState(!1),[D,F]=n.useState(!1),[o,j]=n.useState(""),[k,q]=n.useState("info"),{user:$,loading:Z,error:se,isFeishuEnv:re,checkingEnv:de}=vr();n.useEffect(()=>{const C=new URLSearchParams(window.location.search).get("store");if(C){console.log(`[Mobile Page] Found store in URL: ${C}. Locking it in sessionStorage.`),sessionStorage.setItem("lockedStoreId",C),s(C);return}const O=sessionStorage.getItem("lockedStoreId");if(O){console.log(`[Mobile Page] Found locked storeId in sessionStorage: ${O}.`),s(O);return}const z=localStorage.getItem("defaultStoreId");if(z){console.log(`[Mobile Page] Found default storeId in localStorage: ${z}.`),s(z);return}console.log("[Mobile Page] No storeId found. Waiting for user selection.")},[]);const te=n.useCallback(async()=>{if(t){y(!0),x("");try{const[C,O]=await Promise.all([fetch("/api/warehouse/stock",{headers:{"x-current-store-id":t}}),fetch("/api/transfer-requests",{headers:{"x-current-store-id":t}})]);if(!C.ok)throw new Error("获取物料列表失败");if(!O.ok)throw new Error("获取申请记录失败");const z=await C.json(),L=await O.json(),Ne=L.filter(T=>T.requestedBy===($==null?void 0:$.name));A(Ne.sort((T,le)=>new Date(le.createdAt)-new Date(T.createdAt)));const Ge=L.filter(T=>T.status==="pending");g(Ge),u(Ge.length>0);const We={};L.filter(T=>T.status==="pending").forEach(T=>{T.items.forEach(le=>{We[le.ingredientId]=(We[le.ingredientId]||0)+le.quantity})});const kt=(z.items||[]).filter(T=>T.mainWarehouseStock&&T.mainWarehouseStock.quantity>0).map(T=>{const le=We[T.ingredient._id]||0,Qe=T.mainWarehouseStock.quantity-le;return{...T,virtualStock:Qe>0?Qe:0}});b(kt)}catch(C){x(C.message)}finally{y(!1)}}},[t]);n.useEffect(()=>{re&&$&&t&&te()},[re,$,t,te]);const ue=C=>{c(O=>O.find(L=>L.ingredientId===C.ingredientId)?O.map(L=>L.ingredientId===C.ingredientId?{...L,quantity:L.quantity+C.quantity}:L):[...O,C])},ie=C=>{c(C)},pe=(C,O)=>{i(O)},m=(C,O="info")=>{j(C),q(O),F(!0)},S=async()=>{if(a.length===0){m("没有待批准的申请","info");return}E(!0);try{const C=a.map(L=>L._id),O=await fetch("/api/transfer-requests/bulk-approve",{method:"POST",headers:{"Content-Type":"application/json","x-current-store-id":t},body:JSON.stringify({requestIds:C})});if(!O.ok){const L=await O.json();throw new Error(L.message||"批准申请失败")}const z=await O.json();m(z.message||"批准成功！","success"),te()}catch(C){console.error("批准申请失败:",C),m(`批准失败: ${C.message}`,"error")}finally{E(!1)}},v=()=>{if(d&&r!=="all-requests")return e.jsx(P,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(X,{})});switch(r){case"cart":return e.jsx(yr,{user:$,cartItems:h,onUpdateCart:ie,storeId:t,refetchData:te});case"history":return e.jsx(br,{requests:R,loading:d,error:l,user:$,storeId:t});case"inventory":return e.jsx(ur,{});case"all-requests":return e.jsx(gr,{storeId:t,user:$});case"shop":default:return e.jsx(mr,{onAddToCart:ue,onUpdateCart:ie,cartItems:h,ingredients:f,loading:d,error:l,refetchData:te})}};return de||Z?e.jsxs(Pe,{sx:{mt:4,textAlign:"center"},children:[e.jsx(X,{}),e.jsx(p,{sx:{mt:2},children:de?"正在检查运行环境...":"正在获取用户信息..."})]}):re?se?e.jsx(Pe,{sx:{mt:2},children:e.jsx(Y,{severity:"error",children:se})}):t?e.jsxs(P,{sx:{pb:7},children:[e.jsxs(Pe,{children:[e.jsxs(P,{sx:{display:"flex",alignItems:"center",p:1,mb:1},children:[e.jsx(Js,{sx:{color:"action.active",mr:1}}),e.jsxs(p,{variant:"subtitle1",children:["欢迎, ",($==null?void 0:$.name)||"用户"]})]}),w&&e.jsx(fr,{pendingRequests:a,onBulkApprove:S,bulkApproving:B,expanded:I,onToggleExpand:()=>_(!I),user:$}),v()]}),e.jsx(V,{sx:{position:"fixed",bottom:0,left:0,right:0},elevation:3,children:e.jsxs(ds,{showLabels:!0,value:r,onChange:pe,children:[e.jsx(fe,{label:"申领中心",value:"shop",icon:e.jsx($s,{})}),e.jsx(fe,{label:"购物车",value:"cart",icon:e.jsx(as,{badgeContent:h.length,color:"primary",children:e.jsx(Ct,{})})}),e.jsx(fe,{label:"我的申请",value:"history",icon:e.jsx(Je,{})}),e.jsx(fe,{label:"所有申请",value:"all-requests",icon:e.jsx(Ys,{})}),e.jsx(fe,{label:"库存盘点",value:"inventory",icon:e.jsx(Ks,{})})]})}),e.jsx(yt,{open:D,autoHideDuration:6e3,onClose:()=>F(!1),anchorOrigin:{vertical:"top",horizontal:"center"},children:e.jsx(Y,{onClose:()=>F(!1),severity:k,sx:{width:"100%"},children:o})})]}):e.jsx(xr,{onStoreSelect:s}):e.jsx(Pe,{sx:{mt:4},children:e.jsxs(V,{sx:{p:3,textAlign:"center",backgroundColor:"warning.light"},children:[e.jsx(Vs,{sx:{fontSize:48,color:"warning.main"}}),e.jsx(p,{variant:"h5",sx:{mt:2,fontWeight:"bold"},children:"请在飞书客户端中打开"}),e.jsx(p,{sx:{mt:1},children:"此页面需要飞书应用环境支持，请复制链接并在飞书中访问。"})]})})},Sr=window.fetch;window.fetch=function(t,s){const r=sessionStorage.getItem("lockedStoreId"),i=localStorage.getItem("defaultStoreId"),h=r||i,c={...s};return c.headers||(c.headers={}),h&&!c.headers["x-current-store-id"]&&(c.headers["x-current-store-id"]=h),Sr(t,c)};Zt.createRoot(document.getElementById("root")).render(e.jsx(Ue.StrictMode,{children:e.jsx(jr,{})}));
