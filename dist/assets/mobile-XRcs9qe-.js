var Vt=Object.defineProperty;var Ut=(r,s,e)=>s in r?Vt(r,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[s]=e;var p=(r,s,e)=>Ut(r,typeof s!="symbol"?s+"":s,e);import{w as Tt,d as Fe,g as We,r as h,e as Re,b as Ee,_ as F,a6 as ct,m as pe,s as ae,j as a,t as Y,n as Le,B as Mt,be as lt,a3 as Gt,l as Xt,bf as Zt,M as Jt,K as ue,bg as ye,X as Kt,aY as M,aX as V,aZ as Dt,a_ as It,aW as Qe,aU as Ve,bh as Se,bi as Ot,bj as er,bk as tr,aV as Ne,bl as St,bm as Pt,bn as rr,bo as _t,bp as Rt,bq as et,br as nr,bs as dt,bt as sr,ap as oe,aq as ie,ar as ce,as as le,a8 as st,a9 as he,ac as Ie,az as ar,aH as or,aA as ir,aB as ut,ad as _,ab as se,ae as w,aJ as qe,P as Z,af as ne,aP as cr,aa as lr,ak as dr,al as ur,am as hr,an as fr,ao as pr,ah as Pe,ai as _e,au as xe,aE as He,J as Oe,aO as gr,aN as xr,b3 as yr,b4 as rt,bu as mr,b6 as br,b7 as vr,b5 as wr,aQ as jr,ag as K,aR as ht,av as Et,ba as kr,E as nt,aK as Ue,aM as Ge,at as Lt,aL as Cr,aC as Tr,aF as Mr,aG as Dr,aw as Ir,ax as Or,bd as Sr}from"./format-Cn00hWB_.js";function Pr(r){const{badgeContent:s,invisible:e=!1,max:t=99,showZero:n=!1}=r,o=Tt({badgeContent:s,max:t});let c=e;e===!1&&s===0&&!n&&(c=!0);const{badgeContent:f,max:d=t}=c?o:r,g=f&&Number(f)>d?`${d}+`:f;return{badgeContent:f,invisible:c,max:d,displayValue:g}}function _r(r){return We("MuiBadge",r)}const de=Fe("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),Rr=["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"],Xe=10,Ze=4,Er=r=>{const{color:s,anchorOrigin:e,invisible:t,overlap:n,variant:o,classes:c={}}=r,f={root:["root"],badge:["badge",o,t&&"invisible",`anchorOrigin${Y(e.vertical)}${Y(e.horizontal)}`,`anchorOrigin${Y(e.vertical)}${Y(e.horizontal)}${Y(n)}`,`overlap${Y(n)}`,s!=="default"&&`color${Y(s)}`]};return Le(f,_r,c)},Lr=ae("span",{name:"MuiBadge",slot:"Root",overridesResolver:(r,s)=>s.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),qr=ae("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(r,s)=>{const{ownerState:e}=r;return[s.badge,s[e.variant],s[`anchorOrigin${Y(e.anchorOrigin.vertical)}${Y(e.anchorOrigin.horizontal)}${Y(e.overlap)}`],e.color!=="default"&&s[`color${Y(e.color)}`],e.invisible&&s.invisible]}})(({theme:r})=>{var s;return{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:r.typography.fontFamily,fontWeight:r.typography.fontWeightMedium,fontSize:r.typography.pxToRem(12),minWidth:Xe*2,lineHeight:1,padding:"0 6px",height:Xe*2,borderRadius:Xe,zIndex:1,transition:r.transitions.create("transform",{easing:r.transitions.easing.easeInOut,duration:r.transitions.duration.enteringScreen}),variants:[...Object.keys(((s=r.vars)!=null?s:r).palette).filter(e=>{var t,n;return((t=r.vars)!=null?t:r).palette[e].main&&((n=r.vars)!=null?n:r).palette[e].contrastText}).map(e=>({props:{color:e},style:{backgroundColor:(r.vars||r).palette[e].main,color:(r.vars||r).palette[e].contrastText}})),{props:{variant:"dot"},style:{borderRadius:Ze,height:Ze*2,minWidth:Ze*2,padding:0}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${de.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${de.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${de.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${de.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${de.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${de.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${de.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${de.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:r.transitions.create("transform",{easing:r.transitions.easing.easeInOut,duration:r.transitions.duration.leavingScreen})}}]}}),Ar=h.forwardRef(function(s,e){var t,n,o,c,f,d;const g=Re({props:s,name:"MuiBadge"}),{anchorOrigin:x={vertical:"top",horizontal:"right"},className:j,component:C,components:O={},componentsProps:l={},children:m,overlap:T="rectangular",color:y="default",invisible:D=!1,max:R=99,badgeContent:$,slots:E,slotProps:z,showZero:U=!1,variant:i="standard"}=g,u=Ee(g,Rr),{badgeContent:b,invisible:P,max:N,displayValue:W}=Pr({max:R,invisible:D,badgeContent:$,showZero:U}),ee=Tt({anchorOrigin:x,color:y,overlap:T,variant:i,badgeContent:$}),H=P||b==null&&i!=="dot",{color:J=y,overlap:ge=T,anchorOrigin:Ae=x,variant:Be=i}=H?ee:g,$e=Be!=="dot"?W:void 0,k=F({},g,{badgeContent:b,invisible:H,max:N,displayValue:$e,showZero:U,anchorOrigin:Ae,color:J,overlap:ge,variant:Be}),I=Er(k),v=(t=(n=E==null?void 0:E.root)!=null?n:O.Root)!=null?t:Lr,X=(o=(c=E==null?void 0:E.badge)!=null?c:O.Badge)!=null?o:qr,G=(f=z==null?void 0:z.root)!=null?f:l.root,fe=(d=z==null?void 0:z.badge)!=null?d:l.badge,Wt=ct({elementType:v,externalSlotProps:G,externalForwardedProps:u,additionalProps:{ref:e,as:C},ownerState:k,className:pe(G==null?void 0:G.className,I.root,j)}),Qt=ct({elementType:X,externalSlotProps:fe,ownerState:k,className:pe(I.badge,fe==null?void 0:fe.className)});return a.jsxs(v,F({},Wt,{children:[m,a.jsx(X,F({},Qt,{children:$e}))]}))});function Br(r){return We("MuiBottomNavigation",r)}Fe("MuiBottomNavigation",["root"]);const $r=["children","className","component","onChange","showLabels","value"],Nr=r=>{const{classes:s}=r;return Le({root:["root"]},Br,s)},Hr=ae("div",{name:"MuiBottomNavigation",slot:"Root",overridesResolver:(r,s)=>s.root})(({theme:r})=>({display:"flex",justifyContent:"center",height:56,backgroundColor:(r.vars||r).palette.background.paper})),zr=h.forwardRef(function(s,e){const t=Re({props:s,name:"MuiBottomNavigation"}),{children:n,className:o,component:c="div",onChange:f,showLabels:d=!1,value:g}=t,x=Ee(t,$r),j=F({},t,{component:c,showLabels:d}),C=Nr(j);return a.jsx(Hr,F({as:c,className:pe(C.root,o),ref:e,ownerState:j},x,{children:h.Children.map(n,(O,l)=>{if(!h.isValidElement(O))return null;const m=O.props.value===void 0?l:O.props.value;return h.cloneElement(O,{selected:m===g,showLabel:O.props.showLabel!==void 0?O.props.showLabel:d,value:m,onChange:f})})}))});function Yr(r){return We("MuiBottomNavigationAction",r)}const qt=Fe("MuiBottomNavigationAction",["root","iconOnly","selected","label"]),Fr=["className","icon","label","onChange","onClick","selected","showLabel","value"],Wr=r=>{const{classes:s,showLabel:e,selected:t}=r;return Le({root:["root",!e&&!t&&"iconOnly",t&&"selected"],label:["label",!e&&!t&&"iconOnly",t&&"selected"]},Yr,s)},Qr=ae(Mt,{name:"MuiBottomNavigationAction",slot:"Root",overridesResolver:(r,s)=>{const{ownerState:e}=r;return[s.root,!e.showLabel&&!e.selected&&s.iconOnly]}})(({theme:r,ownerState:s})=>F({transition:r.transitions.create(["color","padding-top"],{duration:r.transitions.duration.short}),padding:"0px 12px",minWidth:80,maxWidth:168,color:(r.vars||r).palette.text.secondary,flexDirection:"column",flex:"1"},!s.showLabel&&!s.selected&&{paddingTop:14},!s.showLabel&&!s.selected&&!s.label&&{paddingTop:0},{[`&.${qt.selected}`]:{color:(r.vars||r).palette.primary.main}})),Vr=ae("span",{name:"MuiBottomNavigationAction",slot:"Label",overridesResolver:(r,s)=>s.label})(({theme:r,ownerState:s})=>F({fontFamily:r.typography.fontFamily,fontSize:r.typography.pxToRem(12),opacity:1,transition:"font-size 0.2s, opacity 0.2s",transitionDelay:"0.1s"},!s.showLabel&&!s.selected&&{opacity:0,transitionDelay:"0s"},{[`&.${qt.selected}`]:{fontSize:r.typography.pxToRem(14)}})),me=h.forwardRef(function(s,e){const t=Re({props:s,name:"MuiBottomNavigationAction"}),{className:n,icon:o,label:c,onChange:f,onClick:d,value:g}=t,x=Ee(t,Fr),j=t,C=Wr(j),O=l=>{f&&f(l,g),d&&d(l)};return a.jsxs(Qr,F({ref:e,className:pe(C.root,n),focusRipple:!0,onClick:O,ownerState:j},x,{children:[o,a.jsx(Vr,{className:C.label,ownerState:j,children:c})]}))}),Ur=["alignItems","autoFocus","component","children","dense","disableGutters","divider","focusVisibleClassName","selected","className"],Gr=(r,s)=>{const{ownerState:e}=r;return[s.root,e.dense&&s.dense,e.alignItems==="flex-start"&&s.alignItemsFlexStart,e.divider&&s.divider,!e.disableGutters&&s.gutters]},Xr=r=>{const{alignItems:s,classes:e,dense:t,disabled:n,disableGutters:o,divider:c,selected:f}=r,g=Le({root:["root",t&&"dense",!o&&"gutters",c&&"divider",n&&"disabled",s==="flex-start"&&"alignItemsFlexStart",f&&"selected"]},Zt,e);return F({},e,g)},Zr=ae(Mt,{shouldForwardProp:r=>Jt(r)||r==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:Gr})(({theme:r,ownerState:s})=>F({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:r.transitions.create("background-color",{duration:r.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(r.vars||r).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${ye.selected}`]:{backgroundColor:r.vars?`rgba(${r.vars.palette.primary.mainChannel} / ${r.vars.palette.action.selectedOpacity})`:ue.alpha(r.palette.primary.main,r.palette.action.selectedOpacity),[`&.${ye.focusVisible}`]:{backgroundColor:r.vars?`rgba(${r.vars.palette.primary.mainChannel} / calc(${r.vars.palette.action.selectedOpacity} + ${r.vars.palette.action.focusOpacity}))`:ue.alpha(r.palette.primary.main,r.palette.action.selectedOpacity+r.palette.action.focusOpacity)}},[`&.${ye.selected}:hover`]:{backgroundColor:r.vars?`rgba(${r.vars.palette.primary.mainChannel} / calc(${r.vars.palette.action.selectedOpacity} + ${r.vars.palette.action.hoverOpacity}))`:ue.alpha(r.palette.primary.main,r.palette.action.selectedOpacity+r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:r.vars?`rgba(${r.vars.palette.primary.mainChannel} / ${r.vars.palette.action.selectedOpacity})`:ue.alpha(r.palette.primary.main,r.palette.action.selectedOpacity)}},[`&.${ye.focusVisible}`]:{backgroundColor:(r.vars||r).palette.action.focus},[`&.${ye.disabled}`]:{opacity:(r.vars||r).palette.action.disabledOpacity}},s.divider&&{borderBottom:`1px solid ${(r.vars||r).palette.divider}`,backgroundClip:"padding-box"},s.alignItems==="flex-start"&&{alignItems:"flex-start"},!s.disableGutters&&{paddingLeft:16,paddingRight:16},s.dense&&{paddingTop:4,paddingBottom:4})),Jr=h.forwardRef(function(s,e){const t=Re({props:s,name:"MuiListItemButton"}),{alignItems:n="center",autoFocus:o=!1,component:c="div",children:f,dense:d=!1,disableGutters:g=!1,divider:x=!1,focusVisibleClassName:j,selected:C=!1,className:O}=t,l=Ee(t,Ur),m=h.useContext(lt),T=h.useMemo(()=>({dense:d||m.dense||!1,alignItems:n,disableGutters:g}),[n,m.dense,d,g]),y=h.useRef(null);Gt(()=>{o&&y.current&&y.current.focus()},[o]);const D=F({},t,{alignItems:n,dense:T.dense,disableGutters:g,divider:x,selected:C}),R=Xr(D),$=Xt(y,e);return a.jsx(lt.Provider,{value:T,children:a.jsx(Zr,F({ref:$,href:l.href||l.to,component:(l.href||l.to)&&c==="div"?"button":c,focusVisibleClassName:pe(R.focusVisible,j),ownerState:D,className:pe(R.root,O)},l,{classes:R,children:f}))})});function Kr(r){return We("MuiSwitch",r)}const Q=Fe("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),en=["className","color","edge","size","sx"],tn=r=>{const{classes:s,edge:e,size:t,color:n,checked:o,disabled:c}=r,f={root:["root",e&&`edge${Y(e)}`,`size${Y(t)}`],switchBase:["switchBase",`color${Y(n)}`,o&&"checked",c&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=Le(f,Kr,s);return F({},s,d)},rn=ae("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(r,s)=>{const{ownerState:e}=r;return[s.root,e.edge&&s[`edge${Y(e.edge)}`],s[`size${Y(e.size)}`]]}})({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${Q.thumb}`]:{width:16,height:16},[`& .${Q.switchBase}`]:{padding:4,[`&.${Q.checked}`]:{transform:"translateX(16px)"}}}}]}),nn=ae(Kt,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(r,s)=>{const{ownerState:e}=r;return[s.switchBase,{[`& .${Q.input}`]:s.input},e.color!=="default"&&s[`color${Y(e.color)}`]]}})(({theme:r})=>({position:"absolute",top:0,left:0,zIndex:1,color:r.vars?r.vars.palette.Switch.defaultColor:`${r.palette.mode==="light"?r.palette.common.white:r.palette.grey[300]}`,transition:r.transitions.create(["left","transform"],{duration:r.transitions.duration.shortest}),[`&.${Q.checked}`]:{transform:"translateX(20px)"},[`&.${Q.disabled}`]:{color:r.vars?r.vars.palette.Switch.defaultDisabledColor:`${r.palette.mode==="light"?r.palette.grey[100]:r.palette.grey[600]}`},[`&.${Q.checked} + .${Q.track}`]:{opacity:.5},[`&.${Q.disabled} + .${Q.track}`]:{opacity:r.vars?r.vars.opacity.switchTrackDisabled:`${r.palette.mode==="light"?.12:.2}`},[`& .${Q.input}`]:{left:"-100%",width:"300%"}}),({theme:r})=>({"&:hover":{backgroundColor:r.vars?`rgba(${r.vars.palette.action.activeChannel} / ${r.vars.palette.action.hoverOpacity})`:ue.alpha(r.palette.action.active,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(r.palette).filter(([,s])=>s.main&&s.light).map(([s])=>({props:{color:s},style:{[`&.${Q.checked}`]:{color:(r.vars||r).palette[s].main,"&:hover":{backgroundColor:r.vars?`rgba(${r.vars.palette[s].mainChannel} / ${r.vars.palette.action.hoverOpacity})`:ue.alpha(r.palette[s].main,r.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Q.disabled}`]:{color:r.vars?r.vars.palette.Switch[`${s}DisabledColor`]:`${r.palette.mode==="light"?ue.lighten(r.palette[s].main,.62):ue.darken(r.palette[s].main,.55)}`}},[`&.${Q.checked} + .${Q.track}`]:{backgroundColor:(r.vars||r).palette[s].main}}}))]})),sn=ae("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(r,s)=>s.track})(({theme:r})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:r.transitions.create(["opacity","background-color"],{duration:r.transitions.duration.shortest}),backgroundColor:r.vars?r.vars.palette.common.onBackground:`${r.palette.mode==="light"?r.palette.common.black:r.palette.common.white}`,opacity:r.vars?r.vars.opacity.switchTrack:`${r.palette.mode==="light"?.38:.3}`})),an=ae("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(r,s)=>s.thumb})(({theme:r})=>({boxShadow:(r.vars||r).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),on=h.forwardRef(function(s,e){const t=Re({props:s,name:"MuiSwitch"}),{className:n,color:o="primary",edge:c=!1,size:f="medium",sx:d}=t,g=Ee(t,en),x=F({},t,{color:o,edge:c,size:f}),j=tn(x),C=a.jsx(an,{className:j.thumb,ownerState:x});return a.jsxs(rn,{className:pe(j.root,n),sx:d,ownerState:x,children:[a.jsx(nn,F({type:"checkbox",icon:C,checkedIcon:C,ref:e,ownerState:x},g,{classes:F({},j,{root:j.switchBase})})),a.jsx(sn,{className:j.track,ownerState:x})]})});function At(r,s,e){const t=M(r,e==null?void 0:e.in);if(isNaN(s))return V(r,NaN);if(!s)return t;const n=t.getDate(),o=V(r,t.getTime());o.setMonth(t.getMonth()+s+1,0);const c=o.getDate();return n>=c?o:(t.setFullYear(o.getFullYear(),o.getMonth(),n),t)}function Bt(r,s,e){return V(r,+M(r)+s)}function cn(r,s,e){return Bt(r,s*Dt)}function ln(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setTime(t.getTime()+s*It),t}function dn(r,s,e){return Bt(r,s*1e3)}function un(r,s,e){return Qe(r,s*7,e)}function hn(r,s,e){return At(r,s*12,e)}function fn(r,s,e){const[t,n]=Ve(e==null?void 0:e.in,r,s);return+Se(t)==+Se(n)}function ze(r,s){const e=M(r,s==null?void 0:s.in);return e.setHours(23,59,59,999),e}function ft(r,s){const e=M(r,s==null?void 0:s.in),t=e.getFullYear();return e.setFullYear(t+1,0,0),e.setHours(23,59,59,999),e}function pn(r,s){return M(r,s==null?void 0:s.in).getDate()}function $t(r,s){const e=M(r,s==null?void 0:s.in),t=e.getFullYear(),n=e.getMonth(),o=V(e,0);return o.setFullYear(t,n+1,0),o.setHours(0,0,0,0),o.getDate()}function gn(){return Object.assign({},Ot())}function xn(r,s){return M(r,s==null?void 0:s.in).getHours()}function yn(r,s){const e=M(r,s==null?void 0:s.in).getDay();return e===0?7:e}function mn(r){return M(r).getMilliseconds()}function bn(r,s){return M(r,s==null?void 0:s.in).getMinutes()}function vn(r,s){return M(r,s==null?void 0:s.in).getMonth()}function wn(r){return M(r).getSeconds()}function jn(r,s){return M(r,s==null?void 0:s.in).getFullYear()}function Je(r,s){return+M(r)>+M(s)}function Ke(r,s){return+M(r)<+M(s)}function kn(r,s){return+M(r)==+M(s)}function Cn(r,s){const e=Tn(s)?new s(0):V(s,0);return e.setFullYear(r.getFullYear(),r.getMonth(),r.getDate()),e.setHours(r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()),e}function Tn(r){var s;return typeof r=="function"&&((s=r.prototype)==null?void 0:s.constructor)===r}const Mn=10;class Nt{constructor(){p(this,"subPriority",0)}validate(s,e){return!0}}class Dn extends Nt{constructor(s,e,t,n,o){super(),this.value=s,this.validateValue=e,this.setValue=t,this.priority=n,o&&(this.subPriority=o)}validate(s,e){return this.validateValue(s,this.value,e)}set(s,e,t){return this.setValue(s,e,this.value,t)}}class In extends Nt{constructor(e,t){super();p(this,"priority",Mn);p(this,"subPriority",-1);this.context=e||(n=>V(t,n))}set(e,t){return t.timestampIsSet?e:V(e,Cn(e,this.context))}}class S{run(s,e,t,n){const o=this.parse(s,e,t,n);return o?{setter:new Dn(o.value,this.validate,this.set,this.priority,this.subPriority),rest:o.rest}:null}validate(s,e,t){return!0}}class On extends S{constructor(){super(...arguments);p(this,"priority",140);p(this,"incompatibleTokens",["R","u","t","T"])}parse(e,t,n){switch(t){case"G":case"GG":case"GGG":return n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"});case"GGGGG":return n.era(e,{width:"narrow"});case"GGGG":default:return n.era(e,{width:"wide"})||n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"})}}set(e,t,n){return t.era=n,e.setFullYear(n,0,1),e.setHours(0,0,0,0),e}}const A={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},te={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function B(r,s){return r&&{value:s(r.value),rest:r.rest}}function L(r,s){const e=s.match(r);return e?{value:parseInt(e[0],10),rest:s.slice(e[0].length)}:null}function re(r,s){const e=s.match(r);if(!e)return null;if(e[0]==="Z")return{value:0,rest:s.slice(1)};const t=e[1]==="+"?1:-1,n=e[2]?parseInt(e[2],10):0,o=e[3]?parseInt(e[3],10):0,c=e[5]?parseInt(e[5],10):0;return{value:t*(n*Dt+o*It+c*er),rest:s.slice(e[0].length)}}function Ht(r){return L(A.anyDigitsSigned,r)}function q(r,s){switch(r){case 1:return L(A.singleDigit,s);case 2:return L(A.twoDigits,s);case 3:return L(A.threeDigits,s);case 4:return L(A.fourDigits,s);default:return L(new RegExp("^\\d{1,"+r+"}"),s)}}function Ye(r,s){switch(r){case 1:return L(A.singleDigitSigned,s);case 2:return L(A.twoDigitsSigned,s);case 3:return L(A.threeDigitsSigned,s);case 4:return L(A.fourDigitsSigned,s);default:return L(new RegExp("^-?\\d{1,"+r+"}"),s)}}function at(r){switch(r){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function zt(r,s){const e=s>0,t=e?s:1-s;let n;if(t<=50)n=r||100;else{const o=t+50,c=Math.trunc(o/100)*100,f=r>=o%100;n=r+c-(f?100:0)}return e?n:1-n}function Yt(r){return r%400===0||r%4===0&&r%100!==0}class Sn extends S{constructor(){super(...arguments);p(this,"priority",130);p(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(e,t,n){const o=c=>({year:c,isTwoDigitYear:t==="yy"});switch(t){case"y":return B(q(4,e),o);case"yo":return B(n.ordinalNumber(e,{unit:"year"}),o);default:return B(q(t.length,e),o)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,n){const o=e.getFullYear();if(n.isTwoDigitYear){const f=zt(n.year,o);return e.setFullYear(f,0,1),e.setHours(0,0,0,0),e}const c=!("era"in t)||t.era===1?n.year:1-n.year;return e.setFullYear(c,0,1),e.setHours(0,0,0,0),e}}class Pn extends S{constructor(){super(...arguments);p(this,"priority",130);p(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(e,t,n){const o=c=>({year:c,isTwoDigitYear:t==="YY"});switch(t){case"Y":return B(q(4,e),o);case"Yo":return B(n.ordinalNumber(e,{unit:"year"}),o);default:return B(q(t.length,e),o)}}validate(e,t){return t.isTwoDigitYear||t.year>0}set(e,t,n,o){const c=tr(e,o);if(n.isTwoDigitYear){const d=zt(n.year,c);return e.setFullYear(d,0,o.firstWeekContainsDate),e.setHours(0,0,0,0),Ne(e,o)}const f=!("era"in t)||t.era===1?n.year:1-n.year;return e.setFullYear(f,0,o.firstWeekContainsDate),e.setHours(0,0,0,0),Ne(e,o)}}class _n extends S{constructor(){super(...arguments);p(this,"priority",130);p(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(e,t){return Ye(t==="R"?4:t.length,e)}set(e,t,n){const o=V(e,0);return o.setFullYear(n,0,4),o.setHours(0,0,0,0),St(o)}}class Rn extends S{constructor(){super(...arguments);p(this,"priority",130);p(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(e,t){return Ye(t==="u"?4:t.length,e)}set(e,t,n){return e.setFullYear(n,0,1),e.setHours(0,0,0,0),e}}class En extends S{constructor(){super(...arguments);p(this,"priority",120);p(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(e,t,n){switch(t){case"Q":case"QQ":return q(t.length,e);case"Qo":return n.ordinalNumber(e,{unit:"quarter"});case"QQQ":return n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(e,{width:"wide",context:"formatting"})||n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=1&&t<=4}set(e,t,n){return e.setMonth((n-1)*3,1),e.setHours(0,0,0,0),e}}class Ln extends S{constructor(){super(...arguments);p(this,"priority",120);p(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(e,t,n){switch(t){case"q":case"qq":return q(t.length,e);case"qo":return n.ordinalNumber(e,{unit:"quarter"});case"qqq":return n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(e,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(e,{width:"wide",context:"standalone"})||n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=1&&t<=4}set(e,t,n){return e.setMonth((n-1)*3,1),e.setHours(0,0,0,0),e}}class qn extends S{constructor(){super(...arguments);p(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);p(this,"priority",110)}parse(e,t,n){const o=c=>c-1;switch(t){case"M":return B(L(A.month,e),o);case"MM":return B(q(2,e),o);case"Mo":return B(n.ordinalNumber(e,{unit:"month"}),o);case"MMM":return n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(e,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(e,{width:"wide",context:"formatting"})||n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=11}set(e,t,n){return e.setMonth(n,1),e.setHours(0,0,0,0),e}}class An extends S{constructor(){super(...arguments);p(this,"priority",110);p(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(e,t,n){const o=c=>c-1;switch(t){case"L":return B(L(A.month,e),o);case"LL":return B(q(2,e),o);case"Lo":return B(n.ordinalNumber(e,{unit:"month"}),o);case"LLL":return n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(e,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(e,{width:"wide",context:"standalone"})||n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=11}set(e,t,n){return e.setMonth(n,1),e.setHours(0,0,0,0),e}}function Bn(r,s,e){const t=M(r,e==null?void 0:e.in),n=Pt(t,e)-s;return t.setDate(t.getDate()-n*7),M(t,e==null?void 0:e.in)}class $n extends S{constructor(){super(...arguments);p(this,"priority",100);p(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(e,t,n){switch(t){case"w":return L(A.week,e);case"wo":return n.ordinalNumber(e,{unit:"week"});default:return q(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,n,o){return Ne(Bn(e,n,o),o)}}function Nn(r,s,e){const t=M(r,e==null?void 0:e.in),n=rr(t,e)-s;return t.setDate(t.getDate()-n*7),t}class Hn extends S{constructor(){super(...arguments);p(this,"priority",100);p(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(e,t,n){switch(t){case"I":return L(A.week,e);case"Io":return n.ordinalNumber(e,{unit:"week"});default:return q(t.length,e)}}validate(e,t){return t>=1&&t<=53}set(e,t,n){return St(Nn(e,n))}}const zn=[31,28,31,30,31,30,31,31,30,31,30,31],Yn=[31,29,31,30,31,30,31,31,30,31,30,31];class Fn extends S{constructor(){super(...arguments);p(this,"priority",90);p(this,"subPriority",1);p(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(e,t,n){switch(t){case"d":return L(A.date,e);case"do":return n.ordinalNumber(e,{unit:"date"});default:return q(t.length,e)}}validate(e,t){const n=e.getFullYear(),o=Yt(n),c=e.getMonth();return o?t>=1&&t<=Yn[c]:t>=1&&t<=zn[c]}set(e,t,n){return e.setDate(n),e.setHours(0,0,0,0),e}}class Wn extends S{constructor(){super(...arguments);p(this,"priority",90);p(this,"subpriority",1);p(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(e,t,n){switch(t){case"D":case"DD":return L(A.dayOfYear,e);case"Do":return n.ordinalNumber(e,{unit:"date"});default:return q(t.length,e)}}validate(e,t){const n=e.getFullYear();return Yt(n)?t>=1&&t<=366:t>=1&&t<=365}set(e,t,n){return e.setMonth(0,n),e.setHours(0,0,0,0),e}}function ot(r,s,e){var j,C,O,l;const t=Ot(),n=(e==null?void 0:e.weekStartsOn)??((C=(j=e==null?void 0:e.locale)==null?void 0:j.options)==null?void 0:C.weekStartsOn)??t.weekStartsOn??((l=(O=t.locale)==null?void 0:O.options)==null?void 0:l.weekStartsOn)??0,o=M(r,e==null?void 0:e.in),c=o.getDay(),d=(s%7+7)%7,g=7-n,x=s<0||s>6?s-(c+g)%7:(d+g)%7-(c+g)%7;return Qe(o,x,e)}class Qn extends S{constructor(){super(...arguments);p(this,"priority",90);p(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(e,t,n){switch(t){case"E":case"EE":case"EEE":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEE":default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,n,o){return e=ot(e,n,o),e.setHours(0,0,0,0),e}}class Vn extends S{constructor(){super(...arguments);p(this,"priority",90);p(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(e,t,n,o){const c=f=>{const d=Math.floor((f-1)/7)*7;return(f+o.weekStartsOn+6)%7+d};switch(t){case"e":case"ee":return B(q(t.length,e),c);case"eo":return B(n.ordinalNumber(e,{unit:"day"}),c);case"eee":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeeee":return n.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeee":default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=6}set(e,t,n,o){return e=ot(e,n,o),e.setHours(0,0,0,0),e}}class Un extends S{constructor(){super(...arguments);p(this,"priority",90);p(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(e,t,n,o){const c=f=>{const d=Math.floor((f-1)/7)*7;return(f+o.weekStartsOn+6)%7+d};switch(t){case"c":case"cc":return B(q(t.length,e),c);case"co":return B(n.ordinalNumber(e,{unit:"day"}),c);case"ccc":return n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"ccccc":return n.day(e,{width:"narrow",context:"standalone"});case"cccccc":return n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"cccc":default:return n.day(e,{width:"wide",context:"standalone"})||n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"})}}validate(e,t){return t>=0&&t<=6}set(e,t,n,o){return e=ot(e,n,o),e.setHours(0,0,0,0),e}}function Gn(r,s,e){const t=M(r,e==null?void 0:e.in),n=yn(t,e),o=s-n;return Qe(t,o,e)}class Xn extends S{constructor(){super(...arguments);p(this,"priority",90);p(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(e,t,n){const o=c=>c===0?7:c;switch(t){case"i":case"ii":return q(t.length,e);case"io":return n.ordinalNumber(e,{unit:"day"});case"iii":return B(n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),o);case"iiiii":return B(n.day(e,{width:"narrow",context:"formatting"}),o);case"iiiiii":return B(n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),o);case"iiii":default:return B(n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"}),o)}}validate(e,t){return t>=1&&t<=7}set(e,t,n){return e=Gn(e,n),e.setHours(0,0,0,0),e}}class Zn extends S{constructor(){super(...arguments);p(this,"priority",80);p(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(e,t,n){switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,n){return e.setHours(at(n),0,0,0),e}}class Jn extends S{constructor(){super(...arguments);p(this,"priority",80);p(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(e,t,n){switch(t){case"b":case"bb":case"bbb":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,n){return e.setHours(at(n),0,0,0),e}}class Kn extends S{constructor(){super(...arguments);p(this,"priority",80);p(this,"incompatibleTokens",["a","b","t","T"])}parse(e,t,n){switch(t){case"B":case"BB":case"BBB":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,t,n){return e.setHours(at(n),0,0,0),e}}class es extends S{constructor(){super(...arguments);p(this,"priority",70);p(this,"incompatibleTokens",["H","K","k","t","T"])}parse(e,t,n){switch(t){case"h":return L(A.hour12h,e);case"ho":return n.ordinalNumber(e,{unit:"hour"});default:return q(t.length,e)}}validate(e,t){return t>=1&&t<=12}set(e,t,n){const o=e.getHours()>=12;return o&&n<12?e.setHours(n+12,0,0,0):!o&&n===12?e.setHours(0,0,0,0):e.setHours(n,0,0,0),e}}class ts extends S{constructor(){super(...arguments);p(this,"priority",70);p(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(e,t,n){switch(t){case"H":return L(A.hour23h,e);case"Ho":return n.ordinalNumber(e,{unit:"hour"});default:return q(t.length,e)}}validate(e,t){return t>=0&&t<=23}set(e,t,n){return e.setHours(n,0,0,0),e}}class rs extends S{constructor(){super(...arguments);p(this,"priority",70);p(this,"incompatibleTokens",["h","H","k","t","T"])}parse(e,t,n){switch(t){case"K":return L(A.hour11h,e);case"Ko":return n.ordinalNumber(e,{unit:"hour"});default:return q(t.length,e)}}validate(e,t){return t>=0&&t<=11}set(e,t,n){return e.getHours()>=12&&n<12?e.setHours(n+12,0,0,0):e.setHours(n,0,0,0),e}}class ns extends S{constructor(){super(...arguments);p(this,"priority",70);p(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(e,t,n){switch(t){case"k":return L(A.hour24h,e);case"ko":return n.ordinalNumber(e,{unit:"hour"});default:return q(t.length,e)}}validate(e,t){return t>=1&&t<=24}set(e,t,n){const o=n<=24?n%24:n;return e.setHours(o,0,0,0),e}}class ss extends S{constructor(){super(...arguments);p(this,"priority",60);p(this,"incompatibleTokens",["t","T"])}parse(e,t,n){switch(t){case"m":return L(A.minute,e);case"mo":return n.ordinalNumber(e,{unit:"minute"});default:return q(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,n){return e.setMinutes(n,0,0),e}}class as extends S{constructor(){super(...arguments);p(this,"priority",50);p(this,"incompatibleTokens",["t","T"])}parse(e,t,n){switch(t){case"s":return L(A.second,e);case"so":return n.ordinalNumber(e,{unit:"second"});default:return q(t.length,e)}}validate(e,t){return t>=0&&t<=59}set(e,t,n){return e.setSeconds(n,0),e}}class os extends S{constructor(){super(...arguments);p(this,"priority",30);p(this,"incompatibleTokens",["t","T"])}parse(e,t){const n=o=>Math.trunc(o*Math.pow(10,-t.length+3));return B(q(t.length,e),n)}set(e,t,n){return e.setMilliseconds(n),e}}class is extends S{constructor(){super(...arguments);p(this,"priority",10);p(this,"incompatibleTokens",["t","T","x"])}parse(e,t){switch(t){case"X":return re(te.basicOptionalMinutes,e);case"XX":return re(te.basic,e);case"XXXX":return re(te.basicOptionalSeconds,e);case"XXXXX":return re(te.extendedOptionalSeconds,e);case"XXX":default:return re(te.extended,e)}}set(e,t,n){return t.timestampIsSet?e:V(e,e.getTime()-_t(e)-n)}}class cs extends S{constructor(){super(...arguments);p(this,"priority",10);p(this,"incompatibleTokens",["t","T","X"])}parse(e,t){switch(t){case"x":return re(te.basicOptionalMinutes,e);case"xx":return re(te.basic,e);case"xxxx":return re(te.basicOptionalSeconds,e);case"xxxxx":return re(te.extendedOptionalSeconds,e);case"xxx":default:return re(te.extended,e)}}set(e,t,n){return t.timestampIsSet?e:V(e,e.getTime()-_t(e)-n)}}class ls extends S{constructor(){super(...arguments);p(this,"priority",40);p(this,"incompatibleTokens","*")}parse(e){return Ht(e)}set(e,t,n){return[V(e,n*1e3),{timestampIsSet:!0}]}}class ds extends S{constructor(){super(...arguments);p(this,"priority",20);p(this,"incompatibleTokens","*")}parse(e){return Ht(e)}set(e,t,n){return[V(e,n),{timestampIsSet:!0}]}}const us={G:new On,y:new Sn,Y:new Pn,R:new _n,u:new Rn,Q:new En,q:new Ln,M:new qn,L:new An,w:new $n,I:new Hn,d:new Fn,D:new Wn,E:new Qn,e:new Vn,c:new Un,i:new Xn,a:new Zn,b:new Jn,B:new Kn,h:new es,H:new ts,K:new rs,k:new ns,m:new ss,s:new as,S:new os,X:new is,x:new cs,t:new ls,T:new ds},hs=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,fs=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ps=/^'([^]*?)'?$/,gs=/''/g,xs=/\S/,ys=/[a-zA-Z]/;function ms(r,s,e,t){var T,y,D,R,$,E,z,U;const n=()=>V((t==null?void 0:t.in)||e,NaN),o=gn(),c=(t==null?void 0:t.locale)??o.locale??Rt,f=(t==null?void 0:t.firstWeekContainsDate)??((y=(T=t==null?void 0:t.locale)==null?void 0:T.options)==null?void 0:y.firstWeekContainsDate)??o.firstWeekContainsDate??((R=(D=o.locale)==null?void 0:D.options)==null?void 0:R.firstWeekContainsDate)??1,d=(t==null?void 0:t.weekStartsOn)??((E=($=t==null?void 0:t.locale)==null?void 0:$.options)==null?void 0:E.weekStartsOn)??o.weekStartsOn??((U=(z=o.locale)==null?void 0:z.options)==null?void 0:U.weekStartsOn)??0;if(!s)return r?n():M(e,t==null?void 0:t.in);const g={firstWeekContainsDate:f,weekStartsOn:d,locale:c},x=[new In(t==null?void 0:t.in,e)],j=s.match(fs).map(i=>{const u=i[0];if(u in et){const b=et[u];return b(i,c.formatLong)}return i}).join("").match(hs),C=[];for(let i of j){!(t!=null&&t.useAdditionalWeekYearTokens)&&nr(i)&&dt(i,s,r),!(t!=null&&t.useAdditionalDayOfYearTokens)&&sr(i)&&dt(i,s,r);const u=i[0],b=us[u];if(b){const{incompatibleTokens:P}=b;if(Array.isArray(P)){const W=C.find(ee=>P.includes(ee.token)||ee.token===u);if(W)throw new RangeError(`The format string mustn't contain \`${W.fullToken}\` and \`${i}\` at the same time`)}else if(b.incompatibleTokens==="*"&&C.length>0)throw new RangeError(`The format string mustn't contain \`${i}\` and any other token at the same time`);C.push({token:u,fullToken:i});const N=b.run(r,i,c.match,g);if(!N)return n();x.push(N.setter),r=N.rest}else{if(u.match(ys))throw new RangeError("Format string contains an unescaped latin alphabet character `"+u+"`");if(i==="''"?i="'":u==="'"&&(i=bs(i)),r.indexOf(i)===0)r=r.slice(i.length);else return n()}}if(r.length>0&&xs.test(r))return n();const O=x.map(i=>i.priority).sort((i,u)=>u-i).filter((i,u,b)=>b.indexOf(i)===u).map(i=>x.filter(u=>u.priority===i).sort((u,b)=>b.subPriority-u.subPriority)).map(i=>i[0]);let l=M(e,t==null?void 0:t.in);if(isNaN(+l))return n();const m={};for(const i of O){if(!i.validate(l,g))return n();const u=i.set(l,m,g);Array.isArray(u)?(l=u[0],Object.assign(m,u[1])):l=u}return l}function bs(r){return r.match(ps)[1].replace(gs,"'")}function pt(r,s){const e=M(r,s==null?void 0:s.in);return e.setMinutes(0,0,0),e}function vs(r,s,e){const[t,n]=Ve(e==null?void 0:e.in,r,s);return+pt(t)==+pt(n)}function ws(r,s,e){const[t,n]=Ve(e==null?void 0:e.in,r,s);return t.getFullYear()===n.getFullYear()&&t.getMonth()===n.getMonth()}function js(r,s,e){const[t,n]=Ve(e==null?void 0:e.in,r,s);return t.getFullYear()===n.getFullYear()}function ks(r,s,e){const t=+M(r,e==null?void 0:e.in),[n,o]=[+M(s.start,e==null?void 0:e.in),+M(s.end,e==null?void 0:e.in)].sort((c,f)=>c-f);return t>=n&&t<=o}function Cs(r,s,e){const t=M(r,e==null?void 0:e.in),n=t.getFullYear(),o=t.getDate(),c=V(r,0);c.setFullYear(n,s,15),c.setHours(0,0,0,0);const f=$t(c);return t.setMonth(s,Math.min(o,f)),t}function Ts(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setDate(s),t}function Ms(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setHours(s),t}function Ds(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setMilliseconds(s),t}function Is(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setMinutes(s),t}function Os(r,s,e){const t=M(r,e==null?void 0:e.in);return t.setSeconds(s),t}function Ss(r,s,e){const t=M(r,e==null?void 0:e.in);return isNaN(+t)?V(r,NaN):(t.setFullYear(s),t)}var be={},gt;function Ps(){if(gt)return be;gt=1;var r=oe();Object.defineProperty(be,"__esModule",{value:!0}),be.default=void 0;var s=r(ie()),e=ce();return be.default=(0,s.default)((0,e.jsx)("path",{d:"m17.21 9-4.38-6.56c-.19-.28-.51-.42-.83-.42-.32 0-.64.14-.83.43L6.79 9H2c-.55 0-1 .45-1 1 0 .09.01.18.04.27l2.54 9.27c.23.84 1 1.46 1.92 1.46h13c.92 0 1.69-.62 1.93-1.46l2.54-9.27L23 10c0-.55-.45-1-1-1zM9 9l3-4.4L15 9zm3 8c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"}),"ShoppingBasket"),be}var _s=Ps();const Rs=le(_s);var ve={},xt;function Es(){if(xt)return ve;xt=1;var r=oe();Object.defineProperty(ve,"__esModule",{value:!0}),ve.default=void 0;var s=r(ie()),e=ce();return ve.default=(0,s.default)((0,e.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart"),ve}var Ls=Es();const Ft=le(Ls);var we={},yt;function qs(){if(yt)return we;yt=1;var r=oe();Object.defineProperty(we,"__esModule",{value:!0}),we.default=void 0;var s=r(ie()),e=ce();return we.default=(0,s.default)((0,e.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),we}var As=qs();const it=le(As);var je={},mt;function Bs(){if(mt)return je;mt=1;var r=oe();Object.defineProperty(je,"__esModule",{value:!0}),je.default=void 0;var s=r(ie()),e=ce();return je.default=(0,s.default)([(0,e.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3 6.08 3 3.28 5.64 3.03 9h2.02C5.3 6.75 7.18 5 9.5 5 11.99 5 14 7.01 14 9.5S11.99 14 9.5 14c-.17 0-.33-.03-.5-.05v2.02c.17.02.33.03.5.03 1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19z"},"0"),(0,e.jsx)("path",{d:"M6.47 10.82 4 13.29l-2.47-2.47-.71.71L3.29 14 .82 16.47l.71.71L4 14.71l2.47 2.47.71-.71L4.71 14l2.47-2.47z"},"1")],"SearchOff"),je}var $s=Bs();const Ns=le($s);var ke={},bt;function Hs(){if(bt)return ke;bt=1;var r=oe();Object.defineProperty(ke,"__esModule",{value:!0}),ke.default=void 0;var s=r(ie()),e=ce();return ke.default=(0,s.default)((0,e.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),ke}var zs=Hs();const Ys=le(zs);var Ce={},vt;function Fs(){if(vt)return Ce;vt=1;var r=oe();Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.default=void 0;var s=r(ie()),e=ce();return Ce.default=(0,s.default)((0,e.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"ReportProblem"),Ce}var Ws=Fs();const Qs=le(Ws);var Te={},wt;function Vs(){if(wt)return Te;wt=1;var r=oe();Object.defineProperty(Te,"__esModule",{value:!0}),Te.default=void 0;var s=r(ie()),e=ce();return Te.default=(0,s.default)((0,e.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 4c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6m0 14c-2.03 0-4.43-.82-6.14-2.88C7.55 15.8 9.68 15 12 15s4.45.8 6.14 2.12C16.43 19.18 14.03 20 12 20"}),"AccountCircle"),Te}var Us=Vs();const Gs=le(Us);var Me={},jt;function Xs(){if(jt)return Me;jt=1;var r=oe();Object.defineProperty(Me,"__esModule",{value:!0}),Me.default=void 0;var s=r(ie()),e=ce();return Me.default=(0,s.default)((0,e.jsx)("path",{d:"M20 2H4c-1 0-2 .9-2 2v3.01c0 .72.43 1.34 1 1.69V20c0 1.1 1.1 2 2 2h14c.9 0 2-.9 2-2V8.7c.57-.35 1-.97 1-1.69V4c0-1.1-1-2-2-2m-5 12H9v-2h6zm5-7H4V4l16-.02z"}),"Inventory"),Me}var Zs=Xs();const Js=le(Zs);var De={},kt;function Ks(){if(kt)return De;kt=1;var r=oe();Object.defineProperty(De,"__esModule",{value:!0}),De.default=void 0;var s=r(ie()),e=ce();return De.default=(0,s.default)((0,e.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-5 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"}),"Article"),De}var ea=Ks();const ta=le(ea),ra={1:"搅拌",2:"丹麦",3:"整形",4:"烤炉",5:"冷加工",6:"收银打包",7:"水吧",8:"馅料",9:"小库房"},na=st.forwardRef(function(s,e){return a.jsx(he,{elevation:6,ref:e,variant:"filled",...s})}),sa=()=>{const[r,s]=h.useState([]),[e,t]=h.useState(!0),[n,o]=h.useState(null),[c,f]=h.useState(""),[d,g]=h.useState([]),[x,j]=h.useState({}),[C,O]=h.useState(!1),[l,m]=h.useState(!1),[T,y]=h.useState(""),[D,R]=h.useState("info"),[$,E]=h.useState(!1),[z,U]=h.useState(null),[i,u]=h.useState(0),b=h.useCallback(async()=>{var k;t(!0),o(null);try{const I=await fetch("/api/ingredients/list",{method:"POST",headers:{"Content-Type":"application/json","x-current-store-id":localStorage.getItem("currentStoreId")},body:JSON.stringify({})});if(!I.ok)throw new Error(`HTTP error! status: ${I.status}`);const v=await I.json();v.success&&Array.isArray(v.data)?(console.log("MobileInventoryCheck - 获取到的原料数据:",v.data),console.log("第一个原料的post字段:",(k=v.data[0])==null?void 0:k.post),s(v.data)):o(v.message||"Failed to load ingredients data.")}catch(I){o(`Error fetching ingredients: ${I.message}`)}finally{t(!1)}},[]);h.useEffect(()=>{b()},[b]),h.useEffect(()=>{if(c&&r.length>0){console.log("MobileInventoryCheck - 选择的岗位:",c),console.log("MobileInventoryCheck - 所有原料数量:",r.length);const k=r.filter((v,X)=>{const G=v.stockByPost&&v.stockByPost[c]&&v.stockByPost[c].quantity>0,fe=Array.isArray(v.post)&&v.post.map(String).includes(String(c));return X<3&&console.log(`原料 ${X}: ${v.name}`,{stockByPost:v.stockByPost,hasStockInPost:G,post:v.post,isAssignedToPost:fe,selectedPost:c,finalResult:G||fe}),G||fe});console.log("MobileInventoryCheck - 过滤后的原料:",k),console.log("MobileInventoryCheck - 过滤后的原料数量:",k.length),g(k);const I={};k.forEach(v=>{let X="";if(v.stockByPost){const G=new Map(Object.entries(v.stockByPost));G.has(c)&&G.get(c)&&typeof G.get(c).quantity=="number"&&(X=G.get(c).quantity.toString())}I[v._id]=X}),j(I)}else g([]),j({})},[c,r]);const P=(k,I="info")=>{y(k),R(I),m(!0)},N=(k,I)=>{I!=="clickaway"&&m(!1)},W=k=>{f(k.target.value)},ee=h.useCallback((k,I)=>{const v=I.replace(/[^0-9.]/g,"");j(X=>({...X,[k]:v}))},[]),H=k=>{const I=parseFloat(x[k]||0);ee(k,(I+1).toString())},J=k=>{const I=parseFloat(x[k]||0);ee(k,Math.max(0,I-1).toString())},ge=async()=>{if(!c){P("请先选择一个岗位。","warning");return}const k=d.filter(v=>x[v._id]===""||x[v._id]===void 0),I=d.map(v=>({ingredientId:v._id,ingredientName:v.name,quantity:parseFloat(x[v._id]),unit:v.unit||v.baseUnit||v.min||"g",baseUnit:v.baseUnit||v.min,norms:v.norms})).filter(v=>!isNaN(v.quantity)&&v.quantity>=0);if(I.length===0&&d.length>0){P("没有有效的库存数量被输入。","warning");return}if(k.length>0){u(k.length),U(I),E(!0);return}I.length>0?await Ae(I):d.length===0&&P("当前岗位没有需要盘点的物料。","info")},Ae=async k=>{O(!0);try{const I=await fetch("/api/inventory/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:c,stocks:k})}),v=await I.json();if(!I.ok)throw new Error(v.message||"HTTP error!");if(v.success)P(v.message||"库存盘点数据提交成功！","success"),b();else throw new Error(v.message||"库存提交失败")}catch(I){P(`提交失败: ${I.message}`,"error")}finally{O(!1),E(!1)}},Be=()=>{z&&Ae(z),E(!1)},$e=k=>{var I,v,X;return(X=(v=(I=k.stockByPost)==null?void 0:I[c])==null?void 0:v.quantity)!=null&&X.toFixed(2),a.jsx(Pe,{sx:{mb:2},children:a.jsxs(_e,{children:[a.jsx(w,{variant:"h6",component:"div",children:k.name}),a.jsxs(w,{sx:{mb:1.5},color:"text.secondary",children:["规格: ",k.specs||"N/A"," | 单位:"," ",k.unit||k.baseUnit||k.min||"g"]}),a.jsx(_,{display:"flex",alignItems:"center",children:a.jsx(xe,{fullWidth:!0,label:"实际库存",variant:"outlined",type:"number",value:x[k._id]||"",onChange:G=>ee(k._id,G.target.value),InputProps:{startAdornment:a.jsx(He,{position:"start",children:a.jsx(Oe,{onClick:()=>J(k._id),size:"small",children:a.jsx(xr,{})})}),endAdornment:a.jsx(He,{position:"end",children:a.jsx(Oe,{onClick:()=>H(k._id),size:"small",children:a.jsx(gr,{})})})}})})]})},k._id)};return a.jsxs(Ie,{sx:{pb:8,pt:2},children:[a.jsxs(ar,{fullWidth:!0,sx:{mb:2},children:[a.jsx(or,{id:"post-select-label",children:"选择岗位"}),a.jsxs(ir,{labelId:"post-select-label",value:c,label:"选择岗位",onChange:W,children:[a.jsx(ut,{value:"",children:a.jsx("em",{children:"请选择..."})}),Object.entries(ra).map(([k,I])=>a.jsx(ut,{value:k,children:I},k))]})]}),e&&a.jsx(_,{sx:{display:"flex",justifyContent:"center",my:3},children:a.jsx(se,{})}),n&&a.jsx(w,{color:"error",align:"center",children:n}),!c&&a.jsx(w,{align:"center",color:"text.secondary",children:"请先选择一个岗位开始盘点。"}),c&&!e&&d.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs(w,{variant:"h6",sx:{mb:2},children:["找到 ",d.length," 个原料需要盘点"]}),a.jsx(qe,{children:d.map($e)})]}),c&&!e&&d.length===0&&a.jsx(w,{align:"center",color:"text.secondary",sx:{mt:4},children:"当前岗位下没有需要盘点的物料。"}),a.jsx(Z,{elevation:3,sx:{position:"fixed",bottom:56,left:0,right:0,p:2,zIndex:1e3},children:a.jsx(ne,{fullWidth:!0,variant:"contained",color:"primary",size:"large",onClick:ge,disabled:C||!c||d.length===0,startIcon:C?a.jsx(se,{size:20,color:"inherit"}):a.jsx(cr,{}),children:C?"正在提交...":"提交盘点"})}),a.jsx(lr,{open:l,autoHideDuration:6e3,onClose:N,anchorOrigin:{vertical:"top",horizontal:"center"},children:a.jsx(na,{onClose:N,severity:D,sx:{width:"100%"},children:T})}),a.jsxs(dr,{open:$,onClose:()=>E(!1),children:[a.jsx(ur,{children:"确认提交"}),a.jsx(hr,{children:a.jsxs(fr,{children:["您有 ",i," ","项物料未填写库存，确定要提交吗？未填写的项目将不会被保存。"]})}),a.jsxs(pr,{children:[a.jsx(ne,{onClick:()=>E(!1),children:"取消"}),a.jsx(ne,{onClick:Be,color:"primary",autoFocus:!0,children:"确认提交"})]})]})]})},aa={y:{sectionType:"year",contentType:"digit",maxLength:4},yy:"year",yyy:{sectionType:"year",contentType:"digit",maxLength:4},yyyy:"year",M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMMM:{sectionType:"month",contentType:"letter"},MMM:{sectionType:"month",contentType:"letter"},L:{sectionType:"month",contentType:"digit",maxLength:2},LL:"month",LLL:{sectionType:"month",contentType:"letter"},LLLL:{sectionType:"month",contentType:"letter"},d:{sectionType:"day",contentType:"digit",maxLength:2},dd:"day",do:{sectionType:"day",contentType:"digit-with-letter"},E:{sectionType:"weekDay",contentType:"letter"},EE:{sectionType:"weekDay",contentType:"letter"},EEE:{sectionType:"weekDay",contentType:"letter"},EEEE:{sectionType:"weekDay",contentType:"letter"},EEEEE:{sectionType:"weekDay",contentType:"letter"},i:{sectionType:"weekDay",contentType:"digit",maxLength:1},ii:"weekDay",iii:{sectionType:"weekDay",contentType:"letter"},iiii:{sectionType:"weekDay",contentType:"letter"},e:{sectionType:"weekDay",contentType:"digit",maxLength:1},ee:"weekDay",eee:{sectionType:"weekDay",contentType:"letter"},eeee:{sectionType:"weekDay",contentType:"letter"},eeeee:{sectionType:"weekDay",contentType:"letter"},eeeeee:{sectionType:"weekDay",contentType:"letter"},c:{sectionType:"weekDay",contentType:"digit",maxLength:1},cc:"weekDay",ccc:{sectionType:"weekDay",contentType:"letter"},cccc:{sectionType:"weekDay",contentType:"letter"},ccccc:{sectionType:"weekDay",contentType:"letter"},cccccc:{sectionType:"weekDay",contentType:"letter"},a:"meridiem",aa:"meridiem",aaa:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},oa={year:"yyyy",month:"LLLL",monthShort:"MMM",dayOfMonth:"d",dayOfMonthFull:"do",weekday:"EEEE",weekdayShort:"EEEEEE",hours24h:"HH",hours12h:"hh",meridiem:"aa",minutes:"mm",seconds:"ss",fullDate:"PP",keyboardDate:"P",shortDate:"MMM d",normalDate:"d MMMM",normalDateWithWeekday:"EEE, MMM d",fullTime12h:"hh:mm aa",fullTime24h:"HH:mm",keyboardDateTime12h:"P hh:mm aa",keyboardDateTime24h:"P HH:mm"};class ia{constructor(s){this.isMUIAdapter=!0,this.isTimezoneCompatible=!1,this.lib=void 0,this.locale=void 0,this.formats=void 0,this.formatTokenMap=aa,this.escapedCharacters={start:"'",end:"'"},this.longFormatters=void 0,this.date=c=>typeof c>"u"?new Date:c===null?null:new Date(c),this.getInvalidDate=()=>new Date("Invalid Date"),this.getTimezone=()=>"default",this.setTimezone=c=>c,this.toJsDate=c=>c,this.getCurrentLocaleCode=()=>this.locale.code,this.is12HourCycleInCurrentLocale=()=>/a/.test(this.locale.formatLong.time({width:"short"})),this.expandFormat=c=>{const f=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;return c.match(f).map(d=>{const g=d[0];if(g==="p"||g==="P"){const x=this.longFormatters[g];return x(d,this.locale.formatLong)}return d}).join("")},this.formatNumber=c=>c,this.getDayOfWeek=c=>c.getDay()+1;const{locale:e,formats:t,longFormatters:n,lib:o}=s;this.locale=e,this.formats=F({},oa,t),this.longFormatters=n,this.lib=o||"date-fns"}}class ca extends ia{constructor({locale:s,formats:e}={}){super({locale:s??Rt,formats:e,longFormatters:et}),this.parse=(t,n)=>t===""?null:ms(t,n,new Date,{locale:this.locale}),this.isValid=t=>t==null?!1:yr(t),this.format=(t,n)=>this.formatByString(t,this.formats[n]),this.formatByString=(t,n)=>rt(t,n,{locale:this.locale}),this.isEqual=(t,n)=>t===null&&n===null?!0:t===null||n===null?!1:kn(t,n),this.isSameYear=(t,n)=>js(t,n),this.isSameMonth=(t,n)=>ws(t,n),this.isSameDay=(t,n)=>fn(t,n),this.isSameHour=(t,n)=>vs(t,n),this.isAfter=(t,n)=>Je(t,n),this.isAfterYear=(t,n)=>Je(t,ft(n)),this.isAfterDay=(t,n)=>Je(t,ze(n)),this.isBefore=(t,n)=>Ke(t,n),this.isBeforeYear=(t,n)=>Ke(t,this.startOfYear(n)),this.isBeforeDay=(t,n)=>Ke(t,this.startOfDay(n)),this.isWithinRange=(t,[n,o])=>ks(t,{start:n,end:o}),this.startOfYear=t=>mr(t),this.startOfMonth=t=>br(t),this.startOfWeek=t=>Ne(t,{locale:this.locale}),this.startOfDay=t=>Se(t),this.endOfYear=t=>ft(t),this.endOfMonth=t=>vr(t),this.endOfWeek=t=>wr(t,{locale:this.locale}),this.endOfDay=t=>ze(t),this.addYears=(t,n)=>hn(t,n),this.addMonths=(t,n)=>At(t,n),this.addWeeks=(t,n)=>un(t,n),this.addDays=(t,n)=>Qe(t,n),this.addHours=(t,n)=>cn(t,n),this.addMinutes=(t,n)=>ln(t,n),this.addSeconds=(t,n)=>dn(t,n),this.getYear=t=>jn(t),this.getMonth=t=>vn(t),this.getDate=t=>pn(t),this.getHours=t=>xn(t),this.getMinutes=t=>bn(t),this.getSeconds=t=>wn(t),this.getMilliseconds=t=>mn(t),this.setYear=(t,n)=>Ss(t,n),this.setMonth=(t,n)=>Cs(t,n),this.setDate=(t,n)=>Ts(t,n),this.setHours=(t,n)=>Ms(t,n),this.setMinutes=(t,n)=>Is(t,n),this.setSeconds=(t,n)=>Os(t,n),this.setMilliseconds=(t,n)=>Ds(t,n),this.getDaysInMonth=t=>$t(t),this.getWeekArray=t=>{const n=this.startOfWeek(this.startOfMonth(t)),o=this.endOfWeek(this.endOfMonth(t));let c=0,f=n;const d=[];for(;this.isBefore(f,o);){const g=Math.floor(c/7);d[g]=d[g]||[],d[g].push(f),f=this.addDays(f,1),c+=1}return d},this.getWeekNumber=t=>Pt(t,{locale:this.locale}),this.getYearRange=([t,n])=>{const o=this.startOfYear(t),c=this.endOfYear(n),f=[];let d=o;for(;this.isBefore(d,c);)f.push(d),d=this.addYears(d,1);return f}}}const la={pending:"待处理",approved:"已批准",rejected:"已拒绝",completed:"已完成"},Ct=r=>{switch(r){case"completed":return"success";case"approved":return"info";case"rejected":return"error";case"pending":default:return"warning"}},da=({storeId:r,user:s})=>{const[e,t]=h.useState([]),[n,o]=h.useState(!0),[c,f]=h.useState(""),[d,g]=h.useState(Se(new Date)),[x,j]=h.useState(ze(new Date)),[C,O]=h.useState(""),[l,m]=h.useState(!0),[T,y]=h.useState(!1),[D,R]=h.useState(new Set),$=h.useCallback(async()=>{if(r){o(!0),f("");try{const i=rt(d,"yyyy-MM-dd"),u=rt(x,"yyyy-MM-dd"),b=await fetch(`/api/transfer-requests?startDate=${i}&endDate=${u}`);if(!b.ok){const N=await b.json();throw new Error(N.message||"获取申请记录失败")}const P=await b.json();t(P.sort((N,W)=>new Date(W.createdAt)-new Date(N.createdAt)))}catch(i){f(i.message)}finally{o(!1)}}},[r,d,x]);h.useEffect(()=>{$()},[$]),h.useEffect(()=>{(async()=>{var u;if(!(!r||!(s!=null&&s.name)))try{const b=await fetch(`/api/stores/${r}`);if(b.ok){const N=((u=(await b.json()).data)==null?void 0:u.warehouseManagers)||[];y(N.includes(s.name))}}catch(b){console.error("检查库管权限失败:",b)}})()},[r,s]);const E=h.useMemo(()=>C.trim()?e.filter(i=>i.requestedBy&&i.requestedBy.toLowerCase().includes(C.toLowerCase().trim())):e,[e,C]),z=h.useMemo(()=>{if(!l)return null;const i=new Map,u=new Set;return E.forEach(b=>{u.add(b.requestedBy||"未知"),b.items.forEach(P=>{const N=P.name;if(i.has(N)){const W=i.get(N);W.quantity+=P.quantity,W.requesters.add(b.requestedBy||"未知")}else i.set(N,{name:P.name,unit:P.unit,quantity:P.quantity,requesters:new Set([b.requestedBy||"未知"])})})}),{items:Array.from(i.values()).map(b=>({...b,requesters:Array.from(b.requesters)})),totalRequesters:u.size,totalRequests:E.length}},[E,l]),U=async i=>{if(!(s!=null&&s.name)){alert("用户信息缺失");return}R(u=>new Set(u).add(i));try{const u=await fetch(`/api/transfer-requests/${i}/mobile-approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:s.name})}),b=await u.json();u.ok?(alert("申请已批准！"),$()):alert(b.message||"批准失败")}catch(u){console.error("批准申请失败:",u),alert("批准申请时发生错误")}finally{R(u=>{const b=new Set(u);return b.delete(i),b})}};return a.jsx(jr,{dateAdapter:ca,children:a.jsxs(_,{children:[a.jsx(w,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:"所有申请单据"}),a.jsx(Z,{sx:{p:2,mb:2},children:a.jsxs(K,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(K,{item:!0,xs:6,children:a.jsx(ht,{label:"开始日期",value:d,onChange:i=>g(Se(i)),renderInput:i=>a.jsx(xe,{...i,fullWidth:!0,size:"small"})})}),a.jsx(K,{item:!0,xs:6,children:a.jsx(ht,{label:"结束日期",value:x,onChange:i=>j(ze(i)),renderInput:i=>a.jsx(xe,{...i,fullWidth:!0,size:"small"})})}),a.jsx(K,{item:!0,xs:12,children:a.jsx(xe,{fullWidth:!0,size:"small",label:"按申请人姓名过滤",placeholder:"输入申请人姓名...",value:C,onChange:i=>O(i.target.value),variant:"outlined"})}),a.jsxs(K,{item:!0,xs:12,children:[a.jsx(Et,{sx:{my:1}}),a.jsx(kr,{control:a.jsx(on,{checked:l,onChange:i=>m(i.target.checked),color:"primary"}),label:"聚合模式 - 按物料汇总当天所有申请"})]})]})}),n&&a.jsx(_,{sx:{display:"flex",justifyContent:"center",my:4},children:a.jsx(se,{})}),c&&a.jsx(he,{severity:"error",sx:{my:2},children:c}),!n&&!c&&(E.length===0?a.jsxs(Z,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[a.jsx(it,{sx:{fontSize:48,color:"text.secondary"}}),a.jsx(w,{variant:"h6",color:"text.secondary",sx:{mt:1},children:C.trim()?"没有找到匹配的申请记录":"该日期范围内没有申请记录"})]}):l?a.jsxs(_,{children:[a.jsxs(Z,{sx:{p:2,mb:2,bgcolor:"info.50"},children:[a.jsx(w,{variant:"h6",color:"info.main",gutterBottom:!0,children:"物料汇总统计"}),a.jsxs(K,{container:!0,spacing:2,children:[a.jsxs(K,{item:!0,xs:4,children:[a.jsx(w,{variant:"body2",color:"text.secondary",children:"总申请人数"}),a.jsx(w,{variant:"h6",children:z.totalRequesters})]}),a.jsxs(K,{item:!0,xs:4,children:[a.jsx(w,{variant:"body2",color:"text.secondary",children:"总申请单数"}),a.jsx(w,{variant:"h6",children:z.totalRequests})]}),a.jsxs(K,{item:!0,xs:4,children:[a.jsx(w,{variant:"body2",color:"text.secondary",children:"物料种类"}),a.jsx(w,{variant:"h6",children:z.items.length})]})]})]}),z.items.map((i,u)=>a.jsx(Pe,{sx:{mb:2,boxShadow:2,borderRadius:2},variant:"outlined",children:a.jsxs(_e,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[a.jsxs(_,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[a.jsx(w,{variant:"h6",sx:{fontWeight:"bold"},children:i.name}),a.jsx(nt,{label:`总计: ${i.quantity} ${i.unit||""}`,color:"primary",variant:"outlined"})]}),a.jsxs(w,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["申请人: ",i.requesters.join(", ")]}),a.jsxs(w,{variant:"caption",color:"text.secondary",children:["共 ",i.requesters.length," 人申请"]})]})},u))]}):E.map(i=>a.jsxs(Pe,{sx:{mb:2,boxShadow:2,borderRadius:2,borderLeft:"4px solid",borderColor:`${Ct(i.status)}.main`},variant:"outlined",children:[a.jsxs(_e,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[a.jsxs(_,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1.5},children:[a.jsxs(_,{children:[a.jsxs(w,{variant:"body1",sx:{fontWeight:"bold"},children:["申请人: ",i.requestedBy||"未知"]}),a.jsx(w,{variant:"caption",color:"text.secondary",display:"block",children:new Date(i.createdAt).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),a.jsx(nt,{label:la[i.status]||i.status,color:Ct(i.status),size:"small",sx:{mt:.5}})]}),a.jsx(qe,{dense:!0,sx:{mt:1,p:0},children:i.items.map((u,b)=>a.jsx(Ue,{sx:{py:.25,px:0},children:a.jsx(Ge,{primary:u.name,secondary:`x ${u.quantity} ${u.unit||""}`,primaryTypographyProps:{variant:"body1"},secondaryTypographyProps:{variant:"body2",color:"text.secondary"}})},b))}),i.notes&&a.jsxs(w,{variant:"body2",sx:{mt:1.5,fontStyle:"italic",color:"text.secondary",p:1.5,backgroundColor:"grey.100",borderRadius:1},children:["备注: ",i.notes]})]}),T&&i.status==="pending"&&a.jsx(Lt,{sx:{pt:0,px:1.5,pb:1.5},children:a.jsx(ne,{variant:"contained",color:"success",size:"small",onClick:()=>U(i._id),disabled:D.has(i._id),startIcon:D.has(i._id)?a.jsx(se,{size:16}):null,children:D.has(i._id)?"批准中...":"批准申请"})})]},i._id)))]})})},ua=({onStoreSelect:r,storageKey:s="defaultStoreId"})=>{const[e,t]=h.useState([]),[n,o]=h.useState(!0),[c,f]=h.useState("");h.useEffect(()=>{(async()=>{try{const x=await fetch("/api/stores");if(!x.ok)throw new Error("获取门店列表失败");const j=await x.json();if(j.success)t(j.data);else throw new Error(j.message||"未能加载门店数据")}catch(x){f(x.message)}finally{o(!1)}})()},[]);const d=g=>{localStorage.setItem(s,g),r(g)};return n?a.jsxs(_,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"80vh"},children:[a.jsx(se,{}),a.jsx(w,{sx:{ml:2},children:"正在加载门店列表..."})]}):c?a.jsx(he,{severity:"error",sx:{m:2},children:c}):a.jsxs(Z,{sx:{m:2,p:2},children:[a.jsx(w,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center"},children:"请选择您的门店"}),a.jsx(w,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",mb:2},children:"您的选择将被记住，下次访问时将直接进入该门店。"}),a.jsx(qe,{component:"nav","aria-label":"门店列表",children:e.map((g,x)=>a.jsxs(st.Fragment,{children:[a.jsx(Ue,{disablePadding:!0,children:a.jsxs(Jr,{onClick:()=>d(g._id),children:[a.jsx(Cr,{children:a.jsx(Tr,{})}),a.jsx(Ge,{primary:g.name})]})}),x<e.length-1&&a.jsx(Et,{})]},g._id))})]})},ha=()=>{const[r,s]=h.useState(null),[e,t]=h.useState(!0),[n,o]=h.useState(""),[c,f]=h.useState(!1),[d,g]=h.useState(!0);return h.useEffect(()=>{const j=(m=>new URLSearchParams(window.location.search).get(m))("appId");console.log("--- [Feishu Auth Hook] Initializing ---"),console.log(`- appId from URL: ${j}`);let C=0;const O=6,l=setInterval(()=>{if(console.log(`- Polling for SDK, check #${C+1}`),window.h5sdk&&window.tt){clearInterval(l),console.log("- SDK found! Proceeding with auth."),f(!0),g(!1);const m=localStorage.getItem("user");if(m&&m!=="undefined"){console.log("- Found user in localStorage. Skipping auth flow."),s(JSON.parse(m)),t(!1);return}if(console.log("- No user in localStorage."),!j){console.error("[Feishu Auth Hook Error] appId is missing from URL."),o("URL中缺少appId参数。"),t(!1);return}window.h5sdk.ready(()=>{console.log("- h5sdk is ready. Calling tt.requestAccess."),console.log(`- Passing appId to tt.requestAccess: ${j}`);const T=setTimeout(()=>{console.error("[Feishu Auth Hook Error] tt.requestAccess timed out after 5 seconds."),o("飞书授权请求超时，请稍后重试。"),t(!1)},1e4);tt.requestAccess({appID:j,scopeList:[],success:y=>{clearTimeout(T),console.log("- tt.requestAccess succeeded. Code:",y.code),console.log("- Sending code to backend..."),fetch("/api/feishu/auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:y.code,appID:j})}).then(D=>{if(!D.ok)throw console.error("[Feishu Auth Hook Error] Backend fetch failed.",D),new Error("获取用户信息失败");return D.json()}).then(D=>{console.log("- Backend returned user data:",D),localStorage.setItem("user",JSON.stringify(D)),s(D)}).catch(D=>{console.error("[Feishu Auth Hook Error] Error in fetch chain:",D),o(D.message)}).finally(()=>t(!1))},fail:y=>{clearTimeout(T),console.error("[Feishu Auth Hook Error] tt.requestAccess failed:",y),o(`飞书授权失败: ${JSON.stringify(y)}`),t(!1)}})})}else C++,C>=O&&(clearInterval(l),console.warn("[Feishu Auth Hook] SDK polling timed out."),g(!1),f(!1),t(!1))},500);return()=>clearInterval(l)},[]),{user:r,loading:e,error:n,isFeishuEnv:c,checkingEnv:d}},fa=({onAddToCart:r,onUpdateCart:s,cartItems:e,ingredients:t,loading:n,error:o})=>{const[c,f]=h.useState([]),[d,g]=h.useState("all"),[x,j]=h.useState("");h.useEffect(()=>{f(t),g("all")},[t]),h.useEffect(()=>{let l=t;d!=="all"&&(l=l.filter(m=>{var T;return(T=m.ingredient.post)==null?void 0:T.includes(Number(d))})),x.trim()&&(l=l.filter(m=>m.ingredient.name.toLowerCase().includes(x.toLowerCase().trim())||m.ingredient.specs&&m.ingredient.specs.toLowerCase().includes(x.toLowerCase().trim()))),f(l)},[d,t,x]);const C=l=>{const m=e.find(y=>y.ingredientId===l.ingredient._id);if((m?m.quantity:0)+1>l.virtualStock){alert("申请数量超过可用库存");return}r({ingredientId:l.ingredient._id,name:l.ingredient.name,quantity:1,unit:l.ingredient.unit})},O=l=>{if(!e.find(y=>y.ingredientId===l.ingredient._id))return;const T=e.map(y=>y.ingredientId===l.ingredient._id?{...y,quantity:y.quantity-1}:y).filter(y=>y.quantity>0);s(T)};return a.jsxs(_,{children:[a.jsx(w,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:"申领中心"}),a.jsxs(Z,{sx:{p:1.5,mb:2,position:"sticky",top:0,zIndex:1,backgroundColor:"background.paper"},children:[a.jsx(xe,{fullWidth:!0,size:"small",placeholder:"搜索原料名称或规格...",value:x,onChange:l=>j(l.target.value),sx:{mb:2},InputProps:{startAdornment:a.jsx(He,{position:"start",children:a.jsx(Mr,{color:"action"})}),endAdornment:x&&a.jsx(He,{position:"end",children:a.jsx(Oe,{size:"small",onClick:()=>j(""),edge:"end",children:a.jsx(Ys,{})})})}}),a.jsx(w,{variant:"subtitle2",sx:{mb:1,fontWeight:"bold"},children:"按岗位筛选"}),a.jsxs(_,{sx:{position:"relative"},children:[a.jsx(_,{sx:{overflowX:"auto",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},children:a.jsxs(_,{sx:{display:"flex",gap:1,py:.5,pr:"30px"},children:[a.jsx(ne,{size:"small",variant:d==="all"?"contained":"outlined",onClick:()=>g("all"),children:"全部"}),Object.entries(Dr).map(([l,m])=>a.jsx(ne,{size:"small",variant:d===l?"contained":"outlined",onClick:()=>g(l),sx:{flexShrink:0},children:m},l))]})}),a.jsx(_,{sx:{position:"absolute",top:0,right:0,width:"30px",height:"100%",background:l=>`linear-gradient(to left, ${l.palette.background.paper}, transparent)`,pointerEvents:"none"}})]})]}),n&&a.jsx(_,{sx:{display:"flex",justifyContent:"center",my:4},children:a.jsx(se,{})}),o&&a.jsx(he,{severity:"error",children:o}),!n&&!o&&(c.length>0?a.jsx(K,{container:!0,spacing:2,children:c.map(l=>{const m=l.ingredient._id,T=e.find(y=>y.ingredientId===m);return a.jsx(K,{item:!0,xs:12,children:a.jsxs(Pe,{sx:{display:"flex",flexDirection:"column",boxShadow:3,borderRadius:2},children:[a.jsxs(_e,{sx:{flexGrow:1,p:1.5},children:[a.jsx(w,{gutterBottom:!0,variant:"h6",component:"h2",sx:{fontSize:"1rem",fontWeight:"bold"},children:l.ingredient.name}),a.jsxs(w,{variant:"body2",color:"text.secondary",sx:{mb:1},children:["规格: ",l.ingredient.specs||"无"]}),a.jsxs(w,{variant:"body2",color:"text.secondary",children:["可用库存: ",l.virtualStock," ",l.ingredient.unit]})]}),a.jsx(Lt,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",p:1.5,pt:0},children:T?a.jsxs(_,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(Oe,{color:"primary",onClick:()=>O(l),size:"small",children:a.jsx(Ir,{})}),a.jsx(w,{variant:"h6",component:"span",children:T.quantity}),a.jsx(Oe,{color:"primary",onClick:()=>C(l),size:"small",disabled:T.quantity>=l.virtualStock,children:a.jsx(Or,{})})]}):a.jsx(ne,{variant:"contained",size:"medium",onClick:()=>C(l),children:"加入购物车"})})]})},m)})}):a.jsxs(Z,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[a.jsx(Ns,{sx:{fontSize:48,color:"text.secondary"}}),a.jsx(w,{variant:"h6",color:"text.secondary",sx:{mt:1},children:x.trim()?"未找到匹配的物料":d==="all"?"暂无可用物料":"当前筛选下没有物料"}),x.trim()?a.jsx(w,{variant:"body1",color:"text.secondary",sx:{mt:1},children:"尝试修改搜索关键词或清空搜索条件。"}):d!=="all"&&a.jsx(w,{variant:"body1",color:"text.secondary",sx:{mt:1},children:"尝试选择其他岗位或“全部”。"})]}))]})},pa=({user:r,cartItems:s,onUpdateCart:e,storeId:t,refetchData:n})=>{const[o,c]=h.useState(!1),[f,d]=h.useState(""),[g,x]=h.useState(""),j=(l,m)=>{const T=[...s];T[l].quantity=Number(m),e(T.filter(y=>y.quantity>0))},C=l=>{const m=[...s];m.splice(l,1),e(m)},O=async()=>{if(s.length===0){d("购物车是空的！");return}c(!0),d(""),x("");try{const[l,m]=await Promise.all([fetch("/api/warehouse/stock",{headers:{"x-current-store-id":t}}),fetch("/api/transfer-requests",{headers:{"x-current-store-id":t}})]);if(!l.ok)throw new Error("无法获取最新库存信息进行校验");if(!m.ok)throw new Error("无法获取最新申请信息进行校验");const T=await l.json(),y=await m.json(),D={};y.filter(i=>i.status==="pending"||i.status==="approved").forEach(i=>{i.items.forEach(u=>{D[u.ingredientId]=(D[u.ingredientId]||0)+u.quantity})});const R=new Map;(T.items||[]).forEach(i=>{if(i.mainWarehouseStock){const u=D[i.ingredient._id]||0,b=i.mainWarehouseStock.quantity-u;R.set(i.ingredient._id,b>0?b:0)}});const $=s.filter(i=>{const u=R.get(i.ingredientId);return i.quantity>(u===void 0?0:u)});if($.length>0){const i=$.map(u=>u.name).join(", ");throw new Error(`库存不足或物料已下架: ${i}。请返回修改数量或移除物料。`)}const z={items:s.map(i=>({ingredientId:i.ingredientId,name:i.name,unit:i.unit,quantity:i.quantity})),requestedBy:(r==null?void 0:r.name)||"未知飞书用户"},U=await fetch("/api/transfer-requests",{method:"POST",headers:{"Content-Type":"application/json","x-current-store-id":t},body:JSON.stringify(z)});if(!U.ok){const i=await U.json();throw new Error(i.message||"提交申请失败")}x("您的调拨申请已成功提交！"),e([]),n&&n()}catch(l){d(l.message)}finally{c(!1),setTimeout(()=>{x(""),d("")},5e3)}};return a.jsxs(_,{children:[a.jsx(w,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:"我的购物车"}),f&&a.jsx(he,{severity:"error",sx:{mb:2},children:f}),g&&a.jsx(he,{severity:"success",sx:{mb:2},children:g}),s.length===0&&!g?a.jsxs(Z,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[a.jsx(Ft,{sx:{fontSize:48,color:"text.secondary"}}),a.jsx(w,{variant:"h6",color:"text.secondary",sx:{mt:1},children:"购物车是空的"})]}):a.jsx(qe,{children:s.map((l,m)=>a.jsxs(Ue,{divider:!0,secondaryAction:a.jsx(ne,{edge:"end",color:"error",size:"small",onClick:()=>C(m),children:"删除"}),children:[a.jsx(Ge,{primary:a.jsx(w,{variant:"body1",sx:{fontWeight:500},children:l.name})}),a.jsxs(_,{sx:{display:"flex",alignItems:"center",mx:2},children:[a.jsx(xe,{type:"number",size:"small",variant:"outlined",value:l.quantity,onChange:T=>j(m,T.target.value),sx:{width:"70px"},inputProps:{min:1}}),a.jsx(w,{variant:"body1",component:"span",sx:{ml:1.5,minWidth:"30px",textAlign:"left"},children:l.unit})]})]},`${l.ingredientId}-${m}`))}),s.length>0&&a.jsxs(Z,{elevation:3,sx:{p:2,mt:2,position:"sticky",bottom:60,zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.95)"},children:[a.jsxs(w,{variant:"h6",sx:{mb:2},children:["总计: ",s.reduce((l,m)=>l+m.quantity,0)," 件"]}),a.jsx(ne,{fullWidth:!0,variant:"contained",color:"primary",size:"large",onClick:O,disabled:o,children:o?a.jsx(se,{size:24,color:"inherit"}):"提交申请"})]})]})},ga=({requests:r,loading:s,error:e,user:t,storeId:n})=>{const[o,c]=h.useState(!1),[f,d]=h.useState([]),[g,x]=h.useState(!1),j=y=>{switch(y){case"completed":return"success";case"approved":return"info";case"rejected":return"error";case"pending":default:return"warning"}},C={pending:"待处理",approved:"已批准",rejected:"已拒绝",completed:"已完成"},O=async()=>{if(n){x(!0);try{const y=await fetch("/api/transfer-requests",{headers:{"x-current-store-id":n}});if(!y.ok)throw new Error("获取所有申请记录失败");const D=await y.json();d(D.sort((R,$)=>new Date($.createdAt)-new Date(R.createdAt)))}catch(y){console.error("获取所有申请记录失败:",y)}finally{x(!1)}}},l=()=>{o||O(),c(!o)},m=o?f:r,T=o?g:s;return a.jsxs(_,{children:[a.jsx(w,{variant:"h5",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",textAlign:"center",my:2},children:o?"所有申请记录":"我的申请记录"}),a.jsx(_,{sx:{display:"flex",justifyContent:"center",mb:2},children:a.jsx(ne,{variant:o?"outlined":"contained",onClick:l,size:"small",children:o?"只看我的申请":"查看所有申请"})}),T&&a.jsx(_,{sx:{display:"flex",justifyContent:"center",my:4},children:a.jsx(se,{})}),e&&a.jsx(he,{severity:"error",children:e}),!T&&!e&&(m.length===0?a.jsxs(Z,{variant:"outlined",sx:{p:4,textAlign:"center",mt:4},children:[a.jsx(it,{sx:{fontSize:48,color:"text.secondary"}}),a.jsx(w,{variant:"h6",color:"text.secondary",sx:{mt:1},children:o?"暂无申请记录":"暂无我的申请记录"})]}):m.map(y=>a.jsx(Pe,{sx:{mb:2,boxShadow:2,borderRadius:2,borderLeft:"4px solid",borderColor:`${j(y.status)}.main`},variant:"outlined",children:a.jsxs(_e,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[a.jsxs(_,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1.5},children:[a.jsxs(_,{children:[a.jsxs(w,{variant:"body1",sx:{fontWeight:"bold"},children:["申请单 #",y._id.slice(-6)]}),o&&a.jsxs(w,{variant:"body2",color:"primary",sx:{fontWeight:"medium"},children:["申请人: ",y.requestedBy||"未知"]}),a.jsx(w,{variant:"caption",color:"text.secondary",display:"block",children:new Date(y.createdAt).toLocaleString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),a.jsx(nt,{label:C[y.status]||y.status,color:j(y.status),size:"small",sx:{mt:.5}})]}),a.jsx(qe,{dense:!0,sx:{mt:1,p:0},children:y.items.map((D,R)=>a.jsx(Ue,{sx:{py:.25,px:0},children:a.jsx(Ge,{primary:D.name,secondary:`x ${D.quantity} ${D.unit||""}`,primaryTypographyProps:{variant:"body1",fontWeight:"medium"},secondaryTypographyProps:{variant:"body2",color:"text.secondary"}})},R))}),y.notes&&a.jsxs(w,{variant:"body2",sx:{mt:1.5,fontStyle:"italic",color:"text.secondary",p:1.5,backgroundColor:"grey.100",borderRadius:1},children:["备注: ",y.notes]})]})},y._id)))]})},xa=()=>{const[r,s]=h.useState(null),[e,t]=h.useState("shop"),[n,o]=h.useState([]),[c,f]=h.useState(""),[d,g]=h.useState(!0),[x,j]=h.useState([]),[C,O]=h.useState([]),{user:l,loading:m,error:T,isFeishuEnv:y,checkingEnv:D}=ha();h.useEffect(()=>{const i=new URLSearchParams(window.location.search).get("store");if(i){console.log(`[Mobile Page] Found store in URL: ${i}. Locking it in sessionStorage.`),sessionStorage.setItem("lockedStoreId",i),s(i);return}const u=sessionStorage.getItem("lockedStoreId");if(u){console.log(`[Mobile Page] Found locked storeId in sessionStorage: ${u}.`),s(u);return}const b=localStorage.getItem("defaultStoreId");if(b){console.log(`[Mobile Page] Found default storeId in localStorage: ${b}.`),s(b);return}console.log("[Mobile Page] No storeId found. Waiting for user selection.")},[]);const R=h.useCallback(async()=>{if(r){g(!0),f("");try{const[i,u]=await Promise.all([fetch("/api/warehouse/stock",{headers:{"x-current-store-id":r}}),fetch("/api/transfer-requests",{headers:{"x-current-store-id":r}})]);if(!i.ok)throw new Error("获取物料列表失败");if(!u.ok)throw new Error("获取申请记录失败");const b=await i.json(),P=await u.json(),N=P.filter(H=>H.requestedBy===(l==null?void 0:l.name));O(N.sort((H,J)=>new Date(J.createdAt)-new Date(H.createdAt)));const W={};P.filter(H=>H.status==="pending"||H.status==="approved").forEach(H=>{H.items.forEach(J=>{W[J.ingredientId]=(W[J.ingredientId]||0)+J.quantity})});const ee=(b.items||[]).filter(H=>H.mainWarehouseStock&&H.mainWarehouseStock.quantity>0).map(H=>{const J=W[H.ingredient._id]||0,ge=H.mainWarehouseStock.quantity-J;return{...H,virtualStock:ge>0?ge:0}});j(ee)}catch(i){f(i.message)}finally{g(!1)}}},[r]);h.useEffect(()=>{y&&l&&r&&R()},[y,l,r,R]);const $=i=>{o(u=>u.find(P=>P.ingredientId===i.ingredientId)?u.map(P=>P.ingredientId===i.ingredientId?{...P,quantity:P.quantity+i.quantity}:P):[...u,i])},E=i=>{o(i)},z=(i,u)=>{t(u)},U=()=>{if(d&&e!=="all-requests")return a.jsx(_,{sx:{display:"flex",justifyContent:"center",my:4},children:a.jsx(se,{})});switch(e){case"cart":return a.jsx(pa,{user:l,cartItems:n,onUpdateCart:E,storeId:r,refetchData:R});case"history":return a.jsx(ga,{requests:C,loading:d,error:c,user:l,storeId:r});case"inventory":return a.jsx(sa,{});case"all-requests":return a.jsx(da,{storeId:r,user:l});case"shop":default:return a.jsx(fa,{onAddToCart:$,onUpdateCart:E,cartItems:n,ingredients:x,loading:d,error:c,refetchData:R})}};return D||m?a.jsxs(Ie,{sx:{mt:4,textAlign:"center"},children:[a.jsx(se,{}),a.jsx(w,{sx:{mt:2},children:D?"正在检查运行环境...":"正在获取用户信息..."})]}):y?T?a.jsx(Ie,{sx:{mt:2},children:a.jsx(he,{severity:"error",children:T})}):r?a.jsxs(_,{sx:{pb:7},children:[a.jsxs(Ie,{children:[a.jsxs(_,{sx:{display:"flex",alignItems:"center",p:1,mb:1},children:[a.jsx(Gs,{sx:{color:"action.active",mr:1}}),a.jsxs(w,{variant:"subtitle1",children:["欢迎, ",(l==null?void 0:l.name)||"用户"]})]}),U()]}),a.jsx(Z,{sx:{position:"fixed",bottom:0,left:0,right:0},elevation:3,children:a.jsxs(zr,{showLabels:!0,value:e,onChange:z,children:[a.jsx(me,{label:"申领中心",value:"shop",icon:a.jsx(Rs,{})}),a.jsx(me,{label:"购物车",value:"cart",icon:a.jsx(Ar,{badgeContent:n.length,color:"primary",children:a.jsx(Ft,{})})}),a.jsx(me,{label:"我的申请",value:"history",icon:a.jsx(it,{})}),a.jsx(me,{label:"所有申请",value:"all-requests",icon:a.jsx(ta,{})}),a.jsx(me,{label:"库存盘点",value:"inventory",icon:a.jsx(Js,{})})]})})]}):a.jsx(ua,{onStoreSelect:s}):a.jsx(Ie,{sx:{mt:4},children:a.jsxs(Z,{sx:{p:3,textAlign:"center",backgroundColor:"warning.light"},children:[a.jsx(Qs,{sx:{fontSize:48,color:"warning.main"}}),a.jsx(w,{variant:"h5",sx:{mt:2,fontWeight:"bold"},children:"请在飞书客户端中打开"}),a.jsx(w,{sx:{mt:1},children:"此页面需要飞书应用环境支持，请复制链接并在飞书中访问。"})]})})},ya=window.fetch;window.fetch=function(r,s){const e=sessionStorage.getItem("lockedStoreId"),t=localStorage.getItem("defaultStoreId"),n=e||t,o={...s};return o.headers||(o.headers={}),n&&!o.headers["x-current-store-id"]&&(o.headers["x-current-store-id"]=n),ya(r,o)};Sr.createRoot(document.getElementById("root")).render(a.jsx(st.StrictMode,{children:a.jsx(xa,{})}));
